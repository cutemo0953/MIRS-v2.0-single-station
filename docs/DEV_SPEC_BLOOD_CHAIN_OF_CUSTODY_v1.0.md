# Blood Transfusion Chain of Custody (éˆå¼æ ¸å°) DEV SPEC v1.0

**ç‰ˆæœ¬**: 1.0.0
**æ—¥æœŸ**: 2026-01-20
**ç‹€æ…‹**: è¦åŠƒä¸­
**é—œè¯**: Blood Bank PWA v2.8ã€Anesthesia PWA

---

## 1. èƒŒæ™¯èˆ‡å‹•æ©Ÿ

### 1.1 ç¾è¡Œé†«é™¢æµç¨‹

è¡€å“è¼¸æ³¨æ˜¯é†«ç™‚ä½œæ¥­ä¸­**é¢¨éšªæœ€é«˜**çš„æµç¨‹ä¹‹ä¸€ã€‚ä¸€æ—¦ç™¼ç”Ÿ ABO è¡€å‹ä¸åˆè¼¸è¡€ï¼Œè‡´æ­»ç‡æ¥µé«˜ã€‚å› æ­¤ï¼Œå°ç£é†«é™¢æ™®ééµå¾ª**å¤šé‡æŸ¥æ ¸**åŸå‰‡ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‚³çµ±è¡€å“è¼¸æ³¨æµç¨‹ (ç´™æœ¬ä½œæ¥­)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â‘  è¡€åº«ç™¼è¡€ (Blood Bank Release)                                         â”‚
â”‚     â”œâ”€ è¡€åº«äººå“¡ A æ ¸å°ï¼šè¡€è¢‹ IDã€è¡€å‹ã€ç—…äººå§“å/ç—…æ­·è™Ÿ                    â”‚
â”‚     â”œâ”€ è¡€åº«äººå“¡ B è¦†æ ¸ï¼šåŒä¸Šé …ç›®                                          â”‚
â”‚     â”œâ”€ é›™äººåœ¨ã€Œç™¼è¡€è¨˜éŒ„å–®ã€ç°½å                                           â”‚
â”‚     â””â”€ è¡€è¢‹äº¤çµ¦å‚³é€äººå“¡                                                   â”‚
â”‚                                                                          â”‚
â”‚  â‘¡ å‚³é€é‹é€ (Transport)                                                  â”‚
â”‚     â”œâ”€ å‚³é€äººå“¡ç°½æ”¶è¡€è¢‹                                                   â”‚
â”‚     â”œâ”€ æ ¸å°è¡€è¢‹æ•¸é‡ã€æº«åº¦ (å†·è—è¡€å“éœ€ä¿å†·è¢‹)                              â”‚
â”‚     â””â”€ é‹é€è‡³æŒ‡å®šå–®ä½                                                     â”‚
â”‚                                                                          â”‚
â”‚  â‘¢ è­·ç†æ”¶è¡€ (Nursing Receipt)                                            â”‚
â”‚     â”œâ”€ è­·ç†äººå“¡ A æ ¸å°ï¼šè¡€è¢‹ IDã€è¡€å‹ã€ç—…äººæ‰‹ç’°                           â”‚
â”‚     â”œâ”€ è­·ç†äººå“¡ B è¦†æ ¸ï¼šåŒä¸Šé …ç›®                                          â”‚
â”‚     â”œâ”€ é›™äººåœ¨ã€Œè¼¸è¡€è­·ç†è¨˜éŒ„å–®ã€ç°½å                                       â”‚
â”‚     â””â”€ æ”¾å…¥è¡€åº«å†°ç®±æš«å­˜ (è‹¥éç«‹å³è¼¸è¡€)                                    â”‚
â”‚                                                                          â”‚
â”‚  â‘£ è¼¸è¡€åŸ·è¡Œ (Administration)                                             â”‚
â”‚     â”œâ”€ åºŠé‚Šå†æ¬¡é›™äººæ ¸å°ï¼šè¡€è¢‹ vs ç—…äººæ‰‹ç’°                                 â”‚
â”‚     â”œâ”€ ç¢ºèªç—…äººæ„è­˜æ¸…é†’å¯å›ç­”å§“å/ç”Ÿæ—¥                                    â”‚
â”‚     â”œâ”€ é–‹å§‹è¼¸è¡€ï¼Œè¨˜éŒ„é–‹å§‹æ™‚é–“                                             â”‚
â”‚     â””â”€ 15 åˆ†é˜å…§å¯†åˆ‡è§€å¯Ÿè¼¸è¡€åæ‡‰                                          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç¾è¡Œæµç¨‹ç—›é»

| ç—›é» | èªªæ˜ | é¢¨éšªç­‰ç´š |
|------|------|----------|
| **å£é ­æ ¸å°è€—æ™‚** | æ¯æ¬¡æ ¸å°éœ€å”¸å‡ºè¡€è¢‹ ID (15 ç¢¼ä»¥ä¸Š)ã€ç—…äººå§“åã€è¡€å‹ï¼Œç´„éœ€ 30-60 ç§’ | ä¸­ |
| **ç´™æœ¬ç°½åè¿½è¹¤é›£** | ç™¼è¡€å–®ã€è­·ç†è¨˜éŒ„å–®åˆ†æ•£ï¼Œäº‹å¾Œç¨½æ ¸å›°é›£ | ä¸­ |
| **äººç‚ºéºæ¼é¢¨éšª** | å¿™ç¢Œæ™‚å¯èƒ½ã€Œèµ°éå ´ã€ï¼Œæœªç¢ºå¯¦æ ¸å°æ¯é … | **é«˜** |
| **ç„¡å³æ™‚è­¦ç¤º** | è¡€å‹ä¸ç¬¦åªèƒ½é äººçœ¼æ¯”å°ï¼Œç³»çµ±ç„¡æ³•å³æ™‚é˜»æ“‹ | **é«˜** |
| **æ™‚é–“æˆ³è¨˜ä¸ç²¾ç¢º** | æ‰‹å¯«æ™‚é–“å¸¸ç‚ºã€Œæ•´é»ã€ä¼°ç®—ï¼Œéå¯¦éš›æ™‚é–“ | ä½ |
| **è·¨å–®ä½è¿½è¹¤æ–·éˆ** | è¡€è¢‹å¾è¡€åº«åˆ°æ‰‹è¡“å®¤é€”ä¸­ï¼Œè‹¥ç™¼ç”Ÿå»¶èª¤é›£ä»¥è¿½è¹¤ | ä¸­ |

### 1.3 ç‚ºä»€éº¼éœ€è¦æ•¸ä½åŒ–

**æ³•è¦è¦æ±‚**:
- è¡›ç¦éƒ¨ã€Šé†«ç™‚æ©Ÿæ§‹è¼¸è¡€ä½œæ¥­è¦ç¯„ã€‹è¦æ±‚ã€Œæ‡‰æœ‰å®Œæ•´ä¹‹è¼¸è¡€ç´€éŒ„ã€
- é†«é™¢è©•é‘‘æ¢æ–‡è¦æ±‚ã€Œè¼¸è¡€ä½œæ¥­æ‡‰æœ‰é›™é‡æŸ¥æ ¸æ©Ÿåˆ¶ã€

**è‡¨åºŠéœ€æ±‚**:
- æ‰‹è¡“å®¤è¡€å“éœ€æ±‚é‡å¤§ï¼Œæ¯å°åˆ€å¯èƒ½è¼¸ 2-10 è¢‹ä»¥ä¸Š
- å‚³çµ±ç´™æœ¬æ ¸å°åœ¨ç·Šæ€¥æ‰‹è¡“ä¸­å¸¸è¢«ç°¡åŒ–ï¼Œå¢åŠ é¢¨éšª
- æ•¸ä½åŒ–å¯åœ¨**ä¸å¢åŠ äººåŠ›**çš„æƒ…æ³ä¸‹**åŠ é€Ÿæ ¸å°**ä¸¦**ç¢ºä¿å®Œæ•´æ€§**

**å“è³ªæå‡**:
- å®Œæ•´æ™‚é–“æˆ³è¨˜ï¼Œå¯è¿½è¹¤æ¯è¢‹è¡€å“å¾ç™¼è¡€åˆ°è¼¸å®Œçš„å…¨ç¨‹æ™‚é–“
- ç•°å¸¸è­¦ç¤ºå¯åœ¨éŒ¯èª¤ç™¼ç”Ÿ**å‰**æ””æˆªï¼Œè€Œéäº‹å¾Œç¨½æ ¸
- æ•¸æ“šå¯ç”¨æ–¼å“è³ªæ”¹å–„ (å¦‚ï¼šå¹³å‡ç™¼è¡€åˆ°è¼¸è¡€æ™‚é–“ã€é€€è¡€ç‡ç­‰)

---

## 2. åŠŸèƒ½ç›®æ¨™

### 2.1 æ ¸å¿ƒç›®æ¨™

> **ã€Œä»¥æƒç¢¼å–ä»£å£é ­æ ¸å°ï¼Œä»¥æ•¸ä½é›™ç°½å–ä»£ç´™æœ¬ç°½åï¼ŒåŒæ™‚ä¿ç•™é›™äººè¦†æ ¸çš„å®‰å…¨æ©Ÿåˆ¶ã€**

### 2.2 è¨­è¨ˆåŸå‰‡

| åŸå‰‡ | èªªæ˜ |
|------|------|
| **ä¸æ¸›å°‘æ ¸å°æ­¥é©Ÿ** | é›™äººæ ¸å°æ˜¯å®‰å…¨åº•ç·šï¼Œæ•¸ä½åŒ–åªæ˜¯åŠ é€ŸåŸ·è¡Œï¼Œä¸æ˜¯çœç•¥æ­¥é©Ÿ |
| **æƒç¢¼å„ªå…ˆ** | è¡€è¢‹æ¢ç¢¼ã€ç—…äººæ‰‹ç’° QRã€å“¡å·¥è­˜åˆ¥è­‰ï¼Œç›¡é‡ç”¨æƒç¢¼å–ä»£æ‰‹å‹•è¼¸å…¥ |
| **å³æ™‚é©—è­‰** | æ¯æ¬¡æƒç¢¼å¾Œç«‹å³æ¯”å°ï¼Œä¸ç¬¦æ™‚**ç´…è‰²è­¦å‘Š + è²éŸ³æç¤º** |
| **é›¢ç·šå¯ç”¨** | æ‰‹è¡“å®¤å¯èƒ½ç¶²è·¯ä¸ç©©ï¼Œæ ¸å°åŠŸèƒ½éœ€æ”¯æ´é›¢ç·šæ“ä½œï¼Œé€£ç·šå¾ŒåŒæ­¥ |
| **å®Œæ•´è¿½è¹¤** | æ¯å€‹æ­¥é©Ÿè¨˜éŒ„ï¼šèª°ã€ä½•æ™‚ã€åœ¨å“ªè£¡ã€åšäº†ä»€éº¼ |

---

## 3. æµç¨‹è¨­è¨ˆ

### 3.1 æ•¸ä½åŒ–å¾Œçš„å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•¸ä½è¡€å“éˆå¼æ ¸å°æµç¨‹ (Chain of Custody)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  STEP 1: è¡€åº«ç™¼è¡€ (Blood Bank PWA)                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“¦ ç™¼è¡€ä½œæ¥­                                          [è¡€åº« PWA]  â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  ç—…æ‚£: [æƒæç—…æ­·è™Ÿ æˆ– è¼¸å…¥] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚   â”‚
â”‚  â”‚                                            â”‚                      â”‚   â”‚
â”‚  â”‚  è¡€è¢‹: [æƒæè¡€è¢‹æ¢ç¢¼] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ ç³»çµ±è‡ªå‹•æ¯”å°       â”‚   â”‚
â”‚  â”‚                                            â”‚    âœ“ è¡€å‹ç›¸ç¬¦        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    âœ“ æœªéæœŸ          â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ ç™¼è¡€äººå“¡ 1: [æƒBadge]  é™³OO âœ“    â”‚  â”‚    âœ“ ç—…äººIDç›¸ç¬¦      â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ è¦†æ ¸äººå“¡ 2: [æƒBadge]  æ—OO âœ“    â”‚  â”‚                      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                      â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [        ç¢ºèªç™¼è¡€        ] â† å…©äººéƒ½æƒBadgeå¾Œæ‰å¯æŒ‰               â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“ è¨˜éŒ„: { step: "RELEASED", blood_unit_id, patient_id,                 â”‚
â”‚            actor1_id, actor2_id, timestamp, location: "BLOOD_BANK" }     â”‚
â”‚                                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  STEP 2: å‚³é€æ”¶è¡€ (Transport PWA / è¡€åº« PWA)                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸšš å‚³é€æ”¶è¡€                                         [å‚³é€ PWA]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  è¡€è¢‹: [æƒæè¡€è¢‹æ¢ç¢¼] â”€â”€â”€â”€â”€â†’ é¡¯ç¤ºè¡€è¢‹è³‡è¨Š                         â”‚   â”‚
â”‚  â”‚        BU-20260120-ABC123                                         â”‚   â”‚
â”‚  â”‚        O+ PRBC 300ml                                              â”‚   â”‚
â”‚  â”‚        é€å¾€: æ‰‹è¡“å®¤ OR-3                                          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ å‚³é€äººå“¡: [æƒBadge]  ç‹OO âœ“      â”‚                          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [        ç¢ºèªæ”¶è¡€        ]                                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“ è¨˜éŒ„: { step: "TRANSPORT_PICKUP", blood_unit_id,                     â”‚
â”‚            transporter_id, timestamp, location: "BLOOD_BANK" }           â”‚
â”‚                                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  STEP 3: è­·ç†æ”¶è¡€ (Anesthesia PWA / è­·ç†ç«™ PWA)                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“¥ è­·ç†æ”¶è¡€                                     [éº»é†‰/è­·ç† PWA]   â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  è¡€è¢‹: [æƒæè¡€è¢‹æ¢ç¢¼] â”€â”€â”€â”€â”€â”€â”                                     â”‚   â”‚
â”‚  â”‚                             â”‚                                     â”‚   â”‚
â”‚  â”‚  ç—…äºº: [æƒææ‰‹ç’°QR] â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ ç³»çµ±è‡ªå‹•æ¯”å°                      â”‚   â”‚
â”‚  â”‚                             â”‚    âœ“ è¡€å‹ç›¸ç¬¦                       â”‚   â”‚
â”‚  â”‚                             â”‚    âœ“ ç—…äººIDç›¸ç¬¦                     â”‚   â”‚
â”‚  â”‚                             â”‚    âœ“ è¡€è¢‹ç¢ºç‚ºæ­¤ç—…äººæ‰€é ˜              â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ æ”¶è¡€è­·ç†å¸« 1: [æƒBadge]  å¼µOO âœ“  â”‚                          â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ è¦†æ ¸è­·ç†å¸« 2: [æƒBadge]  æOO âœ“  â”‚                          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [        ç¢ºèªæ”¶è¡€        ] â† å…©äººéƒ½æƒBadgeå¾Œæ‰å¯æŒ‰               â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“ è¨˜éŒ„: { step: "NURSING_RECEIVED", blood_unit_id, patient_id,         â”‚
â”‚            actor1_id, actor2_id, timestamp, location: "OR-3" }           â”‚
â”‚                                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  STEP 4: é–‹å§‹è¼¸è¡€ (Anesthesia PWA)                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ’‰ é–‹å§‹è¼¸è¡€                                      [éº»é†‰ PWA]       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  è¡€è¢‹: [æƒæè¡€è¢‹æ¢ç¢¼] â”€â”€â”€â”€â”€â”€â”                                     â”‚   â”‚
â”‚  â”‚                             â”‚                                     â”‚   â”‚
â”‚  â”‚  ç—…äºº: [æƒææ‰‹ç’°QR] â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â†’ åºŠé‚Šæœ€çµ‚ç¢ºèª                      â”‚   â”‚
â”‚  â”‚                             â”‚    âœ“ è¡€å‹ç›¸ç¬¦                       â”‚   â”‚
â”‚  â”‚                             â”‚    âœ“ ç—…äººç¢ºèªèº«ä»½ (æ¸…é†’æ™‚)          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ è¼¸è¡€è­·ç†å¸«: [æƒBadge]  å¼µOO âœ“    â”‚                          â”‚   â”‚
â”‚  â”‚  â”‚  ğŸ‘¤ ç¢ºèªé†«å¸«:   [æƒBadge]  é™³OO âœ“    â”‚ â† æˆ–ç¬¬äºŒä½è­·ç†å¸«         â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [        é–‹å§‹è¼¸è¡€        ]                                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â±ï¸ è¼¸è¡€é–‹å§‹æ™‚é–“: 14:32:15                                        â”‚   â”‚
â”‚  â”‚  âš ï¸ è«‹æ–¼ 15 åˆ†é˜å…§å¯†åˆ‡è§€å¯Ÿè¼¸è¡€åæ‡‰                                â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“ è¨˜éŒ„: { step: "TRANSFUSION_STARTED", blood_unit_id, patient_id,      â”‚
â”‚            actor1_id, actor2_id, timestamp, location: "OR-3" }           â”‚
â”‚                                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚  STEP 5: è¼¸è¡€å®Œæˆ (Anesthesia PWA)                                       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ… è¼¸è¡€å®Œæˆ                                      [éº»é†‰ PWA]       â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  è¡€è¢‹: BU-20260120-ABC123                                         â”‚   â”‚
â”‚  â”‚  è¼¸è¡€æ™‚é–“: 14:32 - 15:47 (75 åˆ†é˜)                                â”‚   â”‚
â”‚  â”‚  è¼¸è¡€é‡: 300ml (å®Œæ•´è¼¸æ³¨)                                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  è¼¸è¡€åæ‡‰: â—‹ ç„¡åæ‡‰  â—‹ è¼•å¾®åæ‡‰  â—‹ åš´é‡åæ‡‰                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  [        å®Œæˆè¨˜éŒ„        ]                                       â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                          â”‚
â”‚  ğŸ“ è¨˜éŒ„: { step: "TRANSFUSION_COMPLETED", blood_unit_id, patient_id,    â”‚
â”‚            duration_minutes, reaction, timestamp }                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ™‚é–“ç¯€çœä¼°ç®—

| æ­¥é©Ÿ | å‚³çµ±è€—æ™‚ | æ•¸ä½åŒ–è€—æ™‚ | ç¯€çœ |
|------|----------|------------|------|
| è¡€åº«ç™¼è¡€ (é›™äººæ ¸å°) | 60-90 ç§’ | 20-30 ç§’ | **60-70%** |
| å‚³é€æ”¶è¡€ | 30 ç§’ | 10 ç§’ | **67%** |
| è­·ç†æ”¶è¡€ (é›™äººæ ¸å°) | 60-90 ç§’ | 20-30 ç§’ | **60-70%** |
| è¼¸è¡€å‰æ ¸å° (åºŠé‚Š) | 60-90 ç§’ | 20-30 ç§’ | **60-70%** |
| **å–®è¢‹è¡€å“ç¸½è¨ˆ** | **3.5-6 åˆ†é˜** | **1-2 åˆ†é˜** | **ç´„ 65%** |

> ä»¥å¤§é‡è¼¸è¡€æ‰‹è¡“ (è¼¸ 10 è¢‹) è¨ˆç®—ï¼šå‚³çµ± 35-60 åˆ†é˜ â†’ æ•¸ä½åŒ– 10-20 åˆ†é˜ï¼Œ**ç¯€çœ 25-40 åˆ†é˜è­·ç†æ™‚é–“**

---

## 4. è³‡æ–™æ¨¡å‹

### 4.1 Chain of Custody Event

```python
class BloodCustodyEvent(BaseModel):
    """è¡€å“ç›£ç®¡éˆäº‹ä»¶"""
    id: str                          # äº‹ä»¶ ID
    blood_unit_id: str               # è¡€è¢‹ ID
    patient_id: str                  # ç—…äºº ID
    step: CustodyStep                # æ­¥é©Ÿé¡å‹
    actor1_id: str                   # åŸ·è¡Œäººå“¡ 1
    actor2_id: Optional[str]         # è¦†æ ¸äººå“¡ 2 (é›™äººæ ¸å°æ­¥é©Ÿå¿…å¡«)
    timestamp: datetime              # æ™‚é–“æˆ³è¨˜
    location: str                    # åœ°é» (BLOOD_BANK, OR-3, WARD-5A, etc.)
    verification_result: dict        # é©—è­‰çµæœ (blood_type_match, patient_match, etc.)
    notes: Optional[str]             # å‚™è¨»

class CustodyStep(str, Enum):
    RELEASED = "RELEASED"                      # è¡€åº«ç™¼è¡€
    TRANSPORT_PICKUP = "TRANSPORT_PICKUP"      # å‚³é€å–è¡€
    TRANSPORT_DELIVERY = "TRANSPORT_DELIVERY"  # å‚³é€é€é”
    NURSING_RECEIVED = "NURSING_RECEIVED"      # è­·ç†æ”¶è¡€
    TRANSFUSION_STARTED = "TRANSFUSION_STARTED"    # é–‹å§‹è¼¸è¡€
    TRANSFUSION_COMPLETED = "TRANSFUSION_COMPLETED" # è¼¸è¡€å®Œæˆ
    TRANSFUSION_STOPPED = "TRANSFUSION_STOPPED"    # è¼¸è¡€ä¸­æ­¢ (åæ‡‰)
    RETURNED = "RETURNED"                      # é€€è¡€
```

### 4.2 Blood Unit ç‹€æ…‹æ“´å±•

```python
class BloodUnitStatus(str, Enum):
    AVAILABLE = "AVAILABLE"           # åº«å­˜å¯ç”¨
    RESERVED = "RESERVED"             # å·²é ç´„
    ISSUED = "ISSUED"                 # å·²ç™¼è¡€ (åœ¨é€”ä¸­)
    IN_CLINICAL_AREA = "IN_CLINICAL_AREA"  # å·²åˆ°è‡¨åºŠå–®ä½
    TRANSFUSING = "TRANSFUSING"       # è¼¸è¡€ä¸­
    TRANSFUSED = "TRANSFUSED"         # å·²è¼¸å®Œ
    RETURNED = "RETURNED"             # å·²é€€è¡€
    EXPIRED = "EXPIRED"               # å·²éæœŸ
    DISCARDED = "DISCARDED"           # å·²éŠ·æ¯€
```

### 4.3 API Endpoints

```
POST /api/blood/units/{unit_id}/custody
    - è¨˜éŒ„ç›£ç®¡éˆäº‹ä»¶
    - Body: { step, patient_id, actor1_id, actor2_id?, location, notes? }
    - Returns: { event_id, verification_result, next_step }

GET /api/blood/units/{unit_id}/custody
    - å–å¾—è¡€è¢‹å®Œæ•´ç›£ç®¡éˆ
    - Returns: [ { step, timestamp, actors, location, verification } ... ]

POST /api/blood/verify
    - é©—è­‰è¡€è¢‹èˆ‡ç—…äººæ˜¯å¦åŒ¹é…
    - Body: { blood_unit_id, patient_id }
    - Returns: { match: true/false, details: { blood_type_match, patient_match, expiry_valid } }

GET /api/blood/custody/pending
    - å–å¾—å¾…å®Œæˆçš„ç›£ç®¡éˆ (å¦‚ï¼šå·²ç™¼è¡€ä½†å°šæœªé–‹å§‹è¼¸è¡€)
    - Query: ?location=OR-3&status=IN_CLINICAL_AREA
```

---

## 5. UI è¨­è¨ˆ

### 5.1 éº»é†‰ PWA - è¼¸è¡€æµç¨‹æ•´åˆ

åœ¨ç¾æœ‰è¼¸è¡€ Modal ä¸­åŠ å…¥ç›£ç®¡éˆé©—è­‰ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ğŸ’‰ è¼¸è¡€è¨˜éŒ„                           [X]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 1: é¸æ“‡è¡€å“é¡å‹                                              â”‚ â”‚
â”‚  â”‚  [PRBC] [FFP] [PLT] [CRYO] [WB]                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 2: é¸æ“‡æˆ–æƒæè¡€è¢‹                                            â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ“± [    æƒæè¡€è¢‹æ¢ç¢¼    ]                                    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  è¡€åº«å¯ç”¨åº«å­˜ (3 è¢‹å¯ç”¨)                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ â–Œ BU-20260120-ABC123  O+  300ml   åˆ°æœŸ: 48h       [é¸æ“‡]     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â–Œ BU-20260119-DEF456  O+  300ml   åˆ°æœŸ: 72h       [é¸æ“‡]     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â–Œ BU-20260118-GHI789  O+  300ml   âš ï¸ åˆ°æœŸ: 12h    [é¸æ“‡]     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 3: é›™äººé©—è­‰ (Chain of Custody)                    [æ–°å¢å€å¡Š]  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  ğŸ” é©—è­‰çµæœ                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  âœ… è¡€å‹ç›¸ç¬¦: O+ = O+                                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  âœ… ç—…äººç›¸ç¬¦: ç‹å¤§æ˜ (P-12345)                                â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  âœ… è¡€è¢‹æœ‰æ•ˆ: å‰©é¤˜ 48 å°æ™‚                                    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  ğŸ‘¤ åŸ·è¡Œäººå“¡ 1: [æƒæBadge] æˆ– [    è¼¸å…¥å·¥è™Ÿ    ]   å¼µOO âœ“         â”‚ â”‚
â”‚  â”‚  ğŸ‘¤ è¦†æ ¸äººå“¡ 2: [æƒæBadge] æˆ– [    è¼¸å…¥å·¥è™Ÿ    ]   ______         â”‚ â”‚
â”‚  â”‚                                                                     â”‚ â”‚
â”‚  â”‚  âš ï¸ éœ€å…©ä½äººå“¡ç¢ºèªå¾Œæ‰å¯é–‹å§‹è¼¸è¡€                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Step 4: è¼¸è¡€å‹•ä½œ                                                  â”‚ â”‚
â”‚  â”‚  [ é–‹å§‹è¼¸è¡€ ]  [ è¼¸è¡€å®Œæˆ ]  [ è¼¸è¡€åæ‡‰ ]                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚                      [        è¨˜éŒ„è¼¸è¡€        ]                          â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è¡€å‹ä¸ç¬¦è­¦å‘Š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â›” è¡€å‹ä¸ç¬¦è­¦å‘Š                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚                           ğŸš¨ è¡€å‹ä¸ç¬¦ï¼                                  â”‚
â”‚                                                                          â”‚
â”‚        è¡€è¢‹è¡€å‹: A+                                                      â”‚
â”‚        ç—…äººè¡€å‹: O+                                                      â”‚
â”‚                                                                          â”‚
â”‚        âš ï¸ è«‹ç«‹å³åœæ­¢ï¼Œç¢ºèªæ˜¯å¦æ‹¿éŒ¯è¡€è¢‹                                  â”‚
â”‚                                                                          â”‚
â”‚                      [     æˆ‘äº†è§£ï¼Œé—œé–‰     ]                            â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ç›£ç®¡éˆæ™‚é–“è»¸ (Audit View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ è¡€è¢‹è¿½è¹¤: BU-20260120-ABC123                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  O+ PRBC 300ml â”‚ ç—…äºº: ç‹å¤§æ˜ (P-12345) â”‚ æ‰‹è¡“: è‚è‡Ÿåˆ‡é™¤                â”‚
â”‚                                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                          â”‚
â”‚  14:00  â—‹â”€â”€â”€â”€â”€â”€  è¡€åº«ç™¼è¡€                                               â”‚
â”‚         â”‚        åŸ·è¡Œ: é™³OO (BB-001) + æ—OO (BB-002)                    â”‚
â”‚         â”‚        åœ°é»: è¡€åº«                                              â”‚
â”‚         â”‚                                                                â”‚
â”‚  14:05  â—‹â”€â”€â”€â”€â”€â”€  å‚³é€å–è¡€                                               â”‚
â”‚         â”‚        å‚³é€: ç‹OO (TR-015)                                     â”‚
â”‚         â”‚        åœ°é»: è¡€åº«                                              â”‚
â”‚         â”‚                                                                â”‚
â”‚  14:12  â—‹â”€â”€â”€â”€â”€â”€  è­·ç†æ”¶è¡€                                               â”‚
â”‚         â”‚        åŸ·è¡Œ: å¼µOO (RN-042) + æOO (RN-018)                    â”‚
â”‚         â”‚        åœ°é»: OR-3 æ‰‹è¡“å®¤                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚  14:32  â—‹â”€â”€â”€â”€â”€â”€  é–‹å§‹è¼¸è¡€                                               â”‚
â”‚         â”‚        åŸ·è¡Œ: å¼µOO (RN-042) + é™³é†«å¸« (MD-007)                  â”‚
â”‚         â”‚        åœ°é»: OR-3 æ‰‹è¡“å®¤                                       â”‚
â”‚         â”‚                                                                â”‚
â”‚  15:47  â—â”€â”€â”€â”€â”€â”€  è¼¸è¡€å®Œæˆ                                               â”‚
â”‚                  è¼¸è¡€æ™‚é–“: 75 åˆ†é˜                                       â”‚
â”‚                  è¼¸è¡€åæ‡‰: ç„¡                                            â”‚
â”‚                                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ç¸½æ™‚é–“: ç™¼è¡€â†’è¼¸å®Œ 107 åˆ†é˜                                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. å¯¦ä½œéšæ®µ

### Phase 1: åŸºç¤é©—è­‰ (MVP)

| é …ç›® | PWA | èªªæ˜ |
|------|-----|------|
| è¡€è¢‹-ç—…äººé©—è­‰ API | Backend | `/api/blood/verify` endpoint |
| è¼¸è¡€å‰é©—è­‰ UI | Anesthesia | é¸æ“‡è¡€è¢‹å¾Œé¡¯ç¤ºé©—è­‰çµæœ |
| è¡€å‹ä¸ç¬¦è­¦å‘Š | Anesthesia | ç´…è‰²è­¦å‘Š Modal |

### Phase 2: é›™äººæ ¸å°

| é …ç›® | PWA | èªªæ˜ |
|------|-----|------|
| å“¡å·¥ Badge æƒæ | All | æ”¯æ´æ¢ç¢¼/QR æƒæå“¡å·¥è­˜åˆ¥ |
| é›™äººç°½æ ¸ UI | Anesthesia | å…©äººéƒ½ç¢ºèªå¾Œæ‰èƒ½åŸ·è¡Œ |
| ç›£ç®¡éˆäº‹ä»¶è¨˜éŒ„ | Backend | `/api/blood/units/{id}/custody` |

### Phase 3: å®Œæ•´è¿½è¹¤

| é …ç›® | PWA | èªªæ˜ |
|------|-----|------|
| è¡€åº«ç™¼è¡€æµç¨‹ | Blood Bank | åŠ å…¥é›™äººæ ¸å° |
| å‚³é€è¿½è¹¤ | Transport (æ–°) | ç°¡æ˜“å‚³é€ PWA æˆ–æ•´åˆè¡€åº« PWA |
| ç›£ç®¡éˆæ™‚é–“è»¸ | All | è¦–è¦ºåŒ–è¿½è¹¤ UI |
| å ±è¡¨åŒ¯å‡º | Admin | è¼¸è¡€è¨˜éŒ„å®Œæ•´å ±è¡¨ |

### Phase 4: é€²éšåŠŸèƒ½

| é …ç›® | PWA | èªªæ˜ |
|------|-----|------|
| ç—…äººæ‰‹ç’° QR æƒæ | Anesthesia | åºŠé‚Šå†ç¢ºèª |
| èªéŸ³ç¢ºèª | All | ç³»çµ±å”¸å‡ºç—…äººå§“åä¾›ç¢ºèª |
| è¼¸è¡€åæ‡‰å³æ™‚è¨˜éŒ„ | Anesthesia | 15 åˆ†é˜å…§è§€å¯Ÿè¨˜éŒ„ |
| é€¾æ™‚è­¦ç¤º | All | è¡€è¢‹å‡ºè¡€åº«è¶…é 30 åˆ†é˜æœªè¼¸è¡€æé†’ |

---

## 7. æŠ€è¡“è€ƒé‡

### 7.1 é›¢ç·šæ”¯æ´

```javascript
// é›¢ç·šæ™‚æš«å­˜ç›£ç®¡éˆäº‹ä»¶ï¼Œé€£ç·šå¾ŒåŒæ­¥
const pendingCustodyEvents = [];

async function recordCustodyEvent(event) {
    if (navigator.onLine) {
        return await apiFetch('/api/blood/custody', {
            method: 'POST',
            body: event
        });
    } else {
        // é›¢ç·šæš«å­˜
        event.offline_recorded = true;
        event.offline_timestamp = new Date().toISOString();
        pendingCustodyEvents.push(event);
        localStorage.setItem('pending_custody_events', JSON.stringify(pendingCustodyEvents));
        return { queued: true, event };
    }
}

// é€£ç·šå¾ŒåŒæ­¥
window.addEventListener('online', async () => {
    const pending = JSON.parse(localStorage.getItem('pending_custody_events') || '[]');
    for (const event of pending) {
        await apiFetch('/api/blood/custody', { method: 'POST', body: event });
    }
    localStorage.removeItem('pending_custody_events');
});
```

### 7.2 æ¢ç¢¼æƒæ

```javascript
// ä½¿ç”¨ HTML5 MediaDevices API + æ¢ç¢¼è§£ç¢¼åº« (å¦‚ ZXing)
async function scanBarcode(type = 'blood_unit') {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
    // ... æƒæé‚è¼¯
    // ä¾ type é©—è­‰æ¢ç¢¼æ ¼å¼
    // blood_unit: BU-YYYYMMDD-XXXXXXXX
    // employee: EMP-XXXXX
    // patient: P-XXXXX æˆ– é†«é™¢ç‰¹å®šæ ¼å¼
}
```

### 7.3 å®‰å…¨æ€§

- æ‰€æœ‰ç›£ç®¡éˆäº‹ä»¶ä¸å¯åˆªé™¤ï¼Œåƒ…å¯æ–°å¢
- äº‹ä»¶éœ€å«æ™‚é–“æˆ³è¨˜ + è¨­å‚™ ID + æ“ä½œè€… ID
- ç•°å¸¸æ“ä½œ (å¦‚è·³éæ­¥é©Ÿ) éœ€è¨˜éŒ„åŸå› 

---

## 8. æª”æ¡ˆè®Šæ›´è¦åŠƒ

| æª”æ¡ˆ | è®Šæ›´ |
|------|------|
| `routes/blood.py` | æ–°å¢ `/custody` endpoints |
| `frontend/anesthesia/index.html` | è¼¸è¡€ Modal åŠ å…¥é©—è­‰ UI |
| `frontend/blood/index.html` | ç™¼è¡€æµç¨‹åŠ å…¥é›™äººæ ¸å° |
| `models/blood.py` | æ–°å¢ `BloodCustodyEvent` model |
| `frontend/shared/barcode-scanner.js` | å…±ç”¨æ¢ç¢¼æƒææ¨¡çµ„ (æ–°æª”æ¡ˆ) |

---

## ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´ |
|------|------|------|
| v1.0.0 | 2026-01-20 | åˆç‰ˆï¼šæµç¨‹è¨­è¨ˆã€è³‡æ–™æ¨¡å‹ã€UI è¦åŠƒ |

---

**æ–‡ä»¶å®Œæˆ**
**æ’°å¯«è€…**: Claude Code
**æ—¥æœŸ**: 2026-01-20
