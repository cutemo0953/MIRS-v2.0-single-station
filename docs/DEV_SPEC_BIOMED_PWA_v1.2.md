# BioMed PWA é–‹ç™¼è¦æ ¼æ›¸ v1.2

**ç‰ˆæœ¬**: 1.2.1
**æ—¥æœŸ**: 2026-01-11
**ç‹€æ…‹**: Production Ready

---

## æ¦‚è¿°

BioMed PWA æ˜¯ MIRS ç³»çµ±çš„è¨­å‚™ç¶­è­·æ¨¡çµ„ï¼Œæä¾›è¼•é‡ç´šçš„è¨­å‚™ç®¡ç†ä»‹é¢ï¼Œå°ˆç‚ºç¾å ´äººå“¡è¨­è¨ˆã€‚

---

## ç‰ˆæœ¬æ­·å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´ |
|------|------|------|
| v1.0.0 | 2026-01-09 | åˆç‰ˆï¼šè¨­å‚™ç®¡ç† + éŸŒæ€§ä¼°ç®— |
| v1.1.0 | 2026-01-10 | MIRS é¢¨æ ¼ Tab å°èˆªé‡æ§‹ |
| v1.1.1 | 2026-01-11 | ä¿®å¾©ç¢ºèªæŒ‰éˆ• + éŸŒæ€§è³‡æºæ¸…å–® |
| v1.1.2 | 2026-01-11 | å–®ä½ç®¡ç†åŠŸèƒ½ + Alpine.js ç›¸å®¹æ€§ä¿®å¾© |
| v1.1.3 | 2026-01-11 | API è·¯å¾‘ä¿®æ­£ + equipment é…è‰² + Vercel å–®ä½ mock |
| v1.1.4 | 2026-01-11 | Per-unit check + level ç·¨è¼¯ + $nextTick ä¿®å¾© |
| v1.1.5 | 2026-01-11 | éŸŒæ€§è³‡æºä¿®å¾© (inventory.items) + datetime bug ä¿®å¾© + CIRS BIOMED ç«™é» |
| v1.1.6 | 2026-01-11 | ç‹€æ…‹ä¸‹æ‹‰é¸å–® + Vercel mock ä¸­æ–‡åŒ– |
| v1.2.0 | 2026-01-11 | **äº’å‹•å¼ç”Ÿå­˜è¨ˆç®—å™¨** - æƒ…å¢ƒè¼¸å…¥ + æœ¬åœ°è¨ˆç®— + ç›®æ¨™é”æˆç‡ |
| v1.2.1 | 2026-01-11 | **é†«ç™‚ç´š O2 å…¬å¼** - ç­‰æ•ˆäººæ•¸ + æ°§æ°£æ¿ƒç¸®æ©Ÿ + è¨­å‚™ç›´æ¥ç¢ºèª + refreshKey ä¿®å¾© |

---

## æ¶æ§‹

### æª”æ¡ˆçµæ§‹

```
frontend/biomed/
â”œâ”€â”€ index.html          # ä¸»é é¢ (Alpine.js SPA)
â”œâ”€â”€ manifest.json       # PWA manifest
â”œâ”€â”€ service-worker.js   # SW v1.2.0
â””â”€â”€ icons/
    â”œâ”€â”€ icon-192.png
    â””â”€â”€ icon-512.png
```

### æŠ€è¡“å †ç–Š

- **å‰ç«¯æ¡†æ¶**: Alpine.js (CDN â†’ æœ¬åœ°åŒ–)
- **CSS**: Tailwind CSS (æœ¬åœ°åŒ–)
- **é›¢ç·šæ”¯æ´**: Service Worker (Network-first + cache fallback)

---

## åŠŸèƒ½æ¨¡çµ„

### 1. è¨­å‚™ç®¡ç† Tab

#### è¨­å‚™åˆ†é¡é¡¯ç¤º

| å€å¡Š | æ¢ä»¶ | é¡è‰² |
|------|------|------|
| ä¾›é›»è¨­å‚™ | `resilience_category='POWER'` æˆ–åç¨±å«ç™¼é›»æ©Ÿ/é›»æ± /UPS | equipment-900 (æ·±) |
| è€—é›»è¨­å‚™ | `power_consumption > 0` æˆ– `resilience_category='OXYGEN'` | equipment-700 |
| å…¶ä»–è¨­å‚™ | ä¸å±¬æ–¼ä¸Šè¿°å…©é¡ | equipment-600 |

#### è¨­å‚™æ“ä½œæŒ‰éˆ•

| æŒ‰éˆ• | åœ–ç¤º | åŠŸèƒ½ | API |
|------|------|------|-----|
| ç¢ºèª | âœ“ | æ¨™è¨˜è¨­å‚™å·²æª¢æŸ¥ | `POST /api/equipment/check/{id}` |
| ç·¨è¼¯ | âœ | é–‹å•Ÿç·¨è¼¯ Modal | - |
| åˆªé™¤ | âœ• | åˆªé™¤è¨­å‚™ | `DELETE /api/equipment/{id}` |

#### å–®ä½ç‹€æ…‹ä¸‹æ‹‰é¸å–® (v1.1.6)

æ¯å€‹å–®ä½å¯é€éä¸‹æ‹‰é¸å–®ç›´æ¥ä¿®æ”¹ç‹€æ…‹ï¼š

```html
<select x-model="unit.status" @change="updateUnitStatus(unit)">
    <option value="AVAILABLE">å‚™ç”¨</option>
    <option value="IN_USE">ä½¿ç”¨ä¸­</option>
    <option value="CHARGING">å……é›»ä¸­</option>
    <option value="MAINTENANCE">ç¶­ä¿®ä¸­</option>
    <option value="EMPTY">å·²ç”¨å®Œ</option>
</select>
```

å‘¼å« `POST /api/v2/equipment/units/{id}/check` æ›´æ–°ç‹€æ…‹ã€‚

### 2. å–®ä½ç®¡ç†åŠŸèƒ½ (v1.1.2)

#### UI å…ƒä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å–®ä½ç®¡ç† - {è¨­å‚™åç¨±}        [X]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¿«é€Ÿæ•¸é‡èª¿æ•´                         â”‚
â”‚ [âˆ’]  [ 5 ]  [+]  [å¥—ç”¨]             â”‚
â”‚ ç›®å‰: 5 å€‹å–®ä½ â†’ 6                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¾æœ‰å–®ä½ (5)                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ GEN-001  100%  [AVAILABLE] [ğŸ—‘]â”‚ â”‚
â”‚ â”‚ GEN-002   85%  [IN_USE]    [ğŸ—‘]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç§»é™¤åŸå› ï¼ˆå¯é¸ï¼‰                     â”‚
â”‚ [________________________]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–°å¢å–®ä½                             â”‚
â”‚ é›»é‡% [100] ç‹€æ…‹ [AVAILABLEâ–¼] [+æ–°å¢]â”‚
â”‚ æ–°å¢åŸå›  [________________________] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¶ å·²ç§»é™¤å–®ä½ (2)                     â”‚
â”‚   GEN-003 (å·²ç§»é™¤: è¨­å‚™æ•…éšœ) [æ¢å¾©]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            [é—œé–‰]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### API ç«¯é»

| ç«¯é» | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/v2/equipment/{id}/units` | GET | å–å¾—å–®ä½åˆ—è¡¨ (å« inactive) |
| `/v2/equipment/{id}/units` | POST | æ–°å¢å–®ä½ |
| `/v2/equipment/units/{id}` | DELETE | è»Ÿåˆªé™¤å–®ä½ |
| `/v2/equipment/units/{id}/restore` | POST | æ¢å¾©å–®ä½ |
| `/v2/equipment/{id}/quantity` | PUT | æ‰¹æ¬¡èª¿æ•´æ•¸é‡ |

#### å–®ä½ç‹€æ…‹

| ç‹€æ…‹ | é¡è‰² | èªªæ˜ |
|------|------|------|
| AVAILABLE | green | å¯ç”¨ |
| IN_USE | blue | ä½¿ç”¨ä¸­ |
| CHARGING | yellow | å……é›»ä¸­ |
| MAINTENANCE | gray | ç¶­è­·ä¸­ |
| EMPTY | red | é›»é‡è€—ç›¡ |

### 3. éŸŒæ€§ä¼°ç®— Tab

#### è³‡æ–™ä¾†æº (v1.1.5 ä¿®æ­£)

```javascript
// API Response çµæ§‹
// é‡è¦ï¼šä½¿ç”¨ inventory.itemsï¼Œä¸æ˜¯ resources
{
  "summary": { "overall_status": "WARNING" },
  "lifelines": [
    {
      "type": "OXYGEN",
      "name": "æ°§æ°£ä¾›æ‡‰",
      "endurance": { "hours": 36.5, "days": 1.52 },
      "inventory": {
        "items": [
          { "name": "Hå‹æ°§æ°£é‹¼ç“¶", "qty": 5, "avg_level": 80, "capacity_each": 6800 }
        ]
      }
    }
  ]
}

// å‰ç«¯æ¬„ä½æ˜ å°„
const resources = (lifeline.inventory?.items || []).map(item => ({
    name: item.name,
    quantity: item.qty,           // API: qty
    fill_pct: item.avg_level,     // API: avg_level
    capacity_L: item.capacity_each // API: capacity_each
}));
```

### 4. äº’å‹•å¼ç”Ÿå­˜è¨ˆç®—å™¨ (v1.2.0 + v1.2.1)

åŸºæ–¼ Gemini å›é¥‹ï¼ŒéŸŒæ€§ Tab å¾ã€Œéœæ…‹æ¸…å–®ã€å‡ç´šç‚ºã€Œäº’å‹•å¼ç”Ÿå­˜è¨ˆç®—å™¨ã€ã€‚

#### æƒ…å¢ƒè¼¸å…¥æ§åˆ¶é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒ…å¢ƒè¨­å®š                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é è¨ˆå­¤ç«‹å¤©æ•¸        å‘¼å¸å™¨é‹è½‰ (é›»åŠ›)                       â”‚
â”‚ [âˆ’] [ 3 ] [+]      [âˆ’] [ 0 ] [+]                        â”‚
â”‚ ç›®æ¨™: 72h           +50W/å°                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ°§æ°£æ¶ˆè€— (ç­‰æ•ˆäººæ•¸å…¬å¼)                    [v1.2.1 æ–°å¢]   â”‚
â”‚ é¼»å°ç®¡    é¢ç½©      æ’ç®¡      æ¿ƒç¸®æ©Ÿ                       â”‚
â”‚ [âˆ’][0][+] [âˆ’][0][+] [âˆ’][0][+] [âˆ’][0][+]                  â”‚
â”‚  0.3äºº     0.6äºº     1.0äºº    -5L/min                    â”‚
â”‚                                                          â”‚
â”‚ ç­‰æ•ˆäººæ•¸: 0.0 äºº = 0.0 L/min                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Alpine.js ç‹€æ…‹è®Šæ•¸

```javascript
// v1.2.1 æ–°å¢ (é†«ç™‚ç´šæ°§æ°£ç­‰æ•ˆäººæ•¸å…¬å¼)
isolationDays: 3,          // é è¨ˆå­¤ç«‹å¤©æ•¸ (ç›®æ¨™: 1-14 å¤©)
cannulaCount: 0,           // é¼»å°ç®¡äººæ•¸ (0.3äºº = 3 L/min)
maskCount: 0,              // é¢ç½©äººæ•¸ (0.6äºº = 6 L/min)
ventilatorO2Count: 0,      // æ’ç®¡/å‘¼å¸å™¨äººæ•¸ (1.0äºº = 10 L/min)
concentratorCount: 0,      // æ°§æ°£æ¿ƒç¸®æ©Ÿé‹è½‰æ•¸ (æ¸›å°‘ç“¶è£æ°§æ¶ˆè€—)
ventilatorCount: 0,        // å‘¼å¸å™¨é‹è½‰æ•¸ (å½±éŸ¿é›»åŠ›è² è¼‰)
useLocalCalculation: false, // æœ¬åœ°è¨ˆç®—æ¨¡å¼é–‹é—œ
powerLoadBase: 100,        // åŸºç¤é›»åŠ›è² è¼‰ (W)
resilienceRefreshKey: 0,   // refreshKey for forcing DOM update
equipmentRefreshKey: 0,    // refreshKey for equipment tab
```

#### è¨ˆç®—å…¬å¼ (v1.2.1 é†«ç™‚ç´š)

| é …ç›® | å…¬å¼ | èªªæ˜ |
|------|------|------|
| **ç­‰æ•ˆäººæ•¸** | `cannula Ã— 0.3 + mask Ã— 0.6 + ventilator Ã— 1.0` | é†«ç™‚ç´š O2 æ¶ˆè€—å…¬å¼ |
| **æ°§æ°£æ¶ˆè€—ç‡** | `ç­‰æ•ˆäººæ•¸ Ã— 10 - concentrator Ã— 5` L/min | æ¿ƒç¸®æ©Ÿæ¯å°ç¯€çœ 5 L/min |
| é›»åŠ›è² è¼‰ | `100 + (ventilatorCount Ã— 50)` W | åŸºç¤ 100W + æ¯å°å‘¼å¸å™¨ 50W |
| æ°§æ°£æ™‚æ•¸ | `totalLiters / consumptionLPM / 60` | ç¸½å…¬å‡ / æ¶ˆè€—ç‡ / 60åˆ† |
| é›»åŠ›æ™‚æ•¸ | `totalWh / loadWatts` | ç¸½ç“¦æ™‚ / è² è¼‰ç“¦æ•¸ |
| ç”Ÿå­˜æ™‚æ•¸ | `MIN(æ°§æ°£æ™‚æ•¸, é›»åŠ›æ™‚æ•¸)` | å–æœ€å¼±ä¸€ç’° |

#### O2 ç­‰æ•ˆäººæ•¸åƒè€ƒè¡¨

| ä¾›æ°§æ–¹å¼ | æµé‡ | ç­‰æ•ˆäººæ•¸ |
|----------|------|----------|
| é¼»å°ç®¡ (Nasal Cannula) | ~3 L/min | 0.3 |
| é¢ç½© (Mask) | ~6 L/min | 0.6 |
| æ’ç®¡/å‘¼å¸å™¨ (Ventilator) | ~10 L/min | 1.0 |
| æ°§æ°£æ¿ƒç¸®æ©Ÿ | ç”¢å‡º 5 L/min | æ¸›å°‘ç“¶è£æ°§æ¶ˆè€— |

#### é€²åº¦æ¢è‰²ç¢¼

| æ¢ä»¶ | é¡è‰² | èªªæ˜ |
|------|------|------|
| `hours >= isolationDays Ã— 24` | ç¶ è‰² | é”æˆç›®æ¨™ |
| `hours >= 24` | é»ƒè‰² | æœªé”ç›®æ¨™ä½†è¶…é 24h |
| `hours < 24` | ç´…è‰² | å±æ€¥ (< 24h) |

#### æœ¬åœ°è¨ˆç®—æ¨¡å¼

ç•¶ `useLocalCalculation = true` æ™‚:
- ä¸ä¾è³´ä¼ºæœå™¨ API è¨ˆç®—çµæœ
- ä½¿ç”¨è¨­å‚™æ¸…å–®å³æ™‚è¨ˆç®—ç”Ÿå­˜æ™‚æ•¸
- é¡¯ç¤ºæ¶ˆè€—/è² è¼‰è©³ç´°è³‡è¨Š
- é©ç”¨æ–¼é›¢ç·šç’°å¢ƒæˆ–æƒ…å¢ƒè¦åŠƒ

```javascript
getOxygenHours() {
    if (this.useLocalCalculation) {
        // å¾è³‡æºæ¸…å–®è¨ˆç®—ç¸½å…¬å‡
        let totalLiters = oxygenResources.reduce((sum, res) => {
            return sum + (res.quantity * res.capacity_L * res.fill_pct / 100);
        }, 0);
        return totalLiters / this.getOxygenConsumptionLPM() / 60;
    } else {
        return this.resilienceStatus.oxygen?.hours || 0;
    }
}
```

#### UI é¡¯ç¤º

- **æ•´é«”éŸŒæ€§æ™‚æ•¸**: é¡¯ç¤ºæœ€å¼±ç”Ÿå‘½ç·š
- **æ°§æ°£å¡ç‰‡**: æ™‚æ•¸ + é€²åº¦æ¢ + è³‡æºæ¸…å–®
- **é›»åŠ›å¡ç‰‡**: æ™‚æ•¸ + é€²åº¦æ¢ + è³‡æºæ¸…å–®

#### éŸŒæ€§ Tab è¨­å‚™ç›´æ¥ç¢ºèª (v1.2.1)

åœ¨éŸŒæ€§ä¼°ç®— Tab ä¸­å¯ç›´æ¥ç¢ºèªè³‡æºè¨­å‚™ï¼Œç„¡éœ€åˆ‡æ›åˆ°è¨­å‚™ç®¡ç† Tabï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ°§æ°£ä¾›æ‡‰                                  48.0h â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  65% é”æ¨™â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Hå‹æ°§æ°£é‹¼ç“¶ x5              80%   [ç¢ºèª]    â”‚ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘            â”‚ â”‚
â”‚ â”‚ 6800L                                        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ Eå‹æ°§æ°£ç“¶ x4                65%   [ç¢ºèª]    â”‚ â”‚
â”‚ â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘              â”‚ â”‚
â”‚ â”‚ 680L                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é¡è‰²é…è‰² (v1.2.1)

| è³‡æºé¡å‹ | åŸé¡è‰² | æ–°é¡è‰² | èªªæ˜ |
|----------|--------|--------|------|
| æ°§æ°£ | è—è‰² (`text-blue-500`) | æ©˜è‰² (`text-orange-500`) | é¿å…èˆ‡æ°´æ··æ·† |
| é›»åŠ› | é»ƒè‰² (`text-yellow-500`) | é»ƒè‰² | ç¶­æŒ |

æ°§æ°£è³‡æºå¡ç‰‡ä½¿ç”¨æ©˜è‰²æ¼¸å±¤èƒŒæ™¯ (`bg-orange-50`, `border-orange-100`)ã€‚

#### refreshKey æ¨¡å¼ (v1.2.1)

è§£æ±º Vercel ç’°å¢ƒç¢ºèªè¨­å‚™å¾Œç‹€æ…‹æœªå³æ™‚æ›´æ–°çš„å•é¡Œï¼š

```javascript
// State
resilienceRefreshKey: 0,
equipmentRefreshKey: 0,

// ç¢ºèªè¨­å‚™å¾Œéå¢ refreshKey
await this.loadEquipment();
await this.loadResilienceStatus();
this.equipmentRefreshKey++;
this.resilienceRefreshKey++;

// Template ä½¿ç”¨ refreshKey å¼·åˆ¶é‡æ–°æ¸²æŸ“
<template x-for="eq in getPowerSupplyEquipment()"
          :key="eq.id + '-' + equipmentRefreshKey">
```

#### Alpine.js ç›¸å®¹æ€§ä¿®å¾© (v1.1.2)

```javascript
// éŒ¯èª¤ (æŸäº› Alpine ç‰ˆæœ¬ä¸æ”¯æ´)
x-show="resilienceStatus.oxygenResources?.length > 0"

// æ­£ç¢º
x-show="resilienceStatus.oxygenResources && resilienceStatus.oxygenResources.length > 0"
```

---

## Vercel Demo æ¨¡å¼

ç•¶ `IS_VERCEL=1` æ™‚ï¼ŒAPI è¿”å›æ¨¡æ“¬è³‡æ–™ï¼š

### /api/equipment

è¿”å› 5 å€‹æ¨¡æ“¬è¨­å‚™ï¼ˆç™¼é›»æ©Ÿã€æ°§æ°£ç“¶ç­‰ï¼‰

### /api/resilience/status (v1.1.5 ä¿®æ­£çµæ§‹, v1.1.6 ä¸­æ–‡åŒ–)

```python
# v1.1.5: ä½¿ç”¨ inventory.items çµæ§‹ (èˆ‡çœŸå¯¦ API ä¸€è‡´)
# v1.1.6: è¨­å‚™åç¨±ä¸­æ–‡åŒ–
return {
    "summary": {"overall_status": "OK", "worst_lifeline_hours": 48},
    "lifelines": [
        {
            "type": "OXYGEN",
            "name": "æ°§æ°£ä¾›æ‡‰",
            "endurance": {"hours": 48, "days": 2},
            "inventory": {
                "items": [
                    {"name": "Hå‹æ°§æ°£é‹¼ç“¶", "qty": 5, "avg_level": 80, "capacity_each": 6800},
                    {"name": "Eå‹æ°§æ°£ç“¶", "qty": 4, "avg_level": 65, "capacity_each": 680}
                ]
            }
        },
        {
            "type": "POWER",
            "name": "é›»åŠ›ä¾›æ‡‰",
            "endurance": {"hours": 24, "days": 1},
            "inventory": {
                "items": [
                    {"name": "è¡Œå‹•é›»æºç«™", "qty": 2, "avg_level": 85, "capacity_each": 1800},  # v1.1.6: Bluetti AC180 â†’ è¡Œå‹•é›»æºç«™
                    {"name": "ç™¼é›»æ©Ÿ (å‚™ç”¨)", "qty": 1, "avg_level": 70, "capacity_each": 5000}
                ]
            }
        }
    ]
}
```

---

## Service Worker

### å¿«å–ç­–ç•¥

- **éœæ…‹è³‡æº**: Network-first, cache fallback
- **API è«‹æ±‚**: ä¸å¿«å– (ç›´æ¥èµ°ç¶²è·¯)

### ç‰ˆæœ¬ç®¡ç†

```javascript
const CACHE_NAME = 'mirs-biomed-v1.2.0';
```

æ›´æ–° Service Worker ç‰ˆæœ¬è™Ÿæœƒè§¸ç™¼èˆŠå¿«å–æ¸…é™¤ã€‚

---

## CIRS æ•´åˆ

### BIOMED ç«™é»é¡å‹ (v1.1.5)

**æª”æ¡ˆ**: `CIRS/backend/routes/auth.py`

```python
STATION_TYPES = {
    # ... å…¶ä»–ç«™é»
    'BIOMED': {'app': '/app/mirs/', 'sub_app': 'biomed'},
}
```

é…å° Modal ä½¿ç”¨ `cog` icon (é½’è¼ª)ï¼ŒèƒŒæ™¯ `bg-equipment-500` + ç™½è‰² iconã€‚

---

## Bug ä¿®å¾©

### datetime è®Šæ•¸ç¯„åœå•é¡Œ (v1.1.5)

**å•é¡Œ**:
```
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value
```

**æ ¹å› **: Python åœ¨ `if IS_VERCEL` å€å¡Šå…§ä½¿ç”¨ `from datetime import datetime`ï¼Œå°è‡´æ•´å€‹å‡½æ•¸å°‡ `datetime` è¦–ç‚º local variableã€‚é Vercel ç’°å¢ƒä¸‹è©²å€å¡Šä¸åŸ·è¡Œï¼Œé€ æˆè®Šæ•¸æœªç¶å®šã€‚

**è§£æ±º**: ç§»é™¤ local importï¼Œä½¿ç”¨ module-level datetimeã€‚

```python
# ä¿®å¾©å‰ (éŒ¯èª¤)
if IS_VERCEL:
    from datetime import datetime
    return {..., "last_check": datetime.now().isoformat()}
# ...
now_utc = datetime.utcnow()  # â† æ­¤è™•å¼•ç”¨ local datetime (æœªå®šç¾©)

# ä¿®å¾©å¾Œ (æ­£ç¢º)
if IS_VERCEL:
    # ç›´æ¥ä½¿ç”¨ module-level datetime
    return {..., "last_check": datetime.now().isoformat()}
```

---

## æ¸¬è©¦æ¸…å–®

### Vercel ç’°å¢ƒ

- [x] è¨­å‚™åˆ—è¡¨è¼‰å…¥
- [x] ç¢ºèªæŒ‰éˆ• (âœ“) æ­£å¸¸é‹ä½œ
- [x] éŸŒæ€§ä¼°ç®— Tab é¡¯ç¤ºæ°§æ°£/é›»åŠ›è³‡æº
- [x] éŸŒæ€§è³‡æºæ¸…å–®é¡¯ç¤º (inventory.items)
- [x] é€²åº¦æ¢é¡¯ç¤º
- [x] è¨­å‚™åç¨±ä¸­æ–‡åŒ– (è¡Œå‹•é›»æºç«™)
- [x] å–®ä½ç®¡ç† Modal é–‹å•Ÿ
- [x] å–®ä½ç‹€æ…‹ä¸‹æ‹‰é¸å–®

### RPi ç’°å¢ƒ

- [x] è¨­å‚™åˆ—è¡¨å¾æœ¬åœ° DB è¼‰å…¥
- [x] ç¢ºèªæŒ‰éˆ•æ›´æ–°è³‡æ–™åº«
- [x] å–®ä½ç®¡ç†å®Œæ•´ CRUD
- [x] éŸŒæ€§ä¼°ç®—å³æ™‚è¨ˆç®—
- [x] ç‹€æ…‹ä¸‹æ‹‰é¸å–®ä¿®æ”¹
- [ ] ç¢ºèªå¾Œè¨­å‚™æ¸…å–®ç‹€æ…‹å³æ™‚æ›´æ–°
- [ ] manifest.json è·¯ç”± (ç›®å‰ 404)
- [ ] é›¢ç·šæ¨¡å¼é‹ä½œ

### CIRS æ•´åˆ

- [x] BIOMED ç«™é»é…å°
- [x] é…å° Modal é½’è¼ª icon é¡¯ç¤º

---

## å¾…è§£æ±ºå•é¡Œ

### P1 (é«˜å„ªå…ˆ)

| å•é¡Œ | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| ç¢ºèªå¾Œè¨­å‚™ç‹€æ…‹æœªå³æ™‚æ›´æ–° | èª¿æŸ¥ä¸­ | `loadEquipment()` å·²å‘¼å«ï¼Œå¯èƒ½æ˜¯ API çš„ `check_status` è¨ˆç®—é‚è¼¯å•é¡Œ |

### P2 (ä¸­å„ªå…ˆ)

| å•é¡Œ | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| manifest.json 404 | å¾…æŸ¥ | RPi ä¸Š BioMed PWA çš„ manifest.json è¿”å› 404 |
| è¨­å‚™é¡åˆ¥é¸æ“‡ | å¾…å¯¦ä½œ | æ–°å¢è¨­å‚™æ™‚çš„é¡åˆ¥ä¸‹æ‹‰é¸å–® |
| æ‰¹æ¬¡ç¢ºèª | å¾…å¯¦ä½œ | ä¸€éµç¢ºèªæ‰€æœ‰è¨­å‚™ |

---

## æ¶æ§‹é¢¨éšªè­¦ç¤º (v1.2.1 æ–°å¢)

åŸºæ–¼ Gemini æ‰¹åˆ¤æ€§å›é¥‹ï¼Œä»¥ä¸‹æ¶æ§‹æ±ºç­–å­˜åœ¨é•·æœŸé¢¨éšªï¼š

### 1. SQLite In-Memory + Serverless è³‡æ–™ä¸ä¸€è‡´é¢¨éšª

**ç¾æ³**: Vercel Demo æ¨¡å¼ä½¿ç”¨ SQLite In-Memory singletonã€‚

**é¢¨éšª**:
- Serverless ç’°å¢ƒä¸­ï¼ŒVercel æœƒåŒæ™‚é–‹å•Ÿå¤šå€‹ Function Instances
- æ¯å€‹ Instance æœ‰ç¨ç«‹çš„è¨˜æ†¶é«”ç©ºé–“ = **N å€‹ç¨ç«‹è³‡æ–™åº«**
- A é†«ç”Ÿåœ¨ Instance 1 å¯«å…¥çš„è³‡æ–™ï¼ŒB è­·ç†å¸«è‹¥è¢«å°å‘ Instance 2 çœ‹ä¸åˆ°

**é©ç”¨ç¯„åœ**: **åƒ…é™å–®äºº Demo å±•ç¤º**ã€‚å¦‚æœè¦å¤šäººå”ä½œæ¸¬è©¦ï¼Œå¿…é ˆé·ç§»åˆ°å¤–éƒ¨è³‡æ–™åº«ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›®å‰æ¶æ§‹ (OK for Demo)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Inst 1 â”‚ â”‚ Inst 2 â”‚ â”‚ Inst 3 â”‚              â”‚
â”‚  â”‚ DB-A   â”‚ â”‚ DB-B   â”‚ â”‚ DB-C   â”‚  â† äº’ä¸ç›¸é€š  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿç”¢æ¶æ§‹ (Required for Production)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Inst 1 â”‚ â”‚ Inst 2 â”‚ â”‚ Inst 3 â”‚              â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚
â”‚      â”‚          â”‚          â”‚                    â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚               â–¼                                  â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚        â”‚ å¤–éƒ¨è³‡æ–™åº«     â”‚  â† Supabase/Neon/      â”‚
â”‚        â”‚ (Postgres)   â”‚     Vercel Postgres     â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Import Time Execution æ•ˆèƒ½å‚µ

**ç¾æ³**: `main.py` åœ¨ Global Scope åŸ·è¡Œ `init_db()` å’Œ `seeder`ã€‚

**é¢¨éšª**:
- æ¯æ¬¡ Cold Start éƒ½åŸ·è¡Œã€Œå»ºè¡¨ + å¡è³‡æ–™ã€
- Demo Data å¢å¤§æ™‚ï¼Œå•Ÿå‹•æ™‚é–“å¯èƒ½è¶…é Vercel 10s é™åˆ¶ â†’ Timeout

**æ”¹å–„æ–¹å‘**: Lazy Initialization (æƒ°æ€§åˆå§‹åŒ–)

```python
# ç›®å‰ (Anti-pattern)
if IS_VERCEL:
    init_db()          # â† æ¯æ¬¡ import éƒ½åŸ·è¡Œ
    seed_demo_data()

# æ”¹å–„ (Lazy Init)
_db_initialized = False

def ensure_db():
    global _db_initialized
    if not _db_initialized:
        init_db()
        seed_demo_data()
        _db_initialized = True

@app.get("/api/...")
async def some_api():
    ensure_db()  # â† åªåœ¨ç¬¬ä¸€æ¬¡ request æ™‚åŸ·è¡Œ
    ...
```

### 3. ä¾è³´ç®¡ç† Definition of Done

å¾ v1.2.1 èµ·ï¼Œæ¯æ¬¡å¼•å…¥æ–° Python Package æ™‚ï¼Œ**å¿…é ˆ**åŒæ­¥æ›´æ–° `api/requirements.txt`ã€‚

**DoD Checklist**:
- [ ] æ–°å¢ `import xxx`
- [ ] æ›´æ–° `api/requirements.txt`
- [ ] æœ¬åœ° `VERCEL=1` æ¨¡å¼æ¸¬è©¦é€šé

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.2.1
**æ’°å¯«è€…**: Claude Code
**æ—¥æœŸ**: 2026-01-11
