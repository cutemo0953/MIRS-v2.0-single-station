# MIRS è™•ç½® Tab UI é‡çµ„è¦æ ¼æ›¸

**Version:** 2.7.0
**Date:** 2026-01-03
**Status:** å·²å¯¦ä½œ

---

## 0. æ‘˜è¦

é‡çµ„ MIRS ä¸»é é¢è™•ç½® Tab çš„åŠŸèƒ½å€å¡Šé…ç½®ï¼š
1. ç§»é™¤ã€Œé ˜ç”¨ç™»è¨˜ã€æ¨¡å¼ï¼Œæ”¹ç‚ºã€Œè¡“å¼ä¸»æª”å¿«æŸ¥ã€å¯æ”¶åˆå€å¡Š
2. æ–°å¢ã€Œè¡“ä¸­ç”¨è—¥ã€è¼¸å…¥æ¬„ä½åˆ°ã€Œæ–°å¢è™•ç½®è€—æè¨˜éŒ„ã€è¡¨å–®
3. çµ±ä¸€è™•ç½®ç›¸é—œåŠŸèƒ½é…è‰²

### 0.1 è¨­è¨ˆæ±ºç­–

| è­°é¡Œ | æ±ºç­– | ç†ç”± |
|------|------|------|
| è¡“å¼ä¸»æª”æ˜¯å¦ç‚ºç¨ç«‹ Tabï¼Ÿ | **å¦ï¼Œæ”¾è™•ç½® Tab å…§** | è¡“å¼ä¸»æª”æ˜¯è™•ç½®è¨˜éŒ„çš„è¼”åŠ©åŠŸèƒ½ï¼Œä¸é ˆç¨ç«‹ Tab |
| é ˜ç”¨ç™»è¨˜åŠŸèƒ½æ˜¯å¦ä¿ç•™ï¼Ÿ | **æš«æ™‚ç§»é™¤** | Phase 2 å¯é‡æ–°è¨­è¨ˆç‚ºæ›´å®Œæ•´çš„è—¥å±€èª¿åŠ‘åŠŸèƒ½ |
| è¡“å¼ä¸»æª”é è¨­å±•é–‹ï¼Ÿ | **å¦ï¼Œé è¨­æ”¶åˆ** | æ¸›å°‘é é¢è² æ“”ï¼Œéœ€è¦æ™‚å†å±•é–‹ |

---

## 1. è®Šæ›´æè¿°

### 1.1 ç§»é™¤ã€Œé ˜ç”¨ç™»è¨˜ã€æ¨¡å¼

**ç§»é™¤åŸå› ï¼š**
- åŸã€Œé ˜ç”¨ç™»è¨˜ã€åŠŸèƒ½èˆ‡è™•ç½®è€—æè¨˜éŒ„é‡ç–Š
- å¾…æ—¥å¾Œè¦åŠƒå®Œæ•´è—¥å±€èª¿åŠ‘æµç¨‹å†é‡æ–°è¨­è¨ˆ

**å½±éŸ¿ç¯„åœï¼š**
- Tab å…§éƒ¨æ¨¡å¼åˆ‡æ›æŒ‰éˆ•ï¼ˆåŸä¸‰é¸ä¸€ â†’ æ”¹ç‚ºäºŒé¸ä¸€ï¼‰
- `treatmentMode` ç‹€æ…‹å€¼ç§»é™¤ `'dispense'` é¸é …

### 1.2 æ–°å¢ã€Œè¡“å¼ä¸»æª”å¿«æŸ¥ã€å€å¡Š

**ä½ç½®ï¼š** è™•ç½®è€—æè¨˜éŒ„ (`treatmentMode === 'surgery'`) åº•éƒ¨

**åŠŸèƒ½ï¼š**
| å­åŠŸèƒ½ | èªªæ˜ |
|--------|------|
| è¡“å¼ä»£ç¢¼æŸ¥è©¢ | åˆ†é¡ç¯©é¸ + FTS5 æœå°‹ï¼Œé¡¯ç¤ºä»£ç¢¼/åç¨±/é»æ•¸ |
| è‡ªè²»é …ç›®æŸ¥è©¢ | åˆ†é¡ç¯©é¸ + FTS5 æœå°‹ï¼Œé¡¯ç¤ºå“é …/å–®åƒ¹ |
| é»æ•¸è¨ˆç®—å™¨ | å¤šè¡“å¼çµ„åˆè¨ˆç®—ï¼ˆå«éæ¸›è¦å‰‡è¦–è¦ºåŒ–ï¼‰ |

**UI çµæ§‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è™•ç½®è€—æè¨˜éŒ„ (surgery mode)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å¾…è™•ç½®æ¸…å–®] [å·²å®Œæˆè¨˜éŒ„]                                    â”‚
â”‚ ...existing content...                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“‹ è¡“å¼ä¸»æª”å¿«æŸ¥ (é»æ“Šå±•é–‹/æ”¶åˆ)                    [â–¼] â”‚ â”‚ â† ç´«è‰²é‚Šæ¡†
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [è¡“å¼ä»£ç¢¼] [è‡ªè²»é …ç›®] [é»æ•¸è¨ˆç®—]  â† å­Tab             â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚ â”‚ â”‚ åˆ†é¡: [ä¸‹æ‹‰] æœå°‹: [____]                          â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ 64164B è‚¡éª¨é ¸éª¨æŠ˜é–‰é–æ€§å¾©ä½è¡“...    8,085é»  â”‚  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â”‚ 64266B è‚¡éª¨å¹¹éª¨æŠ˜é–‹æ”¾æ€§å¾©ä½è¡“...   16,167é»  â”‚  â”‚ â”‚ â”‚
â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ–°å¢ã€Œè¡“ä¸­ç”¨è—¥ã€æ¬„ä½

**ä½ç½®ï¼š** æ–°å¢è™•ç½®è€—æè¨˜éŒ„è¡¨å–®å…§

**åŠŸèƒ½ï¼š**
- å¸¸ç”¨è—¥ç‰©å¿«é¸æŒ‰éˆ•ï¼šMorphineã€Ketorolacã€Triamcinoloneã€Xylocaineã€Marcaine
- è‡ªè¨‚è—¥ç‰©è¼¸å…¥ï¼šè—¥ç‰©åç¨± + åŠ‘é‡ + å–®ä½
- è¡¨å–®é©—è­‰ï¼šè‡³å°‘éœ€æœ‰è€—ææˆ–è¡“ä¸­ç”¨è—¥å…¶ä¸€

**Alpine.js è³‡æ–™çµæ§‹ï¼š**
```javascript
intraopMeds: [
    // { name: 'Morphine 10mg', dose: '10', unit: 'mg', is_custom: false }
],
customMedName: '',
customMedDose: '',
customMedUnit: 'mg'
```

---

## 2. é…è‰²è¦ç¯„

### 2.1 Tab é…è‰²ç¶­æŒä¸è®Š

| Tab | è‰²ç³» | ä¸»è‰² |
|-----|------|------|
| åº«å­˜æŸ¥è©¢ | Blue | `bg-blue-500` |
| é€²è²¨ | Teal | `bg-teal-custom-500` |
| **è™•ç½®** | **Treatment** | **`#4E5488` (bg-treatment-500)** |
| è¡€è¢‹ç®¡ç† | Red | `bg-red-500` |
| è¨­å‚™ç®¡ç† | Emerald | `bg-emerald-500` |
| éŸŒæ€§ä¼°ç®— | Amber | `bg-amber-500` |

### 2.2 è¡“å¼ä¸»æª”å€å¡Šé…è‰²

**ä½¿ç”¨ Purple è‰²ç³»ï¼š**
```css
/* å®¹å™¨ */
.surgery-master-container {
    border: 2px solid var(--purple-300);  /* border-purple-300 */
    background: var(--purple-50);          /* bg-purple-50 */
}

/* æ¨™é¡Œ */
.surgery-master-title {
    color: var(--purple-700);              /* text-purple-700 */
}

/* å­Tab æŒ‰éˆ• (é¸ä¸­) */
.surgery-master-tab-active {
    background: var(--purple-600);         /* bg-purple-600 */
    color: white;
}

/* å­Tab æŒ‰éˆ• (æœªé¸ä¸­) */
.surgery-master-tab {
    background: var(--purple-100);         /* bg-purple-100 */
    color: var(--purple-700);              /* text-purple-700 */
}
```

### 2.3 è¡“ä¸­ç”¨è—¥å€å¡Šé…è‰²

**ä½¿ç”¨ Pharma è‰²ç³»ï¼š**
```css
/* å®¹å™¨ */
.intraop-meds-container {
    border: 2px dashed var(--pharma-300);  /* border-pharma-300 */
    background: var(--pharma-50);           /* bg-pharma-50 */
}

/* è—¥ç‰©å¿«é¸æŒ‰éˆ• */
.med-quick-btn {
    background: var(--pharma-100);
    color: var(--pharma-700);
    border: 1px solid var(--pharma-200);
}

.med-quick-btn:hover {
    background: var(--pharma-200);
}
```

---

## 3. æª”æ¡ˆè®Šæ›´æ¸…å–®

| æ“ä½œ | æª”æ¡ˆ | èªªæ˜ |
|------|------|------|
| ä¿®æ”¹ | `Index.html` | Tab é‡çµ„ã€è¡“å¼ä¸»æª”å€å¡Šã€è¡“ä¸­ç”¨è—¥æ¬„ä½ |
| ä¿®æ”¹ | `static/css/mirs-colors.css` | æ–°å¢ treatment-*, pharma-*, purple-* è‰²éš |
| ä¿®æ”¹ | `CHANGELOG.md` | v2.7.0 æ›´æ–°è¨˜éŒ„ |

---

## 4. Alpine.js ç‹€æ…‹è®Šæ›´

### 4.1 ç§»é™¤

```javascript
// treatmentMode ä¸å†åŒ…å« 'dispense'
// treatmentMode: 'surgery' | 'consume' | 'dispense'  // èˆŠ
treatmentMode: 'surgery' | 'consume'                   // æ–°
```

### 4.2 æ–°å¢

```javascript
// è¡“å¼ä¸»æª”å­ Tab
surgeryMasterSubTab: 'codes',  // 'codes' | 'selfpay' | 'calculator'

// è¡“å¼è³‡æ–™
surgeryCodes: [],
selfPayItems: [],
surgeryCategories: [],
selfPayCategories: [],
surgeryCodeSearchText: '',
selfPaySearchText: '',
surgeryMasterStats: { codes: 0, selfpay: 0, categories: 0 },

// é»æ•¸è¨ˆç®—å™¨
calculatorSurgeries: [],

// è¡“ä¸­ç”¨è—¥
intraopMeds: [],
customMedName: '',
customMedDose: '',
customMedUnit: 'mg'
```

### 4.3 æ–°å¢æ–¹æ³•

```javascript
// è¡“å¼ä¸»æª”
loadSurgeryMasterStats()      // è¼‰å…¥çµ±è¨ˆæ•¸æ“š
loadSurgeryCategories()       // è¼‰å…¥è¡“å¼åˆ†é¡
loadSurgeryCodes()            // è¼‰å…¥è¡“å¼åˆ—è¡¨ (åˆ†é )
searchSurgeryCodes()          // FTS5 æœå°‹è¡“å¼
loadSelfPayCategories()       // è¼‰å…¥è‡ªè²»åˆ†é¡
loadSelfPayItems()            // è¼‰å…¥è‡ªè²»é …ç›®
searchSelfPayItems()          // FTS5 æœå°‹è‡ªè²»

// é»æ•¸è¨ˆç®—å™¨
addToCalculator(surgery)      // æ–°å¢è¡“å¼åˆ°è¨ˆç®—å™¨
removeFromCalculator(index)   // ç§»é™¤è¡“å¼
calculateTotalPoints()        // è¨ˆç®—éæ¸›å¾Œç¸½é»æ•¸

// è¡“ä¸­ç”¨è—¥
addQuickMed(name)             // å¿«é¸å¸¸ç”¨è—¥
addCustomMed()                // æ–°å¢è‡ªè¨‚è—¥ç‰©
removeIntraopMed(index)       // ç§»é™¤è—¥ç‰©
```

---

## 5. API ä¾è³´

æœ¬æ¬¡ UI è®Šæ›´ä¾è³´ä»¥ä¸‹å·²å¯¦ä½œçš„ APIï¼š

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|------|------|------|
| `/api/surgery-codes/stats` | GET | è¡“å¼ä¸»æª”çµ±è¨ˆ |
| `/api/surgery-codes/categories` | GET | è¡“å¼åˆ†é¡åˆ—è¡¨ |
| `/api/surgery-codes/codes` | GET | è¡“å¼åˆ—è¡¨ (åˆ†é ) |
| `/api/surgery-codes/codes/search?q=` | GET | è¡“å¼ FTS5 æœå°‹ |
| `/api/surgery-codes/selfpay/categories` | GET | è‡ªè²»åˆ†é¡åˆ—è¡¨ |
| `/api/surgery-codes/selfpay` | GET | è‡ªè²»é …ç›®åˆ—è¡¨ |
| `/api/surgery-codes/selfpay/search?q=` | GET | è‡ªè²» FTS5 æœå°‹ |
| `/api/surgery-codes/calculate-points` | POST | é»æ•¸éæ¸›è¨ˆç®— |

---

## 6. éæ¸›è¦å‰‡èªªæ˜

### 6.1 å¥ä¿é»æ•¸éæ¸›è¦å‰‡

ä¾ã€Œå…¨æ°‘å¥åº·ä¿éšªé†«ç™‚æœå‹™çµ¦ä»˜é …ç›®åŠæ”¯ä»˜æ¨™æº–ã€ï¼š

**åŒé¡æ‰‹è¡“ï¼ˆåŒä¸€ `category_code`ï¼‰ï¼š**
| é †åº | çµ¦ä»˜æ¯”ä¾‹ |
|------|----------|
| ç¬¬ 1 é …ï¼ˆæœ€é«˜é»æ•¸ï¼‰ | 100% |
| ç¬¬ 2 é … | 50% |
| ç¬¬ 3 é … | 50% |
| ç¬¬ 4 é …ä»¥ä¸Š | 0% |

**ä¸åŒé¡æ‰‹è¡“ï¼ˆä¸åŒ `category_code`ï¼‰ï¼š**
| é †åº | çµ¦ä»˜æ¯”ä¾‹ |
|------|----------|
| ç¬¬ 1 é …ï¼ˆæœ€é«˜é»æ•¸ï¼‰ | 100% |
| ç¬¬ 2 é … | 100% |
| ç¬¬ 3 é … | 50% |
| ç¬¬ 4 é …ä»¥ä¸Š | 0% |

### 6.2 UI è¦–è¦ºåŒ–

è¨ˆç®—å™¨ä»¥é¡è‰²å€åˆ†çµ¦ä»˜æ¯”ä¾‹ï¼š
- ğŸŸ¢ 100%: `bg-green-100 text-green-800`
- ğŸŸ¡ 50%: `bg-yellow-100 text-yellow-800`
- ğŸ”´ 0%: `bg-red-100 text-red-800`

---

## 7. æœªä¾†è¦åŠƒ

### Phase 2: é ˜ç”¨ç™»è¨˜é‡æ–°è¨­è¨ˆ

è‹¥éœ€æ¢å¾©é ˜ç”¨åŠŸèƒ½ï¼Œå»ºè­°ï¼š
1. æ•´åˆè—¥å±€èª¿åŠ‘æµç¨‹ï¼ˆèˆ‡ CIRS è—¥å±€æ¨¡çµ„å°æ¥ï¼‰
2. æ”¯æ´æ‰¹æ¬¡é ˜ç”¨ï¼ˆå¤šç—…æ‚£å¤šè—¥å“ï¼‰
3. åº«å­˜é€£å‹•æ‰£æ¸›

### Phase 3: è¡“å¼ä¸»æª”é€²éšåŠŸèƒ½

1. è¡“å¼æ”¶è—å¤¾ï¼ˆå¸¸ç”¨è¡“å¼å¿«å–ï¼‰
2. è¡“å¼çµ„åˆåŒ…ï¼ˆé è¨­è¡“å¼+è€—æ+è—¥å“çµ„åˆï¼‰
3. æ­·å²é»æ•¸æŸ¥è©¢ï¼ˆè¿½è¹¤é»æ•¸è®ŠåŒ–ï¼‰

---

*æ–‡ä»¶çµæŸ*
