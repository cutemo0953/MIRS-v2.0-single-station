# MIRS Mobile PWA é–‹ç™¼è¦æ ¼æ›¸ v0.8

> å·¡æˆ¿åŠ©æ‰‹ï¼šé†«è­·äººå“¡çš„è¡Œå‹•ç‰©è³‡ç®¡ç†å·¥å…·

**ç‹€æ…‹**: Phase 1 å®Œæˆï¼ŒPhase 2 é–‹ç™¼ä¸­
**æ—¥æœŸ**: 2025-12-19
**ç‰ˆæœ¬**: 0.8 (è¡€è¢‹/è€—æå…¥åº«åŠŸèƒ½ + UI å„ªåŒ–)
**åƒè€ƒ**: CIRS Satellite PWA v1.3.1
**PWA ç‰ˆæœ¬**: 1.6.0

---

## è®Šæ›´è¨˜éŒ„

### v0.8 (2025-12-19) - è¡€è¢‹/è€—æå…¥åº«åŠŸèƒ½ + UI å„ªåŒ–
- **è¡€è¢‹å…¥åº«åŠŸèƒ½**ï¼š
  - 8 ç¨®è¡€å‹å¿«é€Ÿé¸æ“‡ï¼ˆAÂ±ã€BÂ±ã€OÂ±ã€ABÂ±ï¼‰
  - ä¾†æºé¸æ“‡ï¼šæè¡€ä¸­å¿ƒ / ç·Šæ€¥æè¡€è€…
  - ç·Šæ€¥æè¡€è€…æ™‚é¡¯ç¤ºå§“å/é›»è©±æ¬„ä½
  - æ•¸é‡èª¿æ•´ +/- æŒ‰éˆ•
  - é›¢ç·šæ”¯æ´ï¼šåŠ å…¥å¾…åŒæ­¥ä½‡åˆ—
  - API: `POST /api/mirs-mobile/v1/blood/receive`
- **è€—æå…¥åº«åŠŸèƒ½**ï¼š
  - ç‰©å“æœå°‹ï¼ˆå³æ™‚éæ¿¾åº«å­˜æ¸…å–®ï¼‰
  - æ‰¹è™Ÿ / æ•ˆæœŸé¸å¡«
  - æ•¸é‡èª¿æ•´ +/- æŒ‰éˆ•
  - é›¢ç·šæ”¯æ´ï¼šåŠ å…¥å¾…åŒæ­¥ä½‡åˆ—
  - API: `POST /api/mirs-mobile/v1/items/receive`
- **æŒ‰éˆ•ä½ç½®èª¿æ•´**ï¼š
  - è¨­å‚™æª¢æŸ¥èˆ‡åº«å­˜ç›¤é»å°èª¿ä½ç½®
  - é¿å…å…©å€‹è—è‰²æŒ‰éˆ•ï¼ˆcyan/skyï¼‰ç›¸é„°
- **åº«å­˜ç›¤é»é…è‰²å„ªåŒ–**ï¼š
  - ç¢ºèªæŒ‰éˆ•ï¼š`bg-cyan-600`ï¼ˆåº«å­˜ç›¤é»ä¸»è‰²ï¼‰
  - éŒ¯èª¤æŒ‰éˆ•ï¼š`bg-gray-100 text-[#D96754]`ï¼ˆç°åº•è¡€ç´…å­—ï¼‰
  - ç¢ºèªç‹€æ…‹æŒ‡ç¤ºï¼š`bg-cyan-600`ï¼ˆè—å‹¾å‹¾ï¼‰
  - éŒ¯èª¤ç‹€æ…‹æŒ‡ç¤ºï¼š`bg-gray-200 text-[#D96754]`ï¼ˆç°åº•ç´…é©šå˜†è™Ÿï¼‰
  - æ‘˜è¦çµ±è¨ˆå¡ç‰‡é…è‰²ä¸€è‡´
- **Header åŒæ­¥æŒ‰éˆ•**ï¼š
  - æ­£å¸¸ç‹€æ…‹ï¼š`bg-teal-700` é¡¯ç¤ºã€Œå·²åŒæ­¥ã€
  - å¾…åŒæ­¥æ™‚ï¼š`bg-amber-500` é«˜äº® + æ•¸é‡å¾½ç« 
  - é»æ“Šè§¸ç™¼æ‰‹å‹•åŒæ­¥ + æ—‹è½‰å‹•ç•«åé¥‹
  - é›¢ç·šæ™‚æç¤ºç„¡æ³•åŒæ­¥

### v0.7 (2025-12-19) - åº«å­˜ç›¤é»æ ¸å°åŠŸèƒ½ + æŒ‰éˆ•è‰²ç³»çµ±ä¸€
- **ç›¤é»æ ¸å°æµç¨‹**ï¼š
  - åº«å­˜é …ç›®å¯æ¨™è¨˜ã€Œç¢ºèªã€æˆ–ã€ŒéŒ¯èª¤ã€
  - éŒ¯èª¤é …ç›®éœ€å¡«å¯«èªªæ˜ï¼ˆæ•¸é‡å·®ç•°ã€ä½ç½®éŒ¯èª¤ç­‰ï¼‰
  - æ ¸å°ç‹€æ…‹åœ¨å¡ç‰‡å³ä¸Šè§’é¡¯ç¤ºï¼ˆcyan å‹¾å‹¾ / ç°åº•ç´…è‰²è­¦å‘Šï¼‰
  - é‚Šæ¡†é¡è‰²åæ˜ æ ¸å°ç‹€æ…‹ï¼ˆcyan/ç°/ç°ï¼‰
- **ç›¤é»é€²åº¦è¿½è¹¤**ï¼š
  - Header é¡¯ç¤ºå³æ™‚é€²åº¦ï¼ˆX ç¢ºèª / Y éŒ¯èª¤ / Z ç¸½è¨ˆï¼‰
  - é›™å±¤ç¯©é¸å™¨ï¼šç‹€æ…‹ç¯©é¸ï¼ˆå¾…æ ¸å°/å·²ç¢ºèª/éŒ¯èª¤/ä½åº«å­˜ï¼‰+ é¡åˆ¥ç¯©é¸
  - å®ŒæˆæŒ‰éˆ•é–‹å•Ÿæ‘˜è¦ Modal
- **ç›¤é»æ‘˜è¦èˆ‡ç°½æ ¸**ï¼š
  - çµ±è¨ˆå¡ç‰‡ï¼šç¸½é …ç›®ã€å·²ç¢ºèªã€éŒ¯èª¤
  - éŒ¯èª¤æ¸…å–®é¡¯ç¤ºï¼ˆéœ€è‡³ Hub è™•ç†ï¼‰
  - ç›¤é»äººå“¡ç¢ºèªï¼ˆè‡ªå‹•å¸¶å…¥ç•¶å‰ç™»å…¥è€…ï¼‰
  - é€å‡ºå¾Œæ¸…é™¤æœ¬åœ°è¨˜éŒ„ï¼Œè³‡æ–™åŒæ­¥è‡³ Hub
- **éŒ¯èª¤è™•ç†ä½‡åˆ—**ï¼š
  - éŒ¯èª¤é …ç›®åŠ å…¥å¾…è™•ç† Queue
  - Hub ç«¯å¯æŸ¥çœ‹æ­·å²ç›¤é»è¨˜éŒ„
  - ä¸€éµä¸‹è¼‰åŒ…å«æ ¸å°è¨˜éŒ„
- **åŠŸèƒ½æŒ‰éˆ•è‰²ç³»çµ±ä¸€**ï¼ˆèˆ‡ MIRS Hub ä¸€è‡´ï¼‰ï¼š
  - è¨­å‚™æª¢æŸ¥ï¼š`bg-teal-600` (Teal)
  - åº«å­˜ç›¤é»ï¼š`bg-cyan-600` (Cyan)
  - è¡€è¢‹å…¥åº«ï¼š`bg-[#D96754]` (Claude Redï¼ŒåŒè¡€è¢‹ç®¡ç† tab)
  - è€—æå…¥åº«ï¼š`bg-sky-600` (Skyï¼ŒåŒé€²è²¨ç™»è¨˜ tab)
  - å››æŒ‰éˆ•çµ±ä¸€å°ºå¯¸çµæ§‹ï¼šp-5 + åœ–ç¤ºå®¹å™¨ + æ¨™é¡Œ + å‰¯æ¨™é¡Œ
- **è­¦ç¤ºå€ä¿®æ­£**ï¼š
  - è¨­å‚™æŒ‰éˆ•æ­£ç¢ºè·³è½‰è‡³ã€Œå¾…æª¢æŸ¥ã€ç¯©é¸å™¨
- **API è¨­è¨ˆ**ï¼š
  - `POST /api/inventory-check` æäº¤ç›¤é»çµæœ

### v0.6 (2025-12-19) - PWA åŠŸèƒ½é‚Šç•Œå®šç¾© + åº«å­˜åˆ†é¡ä¿®æ­£
- **PWA åŠŸèƒ½é‚Šç•Œ**ï¼š
  - æ–°å¢ Â§10.1 æ˜ç¢ºå®šç¾© PWA å¯ç”¨/ä¸å¯ç”¨æ“ä½œ
  - é«˜æ•æ„Ÿæ“ä½œï¼ˆè—¥å“ç™¼æ”¾ã€è¡€è¢‹é ˜ç”¨ã€ç®¡åˆ¶è—¥ï¼‰ä¿ç•™ Hub Dashboard
  - ä½é¢¨éšªæ“ä½œï¼ˆè¨­å‚™å·¡æª¢ã€åº«å­˜æŸ¥è©¢ã€è¡€è¢‹å…¥åº«ï¼‰ä¸‹æ”¾ PWA
- **è¡€è¢‹å…¥åº«åŠŸèƒ½è¨­è¨ˆ**ï¼š
  - å ±åˆ°å€æ¥æ”¶æè¡€ä¸­å¿ƒè¡€è¢‹
  - ç¾å ´æè¡€ç«™è¡€è¢‹ç™»è¨˜
  - å®šç¾© `/api/mirs-mobile/v1/blood/receive` API
- **ç‰©å“åˆ†é¡è¦å‰‡ä¿®æ­£**ï¼š
  - `MED-` â†’ è—¥å“ï¼ˆç´«è‰²ï¼‰
  - `EMER-` â†’ æ€¥æ•‘è—¥ç‰©ï¼ˆç´…è‰²ï¼Œå±¬è—¥å“é¡ï¼‰
  - `REA-` â†’ è©¦åŠ‘ï¼ˆç¥ç€è‰²ï¼Œæ•ˆæœŸè¿½è¹¤ï¼‰
  - å…¶ä»– â†’ è€—æï¼ˆé’è‰²ï¼‰

### v0.5 (2025-12-19) - åŠŸèƒ½æŒ‰éˆ•è¦–è¦ºå„ªåŒ– + è¨­å‚™åˆ†é¡å®Œå–„
- **UI è¦–è¦ºå€éš”**ï¼š
  - å³æ™‚çµ±è¨ˆå¡ç‰‡ï¼šç°éšè¨­è¨ˆï¼Œ2x2 æ ¼å±€ï¼ˆæ°§æ°£ã€é›»åŠ›ã€è©¦åŠ‘ã€è¡€è¢‹ï¼‰
  - åŠŸèƒ½æŒ‰éˆ•ï¼šå¯¦å¿ƒè‰²èƒŒæ™¯ + ç™½è‰²åœ–ç¤ºï¼ˆè¨­å‚™æª¢æŸ¥:Tealã€åº«å­˜ç›¤é»:Cyanï¼‰
  - å­—é«”æ”¾å¤§ï¼šçµ±è¨ˆæ•¸å­— `text-5xl`ï¼Œæ¨™ç±¤ `text-lg`ï¼ˆè­·ç†å¸«è€èŠ±é©ç”¨ï¼‰
- **è¨­å‚™åˆ†é¡å®Œå–„**ï¼š
  - å››åˆ†é¡ç³»çµ±ï¼šä¾›é›» / è€—é›» / éè€—é›» / æ‰‹è¡“åŒ…
  - åˆ†é¡é‚è¼¯å„ªå…ˆç´šï¼šæ‰‹è¡“åŒ…å„ªå…ˆæª¢æŸ¥ï¼Œé¿å…èª¤åˆ¤
  - ç¯©é¸å™¨ï¼šå…¨éƒ¨ / å¾…æª¢æŸ¥ / ä¾›é›» / è€—é›» / éè€—é›» / æ‰‹è¡“åŒ…
- **è¨­å‚™å¡ç‰‡é»æ“Šä¿®å¾©**ï¼š
  - ä½¿ç”¨äº‹ä»¶å§”æ´¾ (event delegation) è™•ç†å‹•æ…‹ç”Ÿæˆå…ƒç´ 
  - ä¿®æ­£è¨­å‚™ ID å­—ä¸²æ¯”å°å•é¡Œ (`String()` è½‰æ›)
  - å­å…ƒç´  `pointer-events-none` ç¢ºä¿é»æ“Šæ­£ç¢ºå‚³é

### v0.4 (2025-12-19) - UI å„ªåŒ– + PWA åœ–ç¤º
- **UI å°æ¯”åº¦æ”¹å–„**ï¼š
  - æ·±è‰²èƒŒæ™¯ (`bg-gray-200`) æå‡å¡ç‰‡å¯è®€æ€§
  - éŸŒæ€§æŒ‡æ¨™ä½¿ç”¨å½©è‰²åœ–ç¤ºï¼ˆæ°§æ°£:tealã€é›»åŠ›:amberã€è©¦åŠ‘:purpleï¼‰
  - å¡ç‰‡åŠ ä¸Šé‚Šæ¡†æå‡å±¤æ¬¡æ„Ÿ
- **è¨­å‚™åˆ†é¡**ï¼š
  - æ–°å¢ã€ŒéŸŒæ€§è¨­å‚™ã€è‡ªå‹•åˆ†é¡ï¼ˆæ°§æ°£ç“¶ã€ç™¼é›»æ©Ÿã€UPS ç­‰ï¼‰
  - è¨­å‚™åˆ—è¡¨åˆ†çµ„é¡¯ç¤ºï¼ˆéŸŒæ€§è¨­å‚™ / ä¸€èˆ¬è¨­å‚™ï¼‰
  - ç¯©é¸å™¨ï¼šå…¨éƒ¨ / å¾…æª¢æŸ¥ / éŸŒæ€§è¨­å‚™ / ä¸€èˆ¬è¨­å‚™
- **PWA å®Œæ•´åœ–ç¤º**ï¼š
  - æ–°å¢ `manifest.json` å®Œæ•´é…ç½®
  - è£½ä½œ Teal è‰²ç³» App Iconï¼ˆé†«ç™‚åå­— + å¿ƒé›»åœ– + é–ƒé›»ï¼‰
  - æ”¯æ´ 72x72 ~ 512x512 å…¨å°ºå¯¸ PNG
  - Apple Touch Icon å®Œæ•´æ”¯æ´
- **æ²å‹•ä¿®æ­£**ï¼šè¨­å‚™åˆ—è¡¨æ”¯æ´æ­£å¸¸æ²å‹•

### v0.3 (2025-12-19) - Phase 1 MVP å®Œæˆ
- **é…å°èªè­‰**ï¼šâœ… 6 ä½æ•¸é…å°ç¢¼ + JWT Token
- **éŸŒæ€§å„€è¡¨æ¿**ï¼šâœ… æ°§æ°£/é›»åŠ›/è©¦åŠ‘ç‹€æ…‹é¡¯ç¤º
- **è¨­å‚™å¿«é€Ÿæª¢æŸ¥**ï¼šâœ… è¨­å‚™åˆ—è¡¨ã€ç¯©é¸ã€æª¢æŸ¥æäº¤
- **é›¢ç·šæš«å­˜**ï¼šâœ… IndexedDB + è‡ªå‹•åŒæ­¥
- **UI å„ªåŒ–**ï¼šä½¿ç”¨ Heroicons æ›¿æ› Emojiï¼ŒTeal è‰²ç³»
- **é€£ç·šä¿®æ­£**ï¼š
  - ä¿®æ­£ `crypto.randomUUID()` åœ¨èˆŠç‰ˆ Safari ä¸æ”¯æ´å•é¡Œ
  - ä¿®æ­£ localhost IP è‡ªå‹•åµæ¸¬ï¼ˆQR Code ä½¿ç”¨å¯¦éš›ç¶²è·¯ IPï¼‰
  - æ–°å¢ no-cache headers é˜²æ­¢å¿«å–å•é¡Œ

### v0.2 (2025-12-18)
- **API å‘½åç©ºé–“**ï¼šå¾ `/api/mobile/` æ”¹ç‚º `/api/mirs-mobile/v1/`
- **ç·Šæ€¥ç™¼è—¥**ï¼šæ–°å¢é†«ç™‚ç´šç¨½æ ¸æ¬„ä½ï¼ˆstaff_id, patient_id, reason_code, witness_idï¼‰
- **åŒæ­¥å”è­°**ï¼šå®šç¾©ä¸‰ç¨®å›æ‡‰ç‹€æ…‹ï¼ˆACCEPTED, ACCEPTED_WITH_ADJUSTMENT, REJECTEDï¼‰
- **å®‰å…¨ç¯„åœ**ï¼šç´°åŒ– Token Scopes ä¸¦æ–°å¢è£ç½®æ’¤éŠ·æ©Ÿåˆ¶
- **æ‰‹å‹•è¼¸å…¥**ï¼šæ–°å¢ iOS Safari ç›¸æ©Ÿå¤±æ•—çš„ Fallback æµç¨‹
- **æ–°å¢ç« ç¯€**ï¼šè³‡æ–™æ¨¡å‹ã€ç·Šæ€¥ç™¼è—¥æ”¿ç­–ã€åŒæ­¥å”è­°

### v0.1 (2025-12-18)
- åˆç‰ˆè¦æ ¼æ›¸

---

## 1. ç”¢å“å®šä½

### 1.1 èˆ‡ CIRS Satellite çš„å·®ç•°

| é …ç›® | CIRS Satellite | MIRS Mobile |
|------|---------------|-------------|
| **å®šä½** | å‚³ä»¤å…µ | å·¡æˆ¿åŠ©æ‰‹ |
| **ç”¨æˆ¶** | å¿—å·¥ï¼ˆå¯èƒ½ç„¡é†«ç™‚èƒŒæ™¯ï¼‰ | é†«è­·äººå“¡ï¼ˆè­·ç†å¸«ã€é†«å¸«ï¼‰ |
| **ç’°å¢ƒ** | æ”¶å®¹æ‰€ï¼ˆ50-500äººï¼‰ | é†«ç™‚ç«™ï¼ˆ1-50ç—…æ‚£ï¼‰ |
| **ä¸»è¦æ“ä½œ** | å ±åˆ°ã€ç™¼æ”¾ç‰©è³‡ | è¨­å‚™å·¡æª¢ã€è—¥å“ç™¼æ”¾ã€åº«å­˜æŸ¥è©¢ |
| **ç§»å‹•ç¯„åœ** | å¤§ï¼ˆé–€å£ã€ç™¼æ”¾å€ã€ä¼‘æ¯å€ï¼‰ | ä¸­ï¼ˆç—…åºŠã€è—¥å±€ã€è¨­å‚™å€ï¼‰ |
| **å°ˆæ¥­åº¦** | ä½ï¼ˆç°¡åŒ–æ“ä½œï¼‰ | ä¸­ï¼ˆå…è¨±å°ˆæ¥­è¡“èªï¼‰ |
| **é›¢ç·šé »ç‡** | é«˜ï¼ˆç½å€ç¶²è·¯ä¸ç©©ï¼‰ | ä¸­ï¼ˆé›¢å³¶/åé åœ°å€ï¼‰ |
| **ç¨½æ ¸è¦æ±‚** | ä¸­ï¼ˆç‰©è³‡ç™¼æ”¾è¨˜éŒ„ï¼‰ | **é«˜**ï¼ˆè—¥å“ç™¼æ”¾éœ€å®Œæ•´è¿½æº¯ï¼‰ |

> âš ï¸ **é‡è¦æé†’**ï¼šã€Œä¸èƒ½æŠŠç™¼è—¥ç•¶ç™¼ä¾¿ç•¶è¨­è¨ˆã€â€”â€” MIRS çš„è—¥å“ç™¼æ”¾æ¶‰åŠé†«ç™‚è²¬ä»»ï¼Œå¿…é ˆæœ‰å®Œæ•´çš„ç¨½æ ¸è¿½æº¯ã€‚

### 1.2 æ ¸å¿ƒåƒ¹å€¼

1. **è¨­å‚™å·¡æª¢è¡Œå‹•åŒ–** - èµ°åˆ°å“ªæª¢æŸ¥åˆ°å“ªï¼Œä¸ç”¨å›è­·ç†ç«™ç™»è¨˜
2. **ç·Šæ€¥ç™¼è—¥ç„¡å»¶é²** - ç—…åºŠé‚Šç›´æ¥æˆæ¬Šç™¼è—¥ï¼ˆå«å®Œæ•´ç¨½æ ¸ï¼‰
3. **éŸŒæ€§å³æ™‚ç›£æ§** - æ°§æ°£ã€é›»åŠ›å‰©é¤˜æ™‚æ•¸ä¸€ç›®äº†ç„¶
4. **é›¢ç·šä¸ä¸­æ–·** - ç¶²è·¯æ–·ç·šä»å¯æ“ä½œï¼Œæ¢å¾©å¾Œè‡ªå‹•åŒæ­¥

### 1.3 è¨­è¨ˆåŸå‰‡

1. **ä¸€éµå®Œæˆ** - æ¯å€‹æ“ä½œæœ€å¤š 3 æ­¥
2. **éŒ¯èª¤å®¹å¿** - æŒ‰éŒ¯å¯æ’¤éŠ·ï¼Œé›¢ç·šå¯é‡è©¦
3. **å°ˆæ¥­å‹å–„** - ä½¿ç”¨é†«ç™‚ç¸®å¯«ï¼ˆPRN, CBCï¼‰ï¼Œä½†æœ‰è§£é‡‹
4. **éŸŒæ€§å„ªå…ˆ** - é›»åŠ›/æ°§æ°£ç‹€æ…‹æ°¸é åœ¨é¦–é å¯è¦‹
5. **ç¨½æ ¸å®Œæ•´** - æ‰€æœ‰æ“ä½œè¨˜éŒ„ã€Œèª°ã€å°èª°ã€ä½•æ™‚ã€ç‚ºä½•ã€

---

## 2. ç³»çµ±æ¶æ§‹

### 2.1 Hub & Spoke æ¶æ§‹ï¼ˆæ²¿ç”¨ CIRS æ¨¡å¼ï¼‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Raspberry Pi (Hub)          â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚ CIRS:8090 â”‚ MIRS:8000     â”‚  â”‚
                    â”‚  â”‚ ç¤¾å€ç‰©è³‡   â”‚ é†«ç™‚åº«å­˜      â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚         SQLite Database         â”‚
                    â”‚       (Single Source of Truth)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚ WiFi / LAN
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚               â”‚               â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
              â”‚ MIRS Web  â”‚   â”‚ MIRS      â”‚   â”‚ MIRS      â”‚
              â”‚ Dashboard â”‚   â”‚ Mobile    â”‚   â”‚ Mobile    â”‚
              â”‚           â”‚   â”‚ (è­·ç†å¸«A)  â”‚   â”‚ (é†«å¸«B)    â”‚
              â”‚ ğŸ–¥ï¸ é›»è…¦   â”‚   â”‚ ğŸ“± æ‰‹æ©Ÿ    â”‚   â”‚ ğŸ“± å¹³æ¿    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 ç®¡ç†ä¸­å¿ƒ        ç—…æˆ¿å·¡æª¢        æ€¥è¨ºå€
```

### 2.2 è³‡æ–™æµ

```
MIRS Mobile (æ‰‹æ©Ÿ)                Hub (MIRS Backend)           Web Dashboard
      â”‚                                  â”‚                           â”‚
      â”‚  POST /api/mirs-mobile/v1/check  â”‚                           â”‚
      â”‚  { action_id, equipment_id, ... }â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
      â”‚                                  â”‚  Validate action_id       â”‚
      â”‚                                  â”‚  Check revoked_devices    â”‚
      â”‚                                  â”‚  Update equipment table   â”‚
      â”‚                                  â”‚  Log to action_logs       â”‚
      â”‚                                  â”‚  Broadcast via WebSocket  â”‚
      â”‚                                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
      â”‚                                  â”‚                           â”‚  Dashboard
      â”‚  { status: "ACCEPTED" }          â”‚                           â”‚  auto-refresh
      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
```

### 2.3 æŠ€è¡“é¸å‹

| å±¤ç´š | æŠ€è¡“ | ç†ç”± |
|------|------|------|
| **å‰ç«¯** | Alpine.js + Tailwind CSS | èˆ‡ CIRS Satellite ä¸€è‡´ï¼Œå­¸ç¿’æ›²ç·šä½ |
| **PWA** | Service Worker + IndexedDB | é›¢ç·šæ”¯æ´ |
| **èªè­‰** | 6 ä½æ•¸é…å°ç¢¼ + JWT | æ²¿ç”¨ CIRS æˆç†Ÿæ–¹æ¡ˆ |
| **é€šè¨Š** | REST API | ç°¡å–®å¯é ï¼Œé›¢ç·šå‹å–„ |
| **å¾Œç«¯** | FastAPI (å·²æœ‰) | æ–°å¢ `/api/mirs-mobile/v1/*` ç«¯é» |

---

## 3. è³‡æ–™æ¨¡å‹ï¼ˆv0.2 æ–°å¢ï¼‰

### 3.1 Mobile Actions è³‡æ–™è¡¨

```sql
CREATE TABLE IF NOT EXISTS mirs_mobile_actions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    action_id TEXT UNIQUE NOT NULL,      -- UUIDï¼Œå†ªç­‰æ€§ä¿è­‰
    action_type TEXT NOT NULL,           -- 'equipment_check', 'emergency_dispense', etc.
    device_id TEXT NOT NULL,             -- è£ç½® UUID
    staff_id TEXT NOT NULL,              -- æ“ä½œäººå“¡ ID
    patient_id TEXT,                     -- ç—…æ‚£ ID (ç™¼è—¥æ™‚å¿…å¡«)
    payload TEXT NOT NULL,               -- JSON æ ¼å¼çš„æ“ä½œå…§å®¹

    -- æ™‚é–“æˆ³è¨˜
    created_at DATETIME NOT NULL,        -- æ“ä½œåœ¨è£ç½®ä¸Šå»ºç«‹çš„æ™‚é–“
    hub_received_at DATETIME,            -- Hub æ”¶åˆ°çš„æ™‚é–“

    -- è™•ç†ç‹€æ…‹
    status TEXT DEFAULT 'PENDING',       -- PENDING, ACCEPTED, ACCEPTED_WITH_ADJUSTMENT, REJECTED
    adjustment_note TEXT,                -- å¦‚æœ‰èª¿æ•´ï¼Œèªªæ˜åŸå› 

    -- ç¨½æ ¸è¦†æ ¸
    review_status TEXT DEFAULT 'PENDING_REVIEW',  -- PENDING_REVIEW, REVIEWED, NOT_REQUIRED
    reviewer_staff_id TEXT,              -- è¦†æ ¸äººå“¡ ID
    reviewed_at DATETIME,

    -- ç´¢å¼•æ¬„ä½
    station_id TEXT NOT NULL
);

CREATE INDEX idx_mobile_actions_device ON mirs_mobile_actions(device_id);
CREATE INDEX idx_mobile_actions_staff ON mirs_mobile_actions(staff_id);
CREATE INDEX idx_mobile_actions_status ON mirs_mobile_actions(status);
CREATE INDEX idx_mobile_actions_review ON mirs_mobile_actions(review_status);
```

### 3.2 è£ç½®æ’¤éŠ·æ¸…å–®

```sql
CREATE TABLE IF NOT EXISTS mirs_revoked_devices (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    device_id TEXT UNIQUE NOT NULL,
    revoked_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    revoked_by TEXT NOT NULL,
    reason TEXT
);
```

---

## 4. åŠŸèƒ½è¦æ ¼

### 4.1 åŠŸèƒ½å„ªå…ˆç´š

| åŠŸèƒ½ | å„ªå…ˆç´š | èªªæ˜ |
|------|--------|------|
| é…å°èˆ‡èªè­‰ | P0 | æ²¿ç”¨ CIRS 6 ä½æ•¸é…å°ç¢¼ |
| éŸŒæ€§å„€è¡¨æ¿ | P0 | æ°§æ°£/é›»åŠ›å‰©é¤˜æ™‚æ•¸é¦–é é¡¯ç¤º |
| è¨­å‚™å¿«é€Ÿæª¢æŸ¥ | P0 | ä¸€éµæ›´æ–°è¨­å‚™ç‹€æ…‹ |
| åº«å­˜æŸ¥è©¢ | P1 | å”¯è®€æŸ¥çœ‹è—¥å“/è€—æåº«å­˜ |
| ç·Šæ€¥ç™¼è—¥ | P1 | **å«å®Œæ•´ç¨½æ ¸æ¬„ä½** |
| æ°§æ°£ç“¶ç‹€æ…‹ | P1 | å€‹åˆ¥ç“¶ä½ % æ›´æ–° |
| æ­£å¸¸ç™¼è—¥ | P2 | éœ€ PIN ç¢¼å¯©æ ¸ |
| è¡€è¢‹é ˜ç”¨ | P2 | è¨˜éŒ„ç—…æ‚£+è¡€å‹ |
| æ‰‹è¡“è€—æ | P3 | æ‰‹è¡“ä¸­å³æ™‚è¨˜éŒ„è€—æ |

### 4.2 é¦–é ï¼šéŸŒæ€§ç‹€æ…‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¥ MIRS Mobile                     â”‚
â”‚  è˜­å¶¼è¡›ç”Ÿæ‰€ (TC-01)         âš™ï¸ è¨­å®š  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â±ï¸ å­¤ç«‹å¤©æ•¸è¨­å®š: 5å¤©               â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ« æ°§æ°£      â”‚ â”‚ âš¡ é›»åŠ›      â”‚   â”‚
â”‚  â”‚             â”‚ â”‚             â”‚   â”‚
â”‚  â”‚   11.5 hr   â”‚ â”‚   60 hr     â”‚   â”‚
â”‚  â”‚   ğŸ”´ CRITICALâ”‚ â”‚   ğŸŸ¡ WARNING â”‚   â”‚
â”‚  â”‚             â”‚ â”‚             â”‚   â”‚
â”‚  â”‚  [è©³ç´° >]   â”‚ â”‚  [è©³ç´° >]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ å¿«é€Ÿæ“ä½œ                        â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”§    â”‚ â”‚  ğŸ’Š    â”‚ â”‚  ğŸ“¦    â”‚  â”‚
â”‚  â”‚ è¨­å‚™   â”‚ â”‚ ç™¼è—¥   â”‚ â”‚ åº«å­˜   â”‚  â”‚
â”‚  â”‚ å·¡æª¢   â”‚ â”‚        â”‚ â”‚ æŸ¥è©¢   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“¡ é€£ç·šç‹€æ…‹: âœ… å·²é€£ç·š              â”‚
â”‚  ğŸ”„ æœ€å¾ŒåŒæ­¥: 14:30:25              â”‚
â”‚  â³ å¾…åŒæ­¥: 0 ç­† | å¾…è¦†æ ¸: 2 ç­†      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 è¨­å‚™å·¡æª¢

#### æµç¨‹

```
è¨­å‚™åˆ—è¡¨ â†’ é¸æ“‡è¨­å‚™ â†’ æ›´æ–°ç‹€æ…‹ â†’ ç¢ºèª â†’ è‡ªå‹•åŒæ­¥
```

#### ä»‹é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ è¨­å‚™å·¡æª¢                   [è¿”å›] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ ç¯©é¸: [å…¨éƒ¨â–¾] [å¾…æª¢æŸ¥å„ªå…ˆâœ“]       â”‚
â”‚  ğŸ” æœå°‹: [è¼¸å…¥è¨­å‚™åç¨±æˆ–ç·¨è™Ÿ...]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  âš¡ æœ€è¿‘æª¢æŸ¥                         â”‚
â”‚  â”œâ”€ UTIL-001 è¡Œå‹•é›»æºç«™             â”‚
â”‚  â””â”€ RESP-001-A Hå‹æ°§æ°£ç“¶ #1         â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âš ï¸ è¡Œå‹•é›»æºç«™ (UTIL-001)        â”‚â”‚
â”‚  â”‚    ç‹€æ…‹: å¾…æª¢æŸ¥                 â”‚â”‚
â”‚  â”‚    é›»é‡: --                     â”‚â”‚
â”‚  â”‚                    [æª¢æŸ¥ >]     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ… Hå‹æ°§æ°£ç“¶ #1 (RESP-001-A)    â”‚â”‚
â”‚  â”‚    ç‹€æ…‹: æ­£å¸¸                   â”‚â”‚
â”‚  â”‚    å……å¡«: 95%                    â”‚â”‚
â”‚  â”‚    æª¢æŸ¥: ä»Šæ—¥ 09:15            â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **æ‰‹å‹• Fallback**ï¼šç•¶ QR æƒæç„¡æ³•ä½¿ç”¨æ™‚ï¼Œå¯é€éæœå°‹æ¬„è¼¸å…¥è¨­å‚™ç·¨è™Ÿï¼Œæˆ–å¾ã€Œæœ€è¿‘æª¢æŸ¥ã€åˆ—è¡¨å¿«é€Ÿé¸æ“‡ã€‚

### 4.4 è—¥å“ç™¼æ”¾ï¼ˆv0.2 é‡æ–°è¨­è¨ˆï¼‰

#### ç·Šæ€¥ç™¼è—¥ (Break-the-Glass) - é†«ç™‚ç´šç¨½æ ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸš¨ ç·Šæ€¥ç™¼è—¥                   [è¿”å›] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  âš ï¸ ç·Šæ€¥æ¨¡å¼ï¼šè·³éè—¥å¸«å¯©æ ¸          â”‚
â”‚     æ“ä½œå°‡è¢«è¨˜éŒ„ä¾›äº‹å¾Œç¨½æ ¸          â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ‘¤ ç™¼è—¥äºº: è­·ç†å¸«A (NURSE-001)      â”‚
â”‚     [å·²ç™»å…¥ï¼Œç„¡æ³•æ›´æ”¹]              â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ›ï¸ ç—…æ‚£:                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” [æœå°‹ç—…æ‚£IDæˆ–å§“å...]        â”‚â”‚
â”‚  â”‚ âš¡ æœ€è¿‘: P-001 å¼µå°æ˜ | P-002 æå¤§è¯ â”‚
â”‚  â”‚ â˜ æœªçŸ¥ç—…æ‚£ (äº‹å¾Œè£œç™»)           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ’Š è—¥å“:                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” [æœå°‹è—¥å“åç¨±æˆ–ä»£ç¢¼...]       â”‚â”‚
â”‚  â”‚ â­ å¸¸ç”¨: Morphine | Paracetamol â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Morphine 10mg/mL (MED-003)     â”‚â”‚
â”‚  â”‚ åº«å­˜: 15 æ”¯  âš ï¸ ç®¡åˆ¶è—¥å“        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  æ•¸é‡: [ 2 ]  æ”¯                    â”‚
â”‚        [-]  [+]                     â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ“‹ ç·Šæ€¥åŸå› : (å¿…é¸)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â—‹ åš´é‡ç–¼ç—› (PAIN_SEVERE)        â”‚â”‚
â”‚  â”‚ â—‹ å‰µå‚·è™•ç½® (TRAUMA_TREATMENT)   â”‚â”‚
â”‚  â”‚ â—‹ ACLS æ€¥æ•‘ (ACLS_PROTOCOL)     â”‚â”‚
â”‚  â”‚ â—‹ å¤§é‡å‚·æ‚£ (MASS_CASUALTY)      â”‚â”‚
â”‚  â”‚ â—‹ å…¶ä»– (OTHER)                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  è£œå……èªªæ˜ (é¸å¡«):                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ğŸ‘ï¸ è¦‹è­‰äºº: (ç®¡åˆ¶è—¥å“å¿…å¡«)          â”‚
â”‚  [é¸æ“‡è¦‹è­‰äºº â–¾]                     â”‚
â”‚                                     â”‚
â”‚      [ ğŸš¨ ç¢ºèªç·Šæ€¥ç™¼è—¥ ]            â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. API è¦æ ¼ï¼ˆv0.2 æ›´æ–°ï¼‰

### 5.1 API å‘½åç©ºé–“

**Base URL**: `/api/mirs-mobile/v1`

> èˆ‡ CIRS Satellite (`/api/satellite`) åˆ†é›¢ï¼Œé¿å…æ··æ·†ã€‚

### 5.2 èªè­‰ API

```http
# ç”¢ç”Ÿé…å°ç¢¼ï¼ˆHub ç«¯ï¼‰
POST /api/mirs-mobile/v1/auth/pairing
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "allowed_roles": ["nurse", "doctor"],
  "expires_minutes": 5,
  "scopes": ["equipment:write", "medication:emergency", "inventory:read"]
}

Response:
{
  "code": "384756",
  "expires_at": "2025-12-18T15:35:00Z",
  "allowed_roles": ["nurse", "doctor"],
  "scopes": ["equipment:write", "medication:emergency", "inventory:read"]
}
```

```http
# äº¤æ›é…å°ç¢¼ï¼ˆMobile ç«¯ï¼‰
POST /api/mirs-mobile/v1/auth/exchange
Content-Type: application/json

{
  "pairing_code": "384756",
  "device_id": "uuid-xxxx-xxxx",
  "device_name": "iPhone è­·ç†å¸«A"
}

Response:
{
  "access_token": "eyJhbG...",
  "expires_in": 43200,
  "station_id": "TC-01",
  "station_name": "è˜­å¶¼è¡›ç”Ÿæ‰€",
  "staff_id": "NURSE-001",
  "staff_name": "è­·ç†å¸«A",
  "role": "nurse",
  "scopes": ["equipment:write", "medication:emergency", "inventory:read"]
}
```

### 5.3 Token Scopesï¼ˆv0.2 æ–°å¢ï¼‰

| Scope | èªªæ˜ | è§’è‰² |
|-------|------|------|
| `mirs:equipment:read` | å”¯è®€è¨­å‚™ç‹€æ…‹ | æ‰€æœ‰ |
| `mirs:equipment:write` | æ›´æ–°è¨­å‚™ç‹€æ…‹ | nurse, doctor, admin |
| `mirs:medication:emergency` | ç·Šæ€¥ç™¼è—¥ âš ï¸ é«˜æ•æ„Ÿ | nurse, doctor |
| `mirs:medication:standard` | ä¸€èˆ¬ç™¼è—¥ (éœ€ PIN) | nurse, doctor |
| `mirs:inventory:read` | å”¯è®€åº«å­˜ | æ‰€æœ‰ |
| `mirs:resilience:read` | éŸŒæ€§ç‹€æ…‹ | æ‰€æœ‰ |

### 5.4 éŸŒæ€§ API

```http
GET /api/mirs-mobile/v1/resilience
Authorization: Bearer {token}

Response:
{
  "station_id": "TC-01",
  "isolation_target_hours": 120,
  "lifelines": {
    "oxygen": {
      "total_liters": 13800,
      "burn_rate_lpm": 20,
      "hours_remaining": 11.5,
      "status": "CRITICAL",
      "profile": "2ä½æ’ç®¡æ‚£è€…"
    },
    "power": {
      "total_liters": 180,
      "burn_rate_lph": 3.0,
      "hours_remaining": 60,
      "status": "WARNING",
      "profile": "æ¨™æº–é‹ä½œ"
    }
  },
  "overall_status": "CRITICAL",
  "weakest_link": "oxygen"
}
```

### 5.5 è¨­å‚™ API

```http
GET /api/mirs-mobile/v1/equipment?filter=pending
Authorization: Bearer {token}

Response:
{
  "equipment": [...],
  "pending_count": 3,
  "total_count": 12,
  "recent": [
    {"id": "UTIL-001", "name": "è¡Œå‹•é›»æºç«™", "last_check": "..."},
    {"id": "RESP-001-A", "name": "Hå‹æ°§æ°£ç“¶ #1", "last_check": "..."}
  ]
}
```

```http
POST /api/mirs-mobile/v1/equipment/{equipment_id}/check
Authorization: Bearer {token}
Content-Type: application/json

{
  "action_id": "uuid-xxxx",
  "status": "normal",
  "power_level": 95,
  "notes": "æ¿¾ç¶²å·²æ›´æ›"
}

Response:
{
  "status": "ACCEPTED",
  "action_id": "uuid-xxxx",
  "equipment_id": "RESP-001-A",
  "checked_at": "2025-12-18T14:30:00Z",
  "checked_by": "NURSE-001"
}
```

### 5.6 ç·Šæ€¥ç™¼è—¥ APIï¼ˆv0.2 é‡æ–°è¨­è¨ˆï¼‰

```http
POST /api/mirs-mobile/v1/dispense/emergency
Authorization: Bearer {token}
Content-Type: application/json

{
  "action_id": "uuid-xxxx",
  "staff_id": "NURSE-001",
  "patient_id": "P-2025-009",
  "unknown_patient": false,
  "item_code": "MED-MORPHINE-10",
  "quantity": 2,
  "reason_code": "PAIN_SEVERE",
  "reason_note": "è»Šç¦å‚·æ‚£ï¼Œéª¨æŠ˜ç–¼ç—›",
  "witness_id": "DOC-002",
  "timestamp": 1734512400
}

Response (Success):
{
  "status": "ACCEPTED_PENDING_REVIEW",
  "action_id": "uuid-xxxx",
  "audit_id": "AUD-2025-1218-001",
  "item_name": "Morphine 10mg/mL",
  "quantity_dispensed": 2,
  "remaining_stock": 13,
  "requires_pharmacist_review": true,
  "review_sla_hours": 2
}

Response (Stock Adjusted):
{
  "status": "ACCEPTED_WITH_ADJUSTMENT",
  "action_id": "uuid-xxxx",
  "audit_id": "AUD-2025-1218-002",
  "item_name": "Morphine 10mg/mL",
  "quantity_requested": 5,
  "quantity_dispensed": 3,
  "adjustment_reason": "åº«å­˜ä¸è¶³ï¼Œåƒ…ç™¼æ”¾ 3 æ”¯",
  "remaining_stock": 0,
  "requires_pharmacist_review": true
}

Response (Rejected):
{
  "status": "REJECTED",
  "action_id": "uuid-xxxx",
  "error_code": "ITEM_NOT_FOUND",
  "error_message": "è—¥å“ä»£ç¢¼ä¸å­˜åœ¨"
}
```

#### ç·Šæ€¥åŸå› ä»£ç¢¼ (Enum)

| ä»£ç¢¼ | ä¸­æ–‡ | èªªæ˜ |
|------|------|------|
| `PAIN_SEVERE` | åš´é‡ç–¼ç—› | ç–¼ç—›è©•åˆ† â‰¥7 |
| `TRAUMA_TREATMENT` | å‰µå‚·è™•ç½® | å¤–å‚·ã€ç‡’ç‡™å‚·ç­‰ |
| `ACLS_PROTOCOL` | ACLS æ€¥æ•‘ | å¿ƒè‚ºå¾©ç”¦æµç¨‹ç”¨è—¥ |
| `MASS_CASUALTY` | å¤§é‡å‚·æ‚£ | MCI æƒ…å¢ƒ |
| `INFECTION_SEVERE` | åš´é‡æ„ŸæŸ“ | æ•—è¡€ç—‡ç­‰ |
| `RESPIRATORY_DISTRESS` | å‘¼å¸çª˜è¿« | æ’ç®¡ã€å‘¼å¸è¡°ç«­ |
| `OTHER` | å…¶ä»– | éœ€å¡«å¯«èªªæ˜ |

---

## 6. åŒæ­¥å”è­°ï¼ˆv0.2 æ–°å¢ï¼‰

### 6.1 åŒæ­¥å›æ‡‰ç‹€æ…‹

| ç‹€æ…‹ | èªªæ˜ | å‰ç«¯è™•ç† |
|------|------|----------|
| `ACCEPTED` | æˆåŠŸè™•ç† | âœ… æ¨™è¨˜å®Œæˆ |
| `ACCEPTED_WITH_ADJUSTMENT` | æˆåŠŸä½†æœ‰èª¿æ•´ | âš ï¸ é¡¯ç¤ºèª¿æ•´èªªæ˜ï¼Œæ›´æ–°æœ¬åœ°æ•¸æ“š |
| `REJECTED` | æ‹’çµ•è™•ç† | âŒ é¡¯ç¤ºéŒ¯èª¤ï¼Œä¿ç•™å¾…äººå·¥è™•ç† |

### 6.2 å†ªç­‰æ€§ä¿è­‰

- æ¯å€‹æ“ä½œå¿…é ˆæœ‰å”¯ä¸€çš„ `action_id` (UUID)
- é‡è¤‡æäº¤ç›¸åŒ `action_id` è¿”å›ç›¸åŒçµæœ
- Hub ç¶­è­· `processed_action_ids` é˜²æ­¢é‡è¤‡è™•ç†

### 6.3 é›¢ç·šåº«å­˜é¡¯ç¤ºè¦å‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é›¢ç·šæ™‚åº«å­˜é¡¯ç¤ºè¦å‰‡                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. é¡¯ç¤ºæœ€å¾ŒåŒæ­¥çš„åº«å­˜æ•¸é‡                        â”‚
â”‚  2. æ¨™è¨»ã€Œé›¢ç·šå¿«å–ã€æç¤º                          â”‚
â”‚  3. é¡¯ç¤ºã€Œå·²æš«å­˜ N ç­†ç™¼è—¥å¾…åŒæ­¥ã€                  â”‚
â”‚  4. æš«å­˜ç™¼è—¥ä¸é æ‰£æœ¬åœ°åº«å­˜ï¼ˆHub ç‚ºæº–ï¼‰            â”‚
â”‚  5. åŒæ­¥å¾Œï¼Œæ ¹æ“š ACCEPTED_WITH_ADJUSTMENT        â”‚
â”‚     æ›´æ–°æœ¬åœ°å¿«å–                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4 åŒæ­¥æµç¨‹åœ–

```
PWA å•Ÿå‹•
    â”‚
    â”œâ”€ æª¢æŸ¥ device_id æ˜¯å¦åœ¨ revoked æ¸…å–®
    â”‚   â”œâ”€ æ˜¯ â†’ é¡¯ç¤ºã€Œè£ç½®å·²è¢«æ’¤éŠ·ã€ï¼Œæ¸…é™¤ Tokenï¼Œå¼·åˆ¶ç™»å‡º
    â”‚   â””â”€ å¦ â†’ ç¹¼çºŒ
    â”‚
    â”œâ”€ æª¢æŸ¥ç¶²è·¯ç‹€æ…‹
    â”‚
    â”œâ”€ å¦‚æœç·šä¸Š:
    â”‚   â”œâ”€ é€ç­†ä¸Šå‚³ pending actions
    â”‚   â”‚   â”œâ”€ ACCEPTED â†’ æ¨™è¨˜å®Œæˆ
    â”‚   â”‚   â”œâ”€ ACCEPTED_WITH_ADJUSTMENT â†’ æ¨™è¨˜å®Œæˆ + æ›´æ–°æœ¬åœ°
    â”‚   â”‚   â””â”€ REJECTED â†’ ä¿ç•™ä¸¦é¡¯ç¤ºéŒ¯èª¤
    â”‚   â”œâ”€ åˆ·æ–°éŸŒæ€§/åº«å­˜å¿«å–
    â”‚   â””â”€ æ›´æ–° lastSyncTime
    â”‚
    â””â”€ å¦‚æœé›¢ç·š:
        â”œâ”€ è¼‰å…¥å¿«å–è³‡æ–™
        â”œâ”€ é¡¯ç¤ºé›¢ç·šæŒ‡ç¤ºå™¨
        â””â”€ é¡¯ç¤ºã€Œå¾…åŒæ­¥ã€è¨ˆæ•¸
```

---

## 7. ç·Šæ€¥ç™¼è—¥æ”¿ç­–ï¼ˆv0.2 æ–°å¢ï¼‰

### 7.1 ç®¡åˆ¶è—¥å“è¦å‰‡

| è¦å‰‡ | èªªæ˜ |
|------|------|
| è¦‹è­‰äººå¿…å¡« | ç®¡åˆ¶è—¥å“ï¼ˆå¦‚ Morphineï¼‰å¿…é ˆæœ‰ç¬¬äºŒäººè¦‹è­‰ |
| å–®æ¬¡ä¸Šé™ | æ¯ç¨®ç®¡åˆ¶è—¥å“å–®æ¬¡ç™¼æ”¾ä¸Šé™ï¼ˆå¯è¨­å®šï¼Œä¾‹ï¼š5 æ”¯ï¼‰ |
| è¦†æ ¸ SLA | ç·Šæ€¥ç™¼è—¥å¾Œ 2 å°æ™‚å…§éœ€è—¥å¸«è¦†æ ¸ï¼ˆæ¼”ç¿’æ¨¡å¼ï¼‰ |

### 7.2 è¦†æ ¸æµç¨‹

```
ç·Šæ€¥ç™¼è—¥å®Œæˆ
    â”‚
    â”œâ”€ ç”¢ç”Ÿ audit_id
    â”œâ”€ æ¨™è¨˜ review_status = PENDING_REVIEW
    â”‚
    â””â”€ Hub Dashboard é¡¯ç¤ºã€Œå¾…è¦†æ ¸æ¸…å–®ã€
        â”‚
        â”œâ”€ è—¥å¸«é–‹å•Ÿè¦†æ ¸ä»‹é¢
        â”œâ”€ ç¢ºèªï¼šç™¼è—¥äººã€ç—…æ‚£ã€è—¥å“ã€æ•¸é‡ã€åŸå› ã€è¦‹è­‰äºº
        â”œâ”€ æ¨™è¨˜ review_status = REVIEWED
        â””â”€ è¨˜éŒ„ reviewer_staff_id, reviewed_at
```

### 7.3 å¾Œè£œç—…æ‚£æµç¨‹

ç•¶ `unknown_patient = true` æ™‚ï¼š
1. ç™¼è—¥å®Œæˆï¼Œaudit_id ç”¢ç”Ÿ
2. Hub Dashboard é¡¯ç¤ºã€Œå¾…è£œç™»ç—…æ‚£ã€æ¸…å–®
3. ç®¡ç†å“¡æ–¼ 2 å°æ™‚å…§è£œç™»ç—…æ‚£ ID
4. ç³»çµ±é—œè¯ audit_id èˆ‡ patient_id

---

## 8. å®‰å…¨è€ƒé‡ï¼ˆv0.2 å¼·åŒ–ï¼‰

### 8.1 èªè­‰

- 6 ä½æ•¸é…å°ç¢¼ï¼Œ5 åˆ†é˜æœ‰æ•ˆ
- API Rate Limiting: 5 æ¬¡/åˆ†é˜/IP
- JWT Token: 12 å°æ™‚æœ‰æ•ˆï¼Œå¯æ‰‹å‹•ç™»å‡º
- Device ID ç¶å®šï¼Œé˜²æ­¢ Token è¤‡è£½

### 8.2 è£ç½®æ’¤éŠ·æ©Ÿåˆ¶

```http
# æ’¤éŠ·è£ç½®ï¼ˆHub ç®¡ç†ä»‹é¢ï¼‰
POST /api/mirs-mobile/v1/admin/revoke-device
Authorization: Bearer {admin_token}
Content-Type: application/json

{
  "device_id": "uuid-xxxx",
  "reason": "è£ç½®éºå¤±"
}

Response:
{
  "success": true,
  "device_id": "uuid-xxxx",
  "revoked_at": "2025-12-18T15:00:00Z"
}
```

è¢«æ’¤éŠ·çš„è£ç½®ï¼š
1. ä¸‹æ¬¡åŒæ­¥æ™‚æ”¶åˆ° `403 Forbidden`
2. å‰ç«¯æ¸…é™¤æ‰€æœ‰ Token å’Œå¿«å–
3. é¡¯ç¤ºã€Œè£ç½®å·²è¢«æ’¤éŠ·ï¼Œè«‹é‡æ–°é…å°ã€

### 8.3 ç¨½æ ¸æ—¥èªŒ

æ¯ç­†å¯«å…¥æ“ä½œå¿…é ˆè¨˜éŒ„ï¼š
- `action_id` (æ“ä½œå”¯ä¸€è­˜åˆ¥)
- `device_id` (è£ç½®è­˜åˆ¥)
- `staff_id` (æ“ä½œäººå“¡)
- `timestamp` (æ“ä½œæ™‚é–“)
- `payload` (æ“ä½œå…§å®¹)

### 8.4 æ¬Šé™æ§åˆ¶

| è§’è‰² | è¨­å‚™æª¢æŸ¥ | åº«å­˜æŸ¥è©¢ | ç·Šæ€¥ç™¼è—¥ | æ­£å¸¸ç™¼è—¥ |
|------|----------|----------|----------|----------|
| nurse | âœ… | âœ… | âœ… | âœ… (éœ€PIN) |
| doctor | âœ… | âœ… | âœ… | âœ… |
| admin | âœ… | âœ… | âœ… | âœ… |
| readonly | âŒ | âœ… | âŒ | âŒ |

---

## 9. iOS å®‰è£èˆ‡ Fallbackï¼ˆv0.2 æ–°å¢ï¼‰

### 9.1 å®‰è£æŒ‡å—

> âš ï¸ **iPhone å¿…é ˆä½¿ç”¨ Safari**ï¼ŒChrome/Firefox ç„¡æ³•å®‰è£ PWA

1. é–‹å•Ÿ Safari
2. å‰å¾€ MIRS Mobile ç¶²å€
3. é»æ“Šåˆ†äº«æŒ‰éˆ• (â¬†ï¸)
4. é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€
5. é»æ“Šã€Œæ–°å¢ã€

### 9.2 ç›¸æ©Ÿæ¬Šé™

å¦‚æœç›¸æ©Ÿç„¡æ³•ä½¿ç”¨ï¼š
- iPhone: è¨­å®š â†’ Safari â†’ ç›¸æ©Ÿ â†’ å…è¨±
- Android: è¨­å®š â†’ æ‡‰ç”¨ç¨‹å¼ â†’ Chrome â†’ æ¬Šé™ â†’ ç›¸æ©Ÿ â†’ å…è¨±

### 9.3 æ‰‹å‹•è¼¸å…¥ Fallback

ç•¶ QR æƒæå¤±æ•—æ™‚ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æœ‰æ‰‹å‹•è¼¸å…¥å‚™æ´ï¼š

| åŠŸèƒ½ | æ‰‹å‹• Fallback |
|------|---------------|
| è¨­å‚™é¸æ“‡ | æœå°‹æ¬„ + æœ€è¿‘ä½¿ç”¨æ¸…å–® |
| è—¥å“é¸æ“‡ | æœå°‹æ¬„ + å¸¸ç”¨æ¸…å–® |
| ç—…æ‚£é¸æ“‡ | æœå°‹æ¬„ + æœ€è¿‘æ¸…å–® + ã€ŒæœªçŸ¥ç—…æ‚£ã€é¸é … |

---

## 10. å¯¦ä½œéšæ®µ

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ (MVP) âœ… å·²å®Œæˆ

**ç›®æ¨™**: å¯ç”¨æ–¼ç¾å ´æ¸¬è©¦çš„æœ€å°ç‰ˆæœ¬

**å®Œæˆæ—¥æœŸ**: 2025-12-19

**ç¯„åœ**:
- [x] é…å°èªè­‰ï¼ˆä½¿ç”¨ `/api/mirs-mobile/v1` å‘½åç©ºé–“ï¼‰
- [x] éŸŒæ€§å„€è¡¨æ¿é¦–é 
- [x] è¨­å‚™å¿«é€Ÿæª¢æŸ¥ï¼ˆå«æ‰‹å‹• Fallbackï¼‰
- [x] é›¢ç·šæš«å­˜ + è‡ªå‹•åŒæ­¥ï¼ˆå«ç‹€æ…‹è™•ç†ï¼‰
- [x] è£ç½®æ’¤éŠ·æª¢æŸ¥ï¼ˆAPI å·²å¯¦ä½œï¼ŒPWA å¾…æ•´åˆï¼‰

**å·²å¯¦ä½œ API**:
- `GET /api/mirs-mobile/v1/auth/pairing-qr` - QR Code åœ–ç‰‡ï¼ˆè‡ªå‹•åµæ¸¬ Hub IPï¼‰
- `GET /api/mirs-mobile/v1/auth/pairing-info` - é…å°è³‡è¨Š + é…å°ç¢¼
- `POST /api/mirs-mobile/v1/auth/exchange` - äº¤æ› Token
- `GET /api/mirs-mobile/v1/auth/verify` - é©—è­‰ Token
- `GET /api/mirs-mobile/v1/resilience` - éŸŒæ€§ç‹€æ…‹
- `GET /api/mirs-mobile/v1/equipment` - è¨­å‚™åˆ—è¡¨
- `POST /api/mirs-mobile/v1/equipment/{id}/check` - è¨­å‚™æª¢æŸ¥

**å·²çŸ¥å•é¡Œä¿®æ­£**:
1. `crypto.randomUUID()` åœ¨ iOS Safari < 15.4 ä¸æ”¯æ´ â†’ ä½¿ç”¨ fallback å‡½æ•¸
2. localhost QR Code â†’ è‡ªå‹•åµæ¸¬å¯¦éš›ç¶²è·¯ IP
3. é é¢å¿«å– â†’ æ–°å¢ no-cache headers

**å…ˆæ±ºæ¢ä»¶**: ç„¡

### Phase 2: åº«å­˜æŸ¥è©¢èˆ‡è¡€è¢‹å…¥åº« â³ é–‹ç™¼ä¸­

**ç›®æ¨™**: æ”¯æ´åº«å­˜å”¯è®€æŸ¥è©¢èˆ‡ä½é¢¨éšªå…¥åº«æ“ä½œ

**é–‹å§‹æ—¥æœŸ**: 2025-12-19

**å…ˆæ±ºæ¢ä»¶**:
- âœ… Phase 1 å®Œæˆ

**ç¯„åœ**:
- [x] åº«å­˜æŸ¥è©¢ï¼ˆå«é›¢ç·šå¿«å–ï¼‰
- [x] åº«å­˜æœå°‹èˆ‡ç¯©é¸
- [ ] åº«å­˜é …ç›®è©³æƒ…æ¨¡æ…‹çª—
- [ ] è¡€è¢‹å…¥åº«åŠŸèƒ½ï¼ˆå ±åˆ°å€æ¥æ”¶æè¡€ä¸­å¿ƒè¡€è¢‹ã€ç¾å ´æè¡€ç«™ï¼‰
- [ ] è©¦åŠ‘æ•ˆæœŸè¿½è¹¤

**å·²å¯¦ä½œåŠŸèƒ½**:
- åº«å­˜æ¸…å–®é¡¯ç¤º
- æœå°‹åŠŸèƒ½ï¼ˆåç¨±ã€ä»£ç¢¼ï¼‰
- ç¯©é¸åŠŸèƒ½ï¼ˆå…¨éƒ¨/è—¥å“/è€—æ/ä½åº«å­˜ï¼‰
- ä½åº«å­˜è­¦å‘Šæç¤º
- é›¢ç·šå¿«å–æ”¯æ´

**ç‰©å“åˆ†é¡è¦å‰‡**:
| ä»£ç¢¼å‰ç¶´ | åˆ†é¡ | åœ–ç¤ºé¡è‰² | èªªæ˜ |
|---------|------|---------|------|
| `MED-` | è—¥å“ | ç´«è‰² | ä¸€èˆ¬è—¥å“ |
| `EMER-` | æ€¥æ•‘è—¥ç‰© | ç´…è‰² | æ€¥æ•‘è—¥å“ï¼ˆå±¬è—¥å“é¡ï¼‰|
| `REA-` | è©¦åŠ‘ | ç¥ç€è‰² | æª¢é©—è©¦åŠ‘ï¼ˆæœ‰æ•ˆæœŸè¿½è¹¤ï¼‰|
| å…¶ä»– | è€—æ | é’è‰² | ä¸€èˆ¬è€—æ |

### Phase 3: é€²éšåŠŸèƒ½

**ç›®æ¨™**: å®Œæ•´é†«ç™‚ç«™è¡Œå‹•æ”¯æ´ï¼ˆå”¯è®€+ä½é¢¨éšªæ“ä½œï¼‰

**ç¯„åœ**:
- [ ] æ°§æ°£ç“¶å€‹åˆ¥è¿½è¹¤
- [ ] WebSocket å³æ™‚æ›´æ–°
- [ ] è€—æå¿«é€Ÿæ¶ˆè€—ç™»è¨˜ï¼ˆéè—¥å“ï¼‰

---

## 10.1 PWA åŠŸèƒ½é‚Šç•Œ (v0.5 æ–°å¢)

> âš ï¸ **è¨­è¨ˆåŸå‰‡**ï¼šPWA åªè™•ç†ã€Œä½é¢¨éšªã€æ“ä½œï¼Œé«˜æ•æ„Ÿæ“ä½œä¿ç•™åœ¨ Hub Dashboard

### å…è¨±ä¸‹æ”¾è‡³ PWA çš„æ“ä½œ

| æ“ä½œ | é¢¨éšªç­‰ç´š | ç†ç”± |
|------|---------|------|
| è¨­å‚™å·¡æª¢ | ä½ | åƒ…ç‹€æ…‹æ›´æ–°ï¼Œç„¡ç‰©è³‡ç•°å‹• |
| åº«å­˜æŸ¥è©¢ | ä½ | å”¯è®€æ“ä½œ |
| è¡€è¢‹å…¥åº« | ä½ | å…¥åº«æ“ä½œï¼Œç¨½æ ¸éœ€æ±‚ä½ï¼ˆè¨˜éŒ„èª°ã€ä½•æ™‚ã€å¤šå°‘è¢‹ï¼‰|
| è©¦åŠ‘æ•ˆæœŸè¿½è¹¤ | ä½ | å”¯è®€+æé†’åŠŸèƒ½ |
| è€—ææ¶ˆè€—ç™»è¨˜ | ä¸­ä½ | éç®¡åˆ¶ç‰©è³‡ï¼Œäº‹å¾Œå¯èª¿æ•´ |

### ä¸ä¸‹æ”¾è‡³ PWA çš„æ“ä½œ

| æ“ä½œ | é¢¨éšªç­‰ç´š | ç†ç”± |
|------|---------|------|
| è—¥å“ç™¼æ”¾ï¼ˆå«ç·Šæ€¥ï¼‰ | é«˜ | éœ€è—¥å¸«/é†«å¸«è¦†æ ¸ã€ç—…æ‚£èº«ä»½ç¢ºèªã€ç”¨è—¥åŠ‘é‡æ ¸å° |
| è¡€è¢‹é ˜ç”¨ | é«˜ | éœ€è¡€å‹æ ¸å°ï¼ˆABO + Rhï¼‰ã€äº¤å‰è©¦é©—ç¢ºèªã€è¼¸è¡€åæ‡‰ç›£æ¸¬ |
| ç®¡åˆ¶è—¥å“æ“ä½œ | æ¥µé«˜ | éœ€è¦‹è­‰äººã€å®Œæ•´ç¨½æ ¸éˆã€é›™é‡ç¢ºèª |
| æ‰‹è¡“è€—æè¨˜éŒ„ | ä¸­é«˜ | éœ€èˆ‡æ‰‹è¡“è¨˜éŒ„é—œè¯ã€è¡“ä¸­å³æ™‚æ€§ã€ç„¡èŒç’°å¢ƒé™åˆ¶ |

### å ´æ™¯èªªæ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å ±åˆ°å€ / é–€å£                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“± PWA å¯ç”¨æ“ä½œ:                                        â”‚    â”‚
â”‚  â”‚   â€¢ æ¥æ”¶æè¡€ä¸­å¿ƒè¡€è¢‹ â†’ è¡€è¢‹å…¥åº«                          â”‚    â”‚
â”‚  â”‚   â€¢ ç¾å ´æè¡€ç«™è¡€è¢‹ç™»è¨˜                                   â”‚    â”‚
â”‚  â”‚   â€¢ ç‰©è³‡å…¥åº«ç™»è¨˜ï¼ˆéè—¥å“ï¼‰                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è™•ç½®å€ / æ‰‹è¡“å®¤ï¼ˆPi Hub æ‰€åœ¨ä½ç½®ï¼‰                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ–¥ï¸ Hub Dashboard å°ˆå±¬æ“ä½œ:                              â”‚    â”‚
â”‚  â”‚   â€¢ è—¥å“ç™¼æ”¾ï¼ˆå«ç·Šæ€¥ç™¼è—¥ + è¦†æ ¸ï¼‰                        â”‚    â”‚
â”‚  â”‚   â€¢ è¡€è¢‹é ˜ç”¨ï¼ˆå«è¡€å‹æ ¸å°ï¼‰                               â”‚    â”‚
â”‚  â”‚   â€¢ ç®¡åˆ¶è—¥å“ç™¼æ”¾ï¼ˆå«è¦‹è­‰äººï¼‰                             â”‚    â”‚
â”‚  â”‚   â€¢ æ‰‹è¡“è€—æè¨˜éŒ„                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ ğŸ“± PWA å¯ç”¨æ“ä½œ:                                        â”‚    â”‚
â”‚  â”‚   â€¢ è¨­å‚™å·¡æª¢                                            â”‚    â”‚
â”‚  â”‚   â€¢ åº«å­˜æŸ¥è©¢ï¼ˆå”¯è®€ï¼‰                                    â”‚    â”‚
â”‚  â”‚   â€¢ è©¦åŠ‘æ•ˆæœŸç¢ºèª                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¡€è¢‹å…¥åº« API è¨­è¨ˆï¼ˆPhase 2ï¼‰

```http
POST /api/mirs-mobile/v1/blood/receive
Authorization: Bearer {token}
Content-Type: application/json

{
  "action_id": "uuid-xxxx",
  "blood_type": "O+",
  "quantity": 2,
  "source": "BLOOD_CENTER",        // BLOOD_CENTER, ON_SITE_DONATION
  "donor_id": "D-2025-001",        // é¸å¡«ï¼šæè¡€è€…IDï¼ˆç¾å ´æè¡€æ™‚ï¼‰
  "batch_number": "BC-2025-1219",  // æè¡€ä¸­å¿ƒæ‰¹è™Ÿ
  "expiry_date": "2025-01-19",
  "notes": "æè¡€ä¸­å¿ƒé€é”"
}

Response:
{
  "status": "ACCEPTED",
  "action_id": "uuid-xxxx",
  "blood_type": "O+",
  "quantity_received": 2,
  "new_total": 5,
  "received_at": "2025-12-19T15:00:00Z",
  "received_by": "NURSE-001"
}
```

### åº«å­˜ç›¤é»æ ¸å° API è¨­è¨ˆï¼ˆPhase 2ï¼‰

```http
POST /api/inventory-check
Authorization: Bearer {token}
Content-Type: application/json

{
  "station_id": "STATION-001",
  "checker_id": "NURSE-001",
  "checker_name": "ç‹å°æ˜",
  "checked_at": "2025-12-19T16:30:00Z",
  "total_items": 150,
  "confirmed_count": 145,
  "error_count": 5,
  "errors": [
    {
      "item_code": "MED-001",
      "notes": "å¯¦éš›æ•¸é‡ 48ï¼Œç³»çµ±é¡¯ç¤º 50",
      "checked_at": "2025-12-19T16:25:00Z"
    },
    {
      "item_code": "EMER-003",
      "notes": "ä½ç½®éŒ¯èª¤ï¼Œæ‡‰åœ¨æ€¥æ•‘ç®± A",
      "checked_at": "2025-12-19T16:28:00Z"
    }
  ]
}

Response:
{
  "status": "ACCEPTED",
  "check_id": "CHK-2025-1219-001",
  "station_id": "STATION-001",
  "checker_name": "ç‹å°æ˜",
  "summary": {
    "total": 150,
    "confirmed": 145,
    "errors": 5
  },
  "errors_queued": 5,
  "received_at": "2025-12-19T16:30:00Z"
}
```

#### ç›¤é»è¨˜éŒ„æŸ¥è©¢ API

```http
GET /api/inventory-check/history
Authorization: Bearer {token}

Query Parameters:
- station_id: ç«™é» IDï¼ˆé¸å¡«ï¼‰
- from_date: èµ·å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- to_date: çµæŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰
- limit: ç­†æ•¸é™åˆ¶ï¼ˆé è¨­ 50ï¼‰

Response:
{
  "checks": [
    {
      "check_id": "CHK-2025-1219-001",
      "station_id": "STATION-001",
      "checker_name": "ç‹å°æ˜",
      "checked_at": "2025-12-19T16:30:00Z",
      "total_items": 150,
      "confirmed_count": 145,
      "error_count": 5,
      "errors_resolved": 3,
      "errors_pending": 2
    }
  ],
  "total_count": 15
}
```

#### ç›¤é»éŒ¯èª¤è™•ç† API

```http
POST /api/inventory-check/resolve-error
Authorization: Bearer {token}
Content-Type: application/json

{
  "check_id": "CHK-2025-1219-001",
  "item_code": "MED-001",
  "resolution": "ADJUSTED",       // ADJUSTED, NO_ACTION, DISCARDED
  "actual_quantity": 48,          // å¦‚æœæ˜¯ ADJUSTED
  "resolver_id": "ADMIN-001",
  "resolver_name": "æç®¡ç†å“¡",
  "notes": "å·²èª¿æ•´ç³»çµ±æ•¸é‡ç‚º 48"
}

Response:
{
  "status": "RESOLVED",
  "check_id": "CHK-2025-1219-001",
  "item_code": "MED-001",
  "resolution": "ADJUSTED",
  "resolved_at": "2025-12-19T17:00:00Z"
}
```

---

## 11. èˆ‡ CIRS Satellite çš„ç¨‹å¼ç¢¼å…±ç”¨

### 11.1 å¯å…±ç”¨æ¨¡çµ„

```
/shared/
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ pairing-code-flow.js   # 6 ä½æ•¸é…å°ç¢¼é‚è¼¯
â”‚   â””â”€â”€ jwt-storage.js         # Token ç®¡ç†
â”œâ”€â”€ sync/
â”‚   â”œâ”€â”€ action-envelope.js     # é›¢ç·šæ“ä½œæš«å­˜
â”‚   â”œâ”€â”€ sync-manager.js        # åŒæ­¥æ’ç¨‹ï¼ˆv0.2: åŠ å…¥ç‹€æ…‹è™•ç†ï¼‰
â”‚   â””â”€â”€ network-status.js      # é€£ç·šç‹€æ…‹åµæ¸¬
â””â”€â”€ ui/
    â”œâ”€â”€ loading-screen.js      # CDN è¼‰å…¥åµæ¸¬
    â”œâ”€â”€ offline-indicator.js   # é›¢ç·šæç¤º
    â””â”€â”€ manual-fallback.js     # æ‰‹å‹•è¼¸å…¥å…ƒä»¶ï¼ˆv0.2 æ–°å¢ï¼‰
```

### 11.2 MIRS å°ˆç”¨æ¨¡çµ„

```
/mirs-mobile/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ resilience-dashboard.js
â”‚   â”œâ”€â”€ equipment-check.js
â”‚   â”œâ”€â”€ dispense-emergency.js    # v0.2: é‡æ–°è¨­è¨ˆ
â”‚   â””â”€â”€ inventory-query.js
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ resilience-api.js
â”‚   â”œâ”€â”€ equipment-api.js
â”‚   â””â”€â”€ dispense-api.js          # v0.2: æ–°å¢ç¨½æ ¸é‚è¼¯
â””â”€â”€ components/
    â”œâ”€â”€ patient-selector.js      # v0.2: ç—…æ‚£é¸æ“‡å™¨
    â”œâ”€â”€ medication-selector.js   # v0.2: è—¥å“é¸æ“‡å™¨
    â””â”€â”€ witness-selector.js      # v0.2: è¦‹è­‰äººé¸æ“‡å™¨
```

---

## 12. æ¸¬è©¦è¨ˆç•«

### 12.1 åŠŸèƒ½æ¸¬è©¦

- [ ] é…å°æµç¨‹ï¼ˆæ­£å¸¸ / éæœŸ / éŒ¯èª¤ç¢¼ï¼‰
- [ ] è¨­å‚™æª¢æŸ¥æµç¨‹ï¼ˆç·šä¸Š / é›¢ç·š / æ‰‹å‹•è¼¸å…¥ï¼‰
- [ ] ç·Šæ€¥ç™¼è—¥æµç¨‹ï¼ˆå«ç®¡åˆ¶è—¥ã€æœªçŸ¥ç—…æ‚£ï¼‰
- [ ] é›¢ç·šâ†’ç·šä¸ŠåŒæ­¥ï¼ˆACCEPTED / ADJUSTED / REJECTEDï¼‰
- [ ] è£ç½®æ’¤éŠ·æµç¨‹

### 12.2 è£ç½®æ¸¬è©¦

- [ ] iPhone Safari (iOS 15+)
- [ ] Android Chrome (Android 8+)
- [ ] iPad Safari
- [ ] Android å¹³æ¿

### 12.3 ç¨½æ ¸æ¸¬è©¦

- [ ] è¦†æ ¸ä½‡åˆ—åŠŸèƒ½
- [ ] å¾Œè£œç—…æ‚£æµç¨‹
- [ ] ç¨½æ ¸æ—¥èªŒå®Œæ•´æ€§

---

## é™„éŒ„ A: ç¾æœ‰ MIRS API ç›¤é»

| ç«¯é» | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| `/api/mirs-mobile/v1/auth/pairing` | ğŸ†• æ–°å¢ | ç”¢ç”Ÿé…å°ç¢¼ |
| `/api/mirs-mobile/v1/auth/exchange` | ğŸ†• æ–°å¢ | äº¤æ› Token |
| `/api/mirs-mobile/v1/resilience` | ğŸ†• æ–°å¢ | éŸŒæ€§ç‹€æ…‹ |
| `/api/mirs-mobile/v1/equipment` | ğŸ†• æ–°å¢ | è¨­å‚™åˆ—è¡¨ |
| `/api/mirs-mobile/v1/equipment/{id}/check` | ğŸ†• æ–°å¢ | æ›´æ–°ç‹€æ…‹ |
| `/api/mirs-mobile/v1/dispense/emergency` | ğŸ†• æ–°å¢ | ç·Šæ€¥ç™¼è—¥ï¼ˆé†«ç™‚ç´šç¨½æ ¸ï¼‰ |
| `/api/mirs-mobile/v1/inventory` | ğŸ†• æ–°å¢ | ç°¡åŒ–åº«å­˜æŸ¥è©¢ |
| `/api/mirs-mobile/v1/admin/revoke-device` | ğŸ†• æ–°å¢ | æ’¤éŠ·è£ç½® |

---

## é™„éŒ„ B: å¯©æŸ¥å›é¥‹ä¾†æº

æœ¬ v0.2 ç‰ˆæœ¬æ ¹æ“šä»¥ä¸‹ AI å¯©æŸ¥æ„è¦‹æ›´æ–°ï¼š

1. **ChatGPT** - æŒ‡å‡ºç·Šæ€¥ç™¼è—¥ API ç¨½æ ¸ä¸è¶³ã€åŒæ­¥å”è­°æœªå®šç¾©ã€å®‰å…¨ç¯„åœä¸å¤ ç´°ç·»
2. **Gemini** - å¼·èª¿ã€Œä¸èƒ½æŠŠç™¼è—¥ç•¶ç™¼ä¾¿ç•¶è¨­è¨ˆã€ï¼Œå»ºè­°æš«ç·© Phase 2 ç›´åˆ°è³‡æ–™çµæ§‹å®šæ¡ˆ

---

*Document Version: 0.2*
*Created: 2025-12-18*
*Updated: 2025-12-18*
*Author: De Novo Orthopedics Inc.*
