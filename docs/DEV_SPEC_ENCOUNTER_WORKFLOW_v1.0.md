# xIRS å°±è¨ºæµç¨‹æ”¹é€²è¦æ ¼æ›¸

**Version:** 1.0 (Draft)
**Date:** 2026-01-01
**Status:** å¾…è¨è«–

---

## 1. å•é¡Œæè¿°

### 1.1 ç¾ç‹€

ç›®å‰çš„æµç¨‹ï¼š

```
æ›è™Ÿ (CIRS)
    â†“
çœ‹è¨ºä¸­ (Doctor PWA é¸å–ç—…æ‚£)
    â†“
??? (å®Œæˆçœ‹è¨ºå¾Œï¼Œç‹€æ…‹ä¸æ˜ç¢º)
```

**å•é¡Œï¼š**
1. æ›è™Ÿå¾Œç—…æ‚£æœƒå‡ºç¾åœ¨éº»é†‰ PWA çš„ã€Œæ–°å¢éº»é†‰æ¡ˆä¾‹ã€å€™è¨ºåå–®
2. ä½†ä¸€æ—¦è¢« Doctor PWA é¸ç‚ºã€Œçœ‹è¨ºä¸­ã€ï¼Œå°±å¾éº»é†‰ PWA æ¶ˆå¤±
3. æ²’æœ‰æ˜ç¢ºçš„ã€Œéœ€è™•ç½®ã€ã€Œéœ€éº»é†‰ã€æ¨™è¨˜æ©Ÿåˆ¶
4. è™•ç½®è¨˜éŒ„å’Œéº»é†‰æ¡ˆä¾‹çš„å»ºç«‹éƒ½æ˜¯ã€Œæ–°å¢ã€æ¨¡å¼ï¼Œæ²’æœ‰å€™è¨ºæ¸…å–®

### 1.2 æœŸæœ›æµç¨‹

```
æ›è™Ÿ (CIRS)
    â†“
çœ‹è¨º (Doctor PWA)
    â†“
çœ‹è¨ºå®Œæˆ â†’ æ¨™è¨˜ï¼š
    â”œâ”€â”€ â˜‘ éœ€è™•ç½® â†’ ç—…æ‚£å‡ºç¾åœ¨ã€Œå¾…è™•ç½®ã€æ¸…å–®
    â”œâ”€â”€ â˜‘ éœ€éº»é†‰ â†’ ç—…æ‚£å‡ºç¾åœ¨ã€Œå¾…éº»é†‰ã€æ¸…å–®
    â””â”€â”€ é è¨­åªæœ‰é–‹è—¥ï¼Œä¸éœ€é¡å¤–æ¨™è¨˜
```

---

## 2. ææ¡ˆï¼šRegistration Status æ“´å±•

### 2.1 æ–°å¢ç‹€æ…‹æ¬„ä½

```sql
-- registrations è¡¨æ–°å¢æ¬„ä½
ALTER TABLE registrations ADD COLUMN needs_procedure INTEGER DEFAULT 0;
ALTER TABLE registrations ADD COLUMN needs_anesthesia INTEGER DEFAULT 0;
ALTER TABLE registrations ADD COLUMN consultation_completed_at TIMESTAMP;
ALTER TABLE registrations ADD COLUMN consultation_by TEXT;
```

### 2.2 ç‹€æ…‹æµè½‰

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    Registration Status                   â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚                                                          â”‚
   WAITING â”€â”€â”€â”€â”€â”€â–¶ IN_CONSULTATION â”€â”€â”€â”€â”€â”€â–¶ CONSULTATION_DONE                  â”‚
      â”‚                   â”‚                       â”‚                            â”‚
      â”‚                   â”‚                       â”œâ”€â”€ needs_procedure = 1      â”‚
      â”‚                   â”‚                       â”‚   â†’ é¡¯ç¤ºåœ¨ã€Œå¾…è™•ç½®ã€        â”‚
      â”‚                   â”‚                       â”‚                            â”‚
      â”‚                   â”‚                       â”œâ”€â”€ needs_anesthesia = 1     â”‚
      â”‚                   â”‚                       â”‚   â†’ é¡¯ç¤ºåœ¨ã€Œå¾…éº»é†‰ã€        â”‚
      â”‚                   â”‚                       â”‚                            â”‚
      â”‚                   â”‚                       â””â”€â”€ å…©è€…çš†å¦                  â”‚
      â”‚                   â”‚                           â†’ ç›´æ¥ COMPLETED          â”‚
      â”‚                   â”‚                                                     â”‚
      â”‚                   â”‚                                                     â”‚
      â”‚                   â–¼                                                     â”‚
      â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
      â”‚            â”‚  Doctor PWA  â”‚                                            â”‚
      â”‚            â”‚  å®Œæˆçœ‹è¨º    â”‚                                            â”‚
      â”‚            â”‚  â˜ éœ€è™•ç½®    â”‚                                            â”‚
      â”‚            â”‚  â˜ éœ€éº»é†‰    â”‚                                            â”‚
      â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
      â”‚                                                                         â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 å­ç‹€æ…‹èˆ‡ PWA å°æ‡‰

| needs_procedure | needs_anesthesia | é¡¯ç¤ºæ¸…å–® | è™•ç†ç«™ |
|-----------------|------------------|----------|--------|
| 0 | 0 | ï¼ˆå®Œæˆï¼‰ | - |
| 1 | 0 | å¾…è™•ç½® | Station PWA / Procedure PWA |
| 0 | 1 | å¾…éº»é†‰ | Anesthesia PWA |
| 1 | 1 | å¾…è™•ç½® + å¾…éº»é†‰ | å…©è€…çš†å¯é¸å– |

---

## 3. API è®Šæ›´

### 3.1 Doctor PWA - å®Œæˆçœ‹è¨º

**ç¾æœ‰ï¼š** æ²’æœ‰æ˜ç¢ºçš„ã€Œå®Œæˆçœ‹è¨ºã€API

**æ–°å¢ï¼š**

```
POST /api/registrations/{reg_id}/complete-consultation
```

**Request:**
```json
{
  "needs_procedure": true,
  "needs_anesthesia": false,
  "notes": "å³è…¿æ¸…å‰µè¡“"
}
```

**Response:**
```json
{
  "success": true,
  "registration_id": "REG-20260101-001",
  "status": "CONSULTATION_DONE",
  "needs_procedure": true,
  "needs_anesthesia": false,
  "queues_added": ["PROCEDURE"]
}
```

### 3.2 å¾…è™•ç½®æ¸…å–®

**æ–°å¢ï¼š**

```
GET /api/registrations/waiting/procedure
```

**Response:**
```json
{
  "items": [
    {
      "registration_id": "REG-20260101-001",
      "patient_id": "P001",
      "patient_name": "ç‹å°æ˜",
      "triage_category": "YELLOW",
      "chief_complaint": "å³è…¿éª¨æŠ˜",
      "consultation_by": "Dr. æ",
      "consultation_completed_at": "2026-01-01T10:30:00",
      "notes": "å³è…¿æ¸…å‰µè¡“",
      "waiting_minutes": 15
    }
  ]
}
```

### 3.3 å¾…éº»é†‰æ¸…å–®

**æ–°å¢ï¼š**

```
GET /api/registrations/waiting/anesthesia
```

**Response:** åŒä¸Šçµæ§‹

### 3.4 è™•ç½®å®Œæˆ

**æ–°å¢ï¼š**

```
POST /api/registrations/{reg_id}/procedure-done
```

**Request:**
```json
{
  "procedure_case_id": "PROC-20260101-001"
}
```

### 3.5 éº»é†‰å®Œæˆ

**ç¾æœ‰ Anesthesia API å·²æœ‰æ¡ˆä¾‹é—œé–‰æ©Ÿåˆ¶**

```
POST /api/anesthesia/cases/{case_id}/close
```

**è®Šæ›´ï¼š** é—œé–‰æ¡ˆä¾‹æ™‚ï¼Œè‡ªå‹•æ›´æ–° `registrations.needs_anesthesia = 0`

---

## 4. UI è®Šæ›´

### 4.1 Doctor PWA - å®Œæˆçœ‹è¨º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®Œæˆçœ‹è¨º                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ç—…æ‚£ï¼šç‹å°æ˜ (REG-20260101-001)                                 â”‚
â”‚  ä¸»è¨´ï¼šå³è…¿éª¨æŠ˜                                                  â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ â˜ éœ€è™•ç½®                                                    â”‚â”‚
â”‚  â”‚   è™•ç½®èªªæ˜ï¼š[________________________]                       â”‚â”‚
â”‚  â”‚                                                              â”‚â”‚
â”‚  â”‚ â˜ éœ€éº»é†‰                                                    â”‚â”‚
â”‚  â”‚   éº»é†‰å‚™è¨»ï¼š[________________________]                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  å·²é–‹ç«‹è™•æ–¹ï¼š                                                    â”‚
â”‚  - Cefazolin 1g IV q8h                                          â”‚
â”‚  - Tramadol 50mg PO PRN                                         â”‚
â”‚                                                                  â”‚
â”‚                                        [å–æ¶ˆ]  [å®Œæˆçœ‹è¨º]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Anesthesia PWA - æ–°å¢æ¡ˆä¾‹

**ç¾æœ‰è¨­è¨ˆï¼š** ã€Œæ–°å¢éº»é†‰æ¡ˆä¾‹ã€æŒ‰éˆ•ï¼Œæ‰‹å‹•è¼¸å…¥ç—…æ­·è™Ÿ

**æ–°è¨­è¨ˆï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å¢éº»é†‰æ¡ˆä¾‹                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ å¾…éº»é†‰æ¸…å–®                                            [é‡æ•´]â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸŸ¡ ***0042 ç‹å°æ˜                                           â”‚â”‚
â”‚  â”‚    å³è…¿éª¨æŠ˜æ¸…å‰µè¡“ Â· é†«å¸«ï¼šDr. æ                             â”‚â”‚
â”‚  â”‚    ç­‰å¾… 15 åˆ†é˜                                      [é¸å–] â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸŸ¢ ***0088 æå°è¯                                           â”‚â”‚
â”‚  â”‚    è…¹éƒ¨æ¢æŸ¥è¡“ Â· é†«å¸«ï¼šDr. é™³                                 â”‚â”‚
â”‚  â”‚    ç­‰å¾… 5 åˆ†é˜                                       [é¸å–] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æˆ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                  â”‚
â”‚  [æƒæå‚·ç¥¨ QR]  [æ‰‹å‹•è¼¸å…¥ï¼ˆç·Šæ€¥ï¼‰]                                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Station/Procedure PWA - å¾…è™•ç½®æ¸…å–®

é¡ä¼¼è¨­è¨ˆï¼Œé¡¯ç¤º `needs_procedure = 1` çš„ç—…æ‚£

---

## 5. è³‡æ–™æµæ•´åˆ

### 5.1 å®Œæ•´æµç¨‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                              â”‚
â”‚  CIRS Admin                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                â”‚
â”‚  â”‚  æ›è™Ÿ   â”‚ â”€â”€â”€â”€â”€â”€â”€â–¶ registrations (status: WAITING)                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                â”‚
â”‚                           â”‚                                                  â”‚
â”‚                           â–¼                                                  â”‚
â”‚  Doctor PWA              GET /api/registrations/waiting/list                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚                                                  â”‚
â”‚  â”‚ é¸å–ç—…æ‚£â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚ POST /api/registrations/{id}/claim                                  â”‚
â”‚       â–¼                                                                      â”‚
â”‚  status: IN_CONSULTATION                                                     â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚ [çœ‹è¨ºä¸­... é–‹è—¥ã€è¨ºæ–·]                                               â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”‚ POST /api/registrations/{id}/complete-consultation                  â”‚
â”‚       â”‚ { needs_procedure: true, needs_anesthesia: true }                   â”‚
â”‚       â–¼                                                                      â”‚
â”‚  status: CONSULTATION_DONE                                                   â”‚
â”‚  needs_procedure: 1                                                          â”‚
â”‚  needs_anesthesia: 1                                                         â”‚
â”‚       â”‚                                                                      â”‚
â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚       â”‚                                                          â”‚          â”‚
â”‚       â–¼                                                          â–¼          â”‚
â”‚  Procedure PWA                                            Anesthesia PWA     â”‚
â”‚  GET /api/registrations/waiting/procedure      GET /api/registrations/waiting/anesthesia
â”‚       â”‚                                                          â”‚          â”‚
â”‚       â”‚ [é¸å–ç—…æ‚£ï¼Œå»ºç«‹è™•ç½®]                        [é¸å–ç—…æ‚£ï¼Œå»ºç«‹éº»é†‰æ¡ˆä¾‹]  â”‚
â”‚       â”‚                                                          â”‚          â”‚
â”‚       â”‚ POST /api/registrations/{id}/procedure-done              â”‚          â”‚
â”‚       â–¼                                                          â”‚          â”‚
â”‚  needs_procedure: 0                                              â”‚          â”‚
â”‚       â”‚                                                          â”‚          â”‚
â”‚       â”‚                                    POST /api/anesthesia/cases/{id}/close
â”‚       â”‚                                                          â”‚          â”‚
â”‚       â”‚                                                          â–¼          â”‚
â”‚       â”‚                                                  needs_anesthesia: 0 â”‚
â”‚       â”‚                                                          â”‚          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚                           status: COMPLETED                                  â”‚
â”‚                           (ç•¶ needs_procedure = 0 AND needs_anesthesia = 0) â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Hub-Satellite åŒæ­¥è€ƒé‡

| è³‡æ–™ | æ¬Šå¨ä¾†æº | åŒæ­¥æ–¹å‘ |
|------|----------|----------|
| registrations.needs_procedure | CIRS Hub | Hub â†’ MIRS Satellite |
| registrations.needs_anesthesia | CIRS Hub | Hub â†’ MIRS Satellite |
| procedure_cases | MIRS Satellite | Satellite â†’ Hub (å®Œæˆé€šçŸ¥) |
| anesthesia_cases | MIRS Satellite | Satellite â†’ Hub (å®Œæˆé€šçŸ¥) |

---

## 6. é·ç§»è¨ˆç•«

### 6.1 Phase 1ï¼šè³‡æ–™åº«è®Šæ›´

```sql
-- CIRS database
ALTER TABLE registrations ADD COLUMN needs_procedure INTEGER DEFAULT 0;
ALTER TABLE registrations ADD COLUMN needs_anesthesia INTEGER DEFAULT 0;
ALTER TABLE registrations ADD COLUMN consultation_completed_at TIMESTAMP;
ALTER TABLE registrations ADD COLUMN consultation_by TEXT;
ALTER TABLE registrations ADD COLUMN procedure_notes TEXT;
ALTER TABLE registrations ADD COLUMN anesthesia_notes TEXT;
```

### 6.2 Phase 2ï¼šAPI å¯¦ä½œ

1. `POST /api/registrations/{id}/complete-consultation`
2. `GET /api/registrations/waiting/procedure`
3. `GET /api/registrations/waiting/anesthesia`
4. `POST /api/registrations/{id}/procedure-done`
5. ä¿®æ”¹ Anesthesia case close é‚è¼¯

### 6.3 Phase 3ï¼šUI æ›´æ–°

1. Doctor PWAï¼šæ–°å¢ã€Œå®Œæˆçœ‹è¨ºã€å°è©±æ¡†
2. Anesthesia PWAï¼šä¿®æ”¹ã€Œæ–°å¢æ¡ˆä¾‹ã€ç‚ºã€Œå¾…éº»é†‰æ¸…å–®ã€å„ªå…ˆ
3. Station/Procedure PWAï¼šæ–°å¢ã€Œå¾…è™•ç½®ã€æ¸…å–®

### 6.4 Phase 4ï¼šHub-Satellite åŒæ­¥

1. åŒæ­¥ `needs_procedure` / `needs_anesthesia` æ¬„ä½
2. è™•ç½®/éº»é†‰å®Œæˆé€šçŸ¥ Hub

---

## 7. å¾…è¨è«–å•é¡Œ

### ğŸ¯ å•é¡Œ 1ï¼šå¤šé‡éœ€æ±‚è™•ç†é †åº

è‹¥ `needs_procedure = 1` ä¸” `needs_anesthesia = 1`ï¼š
- æ˜¯å¦éœ€è¦æŒ‡å®šé †åºï¼Ÿï¼ˆä¾‹å¦‚ï¼šå…ˆéº»é†‰å†è™•ç½®ï¼‰
- æˆ–è€…ç”±æ“ä½œäººå“¡è‡ªè¡Œåˆ¤æ–·ï¼Ÿ

### ğŸ¯ å•é¡Œ 2ï¼šç·Šæ€¥æ’éšŠæ©Ÿåˆ¶

æ€¥è¨ºç—…æ‚£å¯èƒ½éœ€è¦è·³éçœ‹è¨ºï¼Œç›´æ¥é€²å…¥éº»é†‰/è™•ç½®ï¼š
- æ˜¯å¦éœ€è¦ã€Œç·Šæ€¥é€šé“ã€ï¼Ÿ
- å¦‚ä½•è¨˜éŒ„è·³éçœ‹è¨ºçš„åŸå› ï¼Ÿ

### ğŸ¯ å•é¡Œ 3ï¼šå–æ¶ˆæ©Ÿåˆ¶

è‹¥é†«å¸«æ¨™è¨˜ã€Œéœ€è™•ç½®ã€å¾Œï¼Œç—…æ‚£æ”¹è®Šä¸»æ„ï¼š
- å¦‚ä½•å–æ¶ˆï¼Ÿ
- æ˜¯å¦éœ€è¦è¨˜éŒ„å–æ¶ˆåŸå› ï¼Ÿ

### ğŸ¯ å•é¡Œ 4ï¼šé›¢ç·šæ™‚çš„æ¸…å–®åŒæ­¥

MIRS Satellite é›¢ç·šæ™‚ï¼š
- æ˜¯å¦å¿«å–æœ€è¿‘çš„å¾…è™•ç½®/å¾…éº»é†‰æ¸…å–®ï¼Ÿ
- å¦‚ä½•è™•ç†æ¸…å–®éæœŸçš„å•é¡Œï¼Ÿ

---

## 8. é™„éŒ„ï¼šç¾æœ‰ç›¸é—œè¦æ ¼

- `docs/DEV_SPEC_ANESTHESIA_v1.5.1.md` - éº»é†‰æ¨¡çµ„è¦æ ¼
- `CIRS/docs/xIRS_REGISTRATION_SPEC_v1.2.md` - æ›è™Ÿè¦æ ¼
- `docs/xIRS_HUB_SATELLITE_INTEGRATION_v0.1.md` - Hub-Satellite æ¶æ§‹

---

**De Novo Orthopedics Inc. / è°·ç›ºç”Ÿç‰©ç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸**
*Version: 1.0 Draft*
*Last Updated: 2026-01-01*
