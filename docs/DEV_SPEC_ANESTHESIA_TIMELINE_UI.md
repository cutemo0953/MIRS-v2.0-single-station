# éº»é†‰ PWA æ™‚é–“è»¸ UI è¦æ ¼æ›¸

**ç‰ˆæœ¬**: v1.1
**æ—¥æœŸ**: 2026-01-19
**ç‹€æ…‹**: Draft
**æ›´æ–°**: æ–°å¢ç”Ÿå‘½å¾µè±¡è¶¨å‹¢åœ–ã€åº«å­˜é€£å‹•ã€åˆ†é æ©Ÿåˆ¶

---

## 1. æ¦‚è¿°

### 1.1 ç¾æ³å•é¡Œ

ç›®å‰éº»é†‰ PWA çš„é‡Œç¨‹ç¢‘è¼¸å…¥éœ€è¦æ‰‹å‹•éµå…¥æ•¸å­—ï¼ˆåˆ†é˜ï¼‰ï¼Œèˆ‡å…¶ä»– PWA çš„æŒ‰éˆ•å¼æ“ä½œä¸ä¸€è‡´ï¼Œä½¿ç”¨è€…é«”é©—ä¸ä½³ã€‚

### 1.2 è¨­è¨ˆç›®æ¨™

- ä»¥ã€Œæ™‚é–“è»¸ã€ä½œç‚ºä¸»è¦ UI æ¶æ§‹
- é»æ“Šæ™‚é–“é»å¯é–‹å•Ÿæ¨¡æ…‹çª—è¼¸å…¥è©³ç´°è³‡è¨Š
- æ”¯æ´å®šæ™‚ Vital Signs è¨˜éŒ„
- ç¬¦åˆæ¨™æº–éº»é†‰è¨˜éŒ„å–®æ ¼å¼

---

## 2. UI æ¶æ§‹

### 2.1 æ™‚é–“è»¸ä¸»è¦–åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éº»é†‰è¨˜éŒ„ - ç‹å¤§æ˜ (M/45) - è‚¡éª¨é ¸éª¨æŠ˜ ORIF             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€ æ™‚é–“è»¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  09:00 â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€ NOW  â”‚   â”‚
â”‚  â”‚        â”‚      â”‚      â”‚      â”‚      â”‚      â”‚       â”‚   â”‚
â”‚  â”‚     å…¥OR   èª˜å°  åˆ‡çš®  ä¸»è¡“  ç¸«åˆ  é†’ä¾†         â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  [+5min] [+10min] [+15min] [+30min] [è‡ªè¨‚]        â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€ Vitals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HR â”‚ 72  78  82  85  80  76  74                  â”‚   â”‚
â”‚  â”‚  BP â”‚120/80  125/85  130/90  128/88  ...          â”‚   â”‚
â”‚  â”‚  SpO2â”‚ 99  99  98  99  99  99  98                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚  â”‚     09:00  09:15  09:30  09:45  10:00  10:15       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€ äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  09:05 Propofol 150mg IV                          â”‚   â”‚
â”‚  â”‚  09:06 Fentanyl 100mcg IV                         â”‚   â”‚
â”‚  â”‚  09:08 Rocuronium 50mg IV                         â”‚   â”‚
â”‚  â”‚  09:10 Intubation ETT 7.5                         â”‚   â”‚
â”‚  â”‚  09:12 Sevoflurane 2% start                       â”‚   â”‚
â”‚  â”‚  ...                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  [è¨˜éŒ„ Vitals]  [è¨˜éŒ„ç”¨è—¥]  [è¨˜éŒ„äº‹ä»¶]  [é‡Œç¨‹ç¢‘]        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ™‚é–“è»¸å…ƒä»¶çµæ§‹

```html
<!-- æ™‚é–“è»¸å®¹å™¨ -->
<div class="timeline-container">
    <!-- åˆ»åº¦è»¸ -->
    <div class="timeline-ruler">
        <!-- æ¯ 5 åˆ†é˜ä¸€å€‹åˆ»åº¦ -->
        <div class="tick" data-time="09:00">09:00</div>
        <div class="tick minor" data-time="09:05"></div>
        <div class="tick" data-time="09:10">09:10</div>
        ...
    </div>

    <!-- é‡Œç¨‹ç¢‘è»Œé“ -->
    <div class="timeline-track milestones">
        <div class="milestone" data-type="OR_IN" style="left: 0%">
            <span class="dot"></span>
            <span class="label">å…¥OR</span>
        </div>
        <div class="milestone" data-type="INDUCTION" style="left: 10%">
            <span class="dot"></span>
            <span class="label">èª˜å°</span>
        </div>
        ...
    </div>

    <!-- Vitals è»Œé“ -->
    <div class="timeline-track vitals">
        <svg class="vitals-chart">
            <!-- HR æŠ˜ç·š -->
            <polyline class="hr-line" points="..."/>
            <!-- BP ç¯„åœ -->
            <path class="bp-area" d="..."/>
        </svg>
    </div>

    <!-- äº‹ä»¶è»Œé“ -->
    <div class="timeline-track events">
        <div class="event" data-type="MEDICATION" style="left: 5%">
            <span class="icon">ğŸ’Š</span>
        </div>
        ...
    </div>

    <!-- ç•¶å‰æ™‚é–“æŒ‡ç¤ºå™¨ -->
    <div class="now-indicator"></div>
</div>
```

---

## 3. äº’å‹•è¨­è¨ˆ

### 3.1 é»æ“Šæ™‚é–“è»¸

**é»æ“Šç©ºç™½è™•** â†’ é–‹å•Ÿã€Œæ–°å¢äº‹ä»¶ã€æ¨¡æ…‹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å¢äº‹ä»¶ @ 09:23              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                â”‚
â”‚  æ™‚é–“: [09:23] [èª¿æ•´]          â”‚
â”‚                                â”‚
â”‚  é¡å‹:                         â”‚
â”‚  â—‹ é‡Œç¨‹ç¢‘  â—‹ ç”¨è—¥  â—‹ Vitals   â”‚
â”‚  â—‹ è™•ç½®    â—‹ å‚™è¨»              â”‚
â”‚                                â”‚
â”‚  [å–æ¶ˆ]           [ç¢ºèª]       â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é»æ“Šå·²å­˜åœ¨çš„äº‹ä»¶

**é»æ“Šé‡Œç¨‹ç¢‘/äº‹ä»¶** â†’ é–‹å•Ÿã€Œç·¨è¼¯äº‹ä»¶ã€æ¨¡æ…‹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç·¨è¼¯: èª˜å° (INDUCTION)        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                â”‚
â”‚  æ™‚é–“: [09:08] [èª¿æ•´]          â”‚
â”‚                                â”‚
â”‚  å‚™è¨»:                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ RSI, smooth induction  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚
â”‚  [åˆªé™¤]  [å–æ¶ˆ]  [å„²å­˜]        â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å¿«é€Ÿæ–°å¢æŒ‰éˆ•

ç•«é¢åº•éƒ¨çš„å¿«é€Ÿæ“ä½œæŒ‰éˆ•ï¼š

| æŒ‰éˆ• | å‹•ä½œ |
|------|------|
| è¨˜éŒ„ Vitals | é–‹å•Ÿ Vitals è¼¸å…¥æ¨¡æ…‹çª— |
| è¨˜éŒ„ç”¨è—¥ | é–‹å•Ÿç”¨è—¥è¼¸å…¥æ¨¡æ…‹çª—ï¼ˆå«å¸¸ç”¨è—¥ç‰©å¿«é¸ï¼‰|
| è¨˜éŒ„äº‹ä»¶ | é–‹å•Ÿäº‹ä»¶è¼¸å…¥æ¨¡æ…‹çª— |
| é‡Œç¨‹ç¢‘ | é–‹å•Ÿé‡Œç¨‹ç¢‘å¿«é¸é¢æ¿ |

### 3.4 é‡Œç¨‹ç¢‘å¿«é¸é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¸æ“‡é‡Œç¨‹ç¢‘                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ å…¥OR â”‚  â”‚ èª˜å° â”‚  â”‚ åˆ‡çš® â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ä¸»è¡“ â”‚  â”‚ ç¸«åˆ â”‚  â”‚ é†’ä¾† â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ æ‹”ç®¡ â”‚  â”‚ å‡ºOR â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                      â”‚
â”‚  æ™‚é–“: [ç¾åœ¨] / [è‡ªè¨‚: ____]        â”‚
â”‚                                      â”‚
â”‚  [å–æ¶ˆ]                    [ç¢ºèª]    â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Vitals è¨˜éŒ„

### 4.1 Vitals è¼¸å…¥æ¨¡æ…‹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨˜éŒ„ Vitals @ 09:30               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                    â”‚
â”‚  HR:   [  78  ] bpm               â”‚
â”‚  BP:   [ 125 ]/[  82 ] mmHg       â”‚
â”‚  SpO2: [  99  ] %                 â”‚
â”‚  EtCO2:[  35  ] mmHg              â”‚
â”‚  Temp: [ 36.5 ] Â°C                â”‚
â”‚                                    â”‚
â”‚  â”Œâ”€ å¿«é€Ÿè¼¸å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [+10] [-10] HR              â”‚    â”‚
â”‚  â”‚ [+10] [-10] SBP             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚
â”‚  [å–æ¶ˆ]              [å„²å­˜]        â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è‡ªå‹•è¨˜éŒ„æé†’

å¯è¨­å®šæ¯ 5/10/15 åˆ†é˜æé†’è¨˜éŒ„ Vitalsï¼š

```javascript
// è¨­å®šè‡ªå‹•æé†’
vitalsReminderInterval: 15,  // åˆ†é˜
lastVitalsTime: null,

checkVitalsReminder() {
    if (this.lastVitalsTime) {
        const elapsed = (Date.now() - this.lastVitalsTime) / 60000;
        if (elapsed >= this.vitalsReminderInterval) {
            this.showVitalsReminder();
        }
    }
}
```

---

## 5. è³‡æ–™çµæ§‹

### 5.1 Event Sourcing æ•´åˆ

æ‰€æœ‰æ™‚é–“è»¸äº‹ä»¶éƒ½æ˜¯ `anesthesia_events` è¡¨çš„ä¸€éƒ¨åˆ†ï¼š

```sql
-- ç¾æœ‰ anesthesia_events è¡¨çµæ§‹
CREATE TABLE anesthesia_events (
    event_id INTEGER PRIMARY KEY AUTOINCREMENT,
    case_id TEXT NOT NULL,
    event_type TEXT NOT NULL,  -- è¦‹ä¸‹æ–¹é¡å‹
    event_time INTEGER NOT NULL,
    data TEXT,  -- JSON
    recorded_by TEXT,
    recorded_at INTEGER DEFAULT (strftime('%s', 'now'))
);
```

### 5.2 äº‹ä»¶é¡å‹

| event_type | èªªæ˜ | data å…§å®¹ |
|------------|------|-----------|
| `MILESTONE` | é‡Œç¨‹ç¢‘ | `{"type": "INDUCTION", "notes": "..."}` |
| `VITALS` | ç”Ÿå‘½å¾µè±¡ | `{"hr": 78, "sbp": 120, "dbp": 80, "spo2": 99, ...}` |
| `MEDICATION` | ç”¨è—¥ | `{"drug": "Propofol", "dose": 150, "unit": "mg", "route": "IV"}` |
| `PROCEDURE` | è™•ç½® | `{"type": "INTUBATION", "details": "ETT 7.5"}` |
| `NOTE` | å‚™è¨» | `{"text": "Patient movement"}` |
| `RESOURCE_CLAIM` | PSI ä½”ç”¨ | `{"psi_id": "...", "action": "claim"}` |

### 5.3 å‰ç«¯è³‡æ–™æ¨¡å‹

```javascript
timelineData: {
    case_id: 'ANES-20260107-001',
    start_time: '2026-01-07T09:00:00',

    milestones: [
        { type: 'OR_IN', time: '09:00', notes: '' },
        { type: 'INDUCTION', time: '09:08', notes: 'RSI' },
        // ...
    ],

    vitals: [
        { time: '09:00', hr: 72, sbp: 120, dbp: 80, spo2: 99 },
        { time: '09:15', hr: 78, sbp: 125, dbp: 85, spo2: 99 },
        // ...
    ],

    medications: [
        { time: '09:05', drug: 'Propofol', dose: 150, unit: 'mg', route: 'IV' },
        // ...
    ],

    events: [
        { time: '09:10', type: 'PROCEDURE', data: { type: 'INTUBATION', details: 'ETT 7.5' }},
        // ...
    ]
}
```

---

## 6. æ™‚é–“è»¸æ¸²æŸ“

### 6.1 åº§æ¨™è¨ˆç®—

```javascript
// å°‡æ™‚é–“è½‰æ›ç‚ºæ™‚é–“è»¸ä½ç½® (ç™¾åˆ†æ¯”)
timeToPosition(time) {
    const start = this.caseStartTime;
    const end = Date.now();
    const duration = end - start;
    const elapsed = time - start;
    return Math.min(100, Math.max(0, (elapsed / duration) * 100));
}

// å°‡ä½ç½®è½‰æ›ç‚ºæ™‚é–“
positionToTime(percent) {
    const start = this.caseStartTime;
    const end = Date.now();
    const duration = end - start;
    return new Date(start + (percent / 100) * duration);
}
```

### 6.2 ç¸®æ”¾èˆ‡æ»¾å‹•

```javascript
timelineZoom: 1,  // 1 = å…¨ç¨‹, 2 = æ”¾å¤§ 2x
timelineOffset: 0,  // æ»¾å‹•åç§»

zoomIn() {
    this.timelineZoom = Math.min(4, this.timelineZoom * 1.5);
},

zoomOut() {
    this.timelineZoom = Math.max(0.5, this.timelineZoom / 1.5);
}
```

### 6.3 æ‰‹å‹¢æ”¯æ´

- **é›™æŒ‡ç¸®æ”¾**: æ”¾å¤§/ç¸®å°æ™‚é–“è»¸
- **å–®æŒ‡æ»‘å‹•**: æ°´å¹³æ»¾å‹•
- **é•·æŒ‰**: é–‹å•Ÿå¿«é€Ÿæ–°å¢é¸å–®

---

## 7. Vitals åœ–è¡¨ (v1.1 é‡å¤§æ›´æ–°)

### 7.1 æ¨™æº–éº»é†‰è¨˜éŒ„å–®æ ¼å¼

éº»é†‰è¨˜éŒ„å–®çš„æ ¸å¿ƒæ˜¯**ç”Ÿå‘½å¾µè±¡è¶¨å‹¢åœ– (Vital Signs Trend)**ï¼Œæ¡ç”¨åœ‹éš›æ¨™æº–ç¬¦è™Ÿï¼š

```
ç¬¦è™Ÿæ¨™æº– (Anesthesia Chart Symbols)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  V  = æ”¶ç¸®å£“ (SBP) - ç´…è‰²
  ^  = èˆ’å¼µå£“ (DBP) - ç´…è‰²
  â—  = å¿ƒè·³ (HR) - è—è‰²
  â—‹  = è¡€æ°§ (SpO2) - ç¶ è‰²
  Ã—  = å‘¼å¸æ¬¡æ•¸ (RR) - ç´«è‰²
```

### 7.2 è¶¨å‹¢åœ–è¦–è¦ºè¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  mmHg/bpm                                                     â”‚
â”‚  200 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚  180 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚  160 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚  140 â”€â”¼â”€â”€â”€â”€â”€â”€â”€Vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚      /â”‚\                  â”‚                           â”‚
â”‚  120 â”€â”¼â”€â”€â”€â”€â”€Vâ”€â”¼â”€Vâ”€â”€â”€Vâ”€â”€â”€Vâ”€â”€â”€Vâ”€â”€â”€â”€Vâ”€â”€Vâ”€â”€â”€Vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† SBP (V)
â”‚       â”‚       â”‚   \   \   /   \       \                       â”‚
â”‚  100 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† HR (â—)
â”‚       â”‚       â”‚                                               â”‚
â”‚   80 â”€â”¼â”€â”€â”€â”€â”€â”€â”€^â”€â”€â”€^â”€â”€â”€^â”€â”€â”€^â”€â”€â”€â”€^â”€â”€^â”€â”€â”€â”€^â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† DBP (^)
â”‚       â”‚                                                       â”‚
â”‚   60 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚   40 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚   20 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚    0 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚        09:00  09:05  09:10  09:15  09:20  09:25  09:30        â”‚
â”‚                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  äº‹ä»¶åˆ—ï¼š                                                     â”‚
â”‚   09:05 ğŸ’Š Propofol 150mg                                    â”‚
â”‚   09:08 ğŸ”§ Intubation ETT 7.5                                â”‚
â”‚   09:12 ğŸ’¨ Sevoflurane 2%                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 SVG Canvas å¯¦ä½œ

```html
<div class="vitals-canvas-container">
    <!-- Yè»¸æ¨™ç±¤ -->
    <div class="y-axis">
        <span>200</span>
        <span>160</span>
        <span>120</span>
        <span>80</span>
        <span>40</span>
        <span>0</span>
    </div>

    <!-- ä¸»ç¹ªåœ–å€ -->
    <svg class="vitals-canvas" viewBox="0 0 720 300" preserveAspectRatio="none">
        <!-- ç¶²æ ¼ç·š -->
        <defs>
            <pattern id="grid" width="60" height="30" patternUnits="userSpaceOnUse">
                <path d="M 60 0 L 0 0 0 30" fill="none" stroke="#e5e7eb" stroke-width="0.5"/>
            </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)"/>

        <!-- SBP æŠ˜ç·š (V ç¬¦è™Ÿ) -->
        <g class="sbp-layer">
            <polyline class="sbp-line" points="..." fill="none" stroke="#dc2626" stroke-width="1.5"/>
            <!-- V ç¬¦è™Ÿæ¨™è¨˜ -->
            <text x="60" y="90" class="vital-symbol sbp">V</text>
            <text x="120" y="85" class="vital-symbol sbp">V</text>
            ...
        </g>

        <!-- DBP æŠ˜ç·š (^ ç¬¦è™Ÿ) -->
        <g class="dbp-layer">
            <polyline class="dbp-line" points="..." fill="none" stroke="#dc2626" stroke-width="1"/>
            <text x="60" y="165" class="vital-symbol dbp">^</text>
            ...
        </g>

        <!-- HR æŠ˜ç·š (â— ç¬¦è™Ÿ) -->
        <g class="hr-layer">
            <polyline class="hr-line" points="..." fill="none" stroke="#2563eb" stroke-width="1.5"/>
            <circle cx="60" cy="150" r="4" fill="#2563eb"/>
            <circle cx="120" cy="145" r="4" fill="#2563eb"/>
            ...
        </g>

        <!-- SpO2 (â—‹ ç¬¦è™Ÿ) - é ‚éƒ¨å€åŸŸ -->
        <g class="spo2-layer">
            <polyline class="spo2-line" points="..." fill="none" stroke="#16a34a" stroke-width="1"/>
            <circle cx="60" cy="15" r="3" fill="none" stroke="#16a34a"/>
            ...
        </g>

        <!-- äº‹ä»¶æ¨™è¨˜ (å‚ç›´ç·š + åœ–æ¨™) -->
        <g class="events-layer">
            <line x1="60" y1="0" x2="60" y2="300" stroke="#f59e0b" stroke-width="1" stroke-dasharray="4"/>
            <text x="60" y="295" class="event-label">ğŸ’Š</text>
        </g>
    </svg>

    <!-- Xè»¸æ™‚é–“æ¨™ç±¤ -->
    <div class="x-axis">
        <span>09:00</span>
        <span>09:05</span>
        <span>09:10</span>
        ...
    </div>
</div>
```

### 7.4 åº§æ¨™è½‰æ›å‡½æ•¸

```javascript
// Yè»¸ï¼š0-220 mmHg/bpm -> SVG 0-300px (å€’ç½®)
valueToY(value, maxValue = 220) {
    return 300 - (value / maxValue) * 300;
}

// Xè»¸ï¼šæ™‚é–“ -> SVG åƒç´  (æ¯åˆ†é˜ 12px)
timeToX(time) {
    const elapsed = (time - this.hourStartTime) / 60000; // åˆ†é˜æ•¸
    return elapsed * 12; // æ¯åˆ†é˜ 12px = 1å°æ™‚ 720px
}

// ç¹ªè£½ Vitals é»
plotVital(time, type, value) {
    const x = this.timeToX(time);
    const y = this.valueToY(value);
    const symbol = this.getSymbol(type);

    // æ ¹æ“šé¡å‹ç¹ªè£½ä¸åŒç¬¦è™Ÿ
    switch(type) {
        case 'SBP':
            this.drawText(x, y, 'V', '#dc2626');
            break;
        case 'DBP':
            this.drawText(x, y, '^', '#dc2626');
            break;
        case 'HR':
            this.drawCircle(x, y, 4, '#2563eb', true);
            break;
        case 'SpO2':
            this.drawCircle(x, y, 3, '#16a34a', false);
            break;
        case 'RR':
            this.drawText(x, y, 'Ã—', '#7c3aed');
            break;
    }
}
```

### 7.5 ç•°å¸¸å€¼è­¦ç¤º

```javascript
// ç•°å¸¸å€¼å®šç¾©
VITAL_LIMITS: {
    HR:   { low: 50,  high: 120, critical_low: 40,  critical_high: 150 },
    SBP:  { low: 90,  high: 160, critical_low: 70,  critical_high: 200 },
    DBP:  { low: 50,  high: 100, critical_low: 40,  critical_high: 120 },
    SpO2: { low: 94,  high: 100, critical_low: 90,  critical_high: 100 },
    RR:   { low: 10,  high: 24,  critical_low: 8,   critical_high: 30 }
},

// æª¢æŸ¥ç•°å¸¸ä¸¦æ¨™è‰²
getVitalColor(type, value) {
    const limits = this.VITAL_LIMITS[type];
    if (value <= limits.critical_low || value >= limits.critical_high) {
        return '#dc2626';  // ç´…è‰² - å±æ€¥
    }
    if (value <= limits.low || value >= limits.high) {
        return '#f59e0b';  // é»ƒè‰² - è­¦å‘Š
    }
    return this.DEFAULT_COLORS[type];  // æ­£å¸¸é¡è‰²
}
```

---

## 8. æ¨™æº–é‡Œç¨‹ç¢‘

### 8.1 å…¨èº«éº»é†‰ (GA)

| é †åº | ä»£ç¢¼ | ä¸­æ–‡ | è‹±æ–‡ |
|:----:|------|------|------|
| 1 | OR_IN | å…¥OR | OR In |
| 2 | INDUCTION | èª˜å° | Induction |
| 3 | INTUBATION | æ’ç®¡ | Intubation |
| 4 | INCISION | åˆ‡çš® | Incision |
| 5 | MAIN_PROCEDURE | ä¸»è¡“ | Main Procedure |
| 6 | CLOSURE | ç¸«åˆ | Closure |
| 7 | EMERGENCE | é†’ä¾† | Emergence |
| 8 | EXTUBATION | æ‹”ç®¡ | Extubation |
| 9 | OR_OUT | å‡ºOR | OR Out |

### 8.2 å€åŸŸéº»é†‰ (RA)

| é †åº | ä»£ç¢¼ | ä¸­æ–‡ |
|:----:|------|------|
| 1 | OR_IN | å…¥OR |
| 2 | BLOCK_START | é–‹å§‹é˜»æ–· |
| 3 | BLOCK_COMPLETE | é˜»æ–·å®Œæˆ |
| 4 | INCISION | åˆ‡çš® |
| 5 | MAIN_PROCEDURE | ä¸»è¡“ |
| 6 | CLOSURE | ç¸«åˆ |
| 7 | OR_OUT | å‡ºOR |

---

## 9. åº«å­˜èˆ‡è¨ˆè²»é€£å‹• (v1.1 æ–°å¢)

### 9.1 è¨­è¨ˆç†å¿µ

> **ã€Œéº»é†‰é†«å¸«åªç®¡æ•‘äººï¼Œç³»çµ±è‡ªå‹•ç®—éŒ¢èˆ‡åº«å­˜ã€**

ç•¶éº»é†‰å¸«åœ¨æ™‚é–“è»¸ä¸Šè¨˜éŒ„ç”¨è—¥äº‹ä»¶ï¼Œç³»çµ±è‡ªå‹•å®Œæˆï¼š
1. MIRS åº«å­˜æ‰£æ¸›
2. CashDesk è¨ˆè²»é …ç›®ç”Ÿæˆ
3. ç®¡åˆ¶è—¥å“é›™é‡é©—è­‰

### 9.2 äº‹ä»¶-åº«å­˜ç¶å®šæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨è—¥äº‹ä»¶è³‡æ–™æµ                                â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚ Anes PWA â”‚â”€â”€â”€â”€â–¶â”‚ MIRS API â”‚â”€â”€â”€â”€â–¶â”‚ CashDesk â”‚              â”‚
â”‚   â”‚ è¨˜éŒ„ç”¨è—¥  â”‚     â”‚ æ‰£æ¸›åº«å­˜  â”‚     â”‚ ç”Ÿæˆå¸³å–®  â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚        â”‚                â”‚                â”‚                     â”‚
â”‚        â–¼                â–¼                â–¼                     â”‚
â”‚   anesthesia_     pharmacy_         billing_                  â”‚
â”‚   events          inventory         line_items                 â”‚
â”‚                                                                 â”‚
â”‚   event_type:     quantity: -1      item_code: "PROP-200"     â”‚
â”‚   MEDICATION      lot_number        unit_price: 150           â”‚
â”‚                   expiry_date       quantity: 1               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 API è¨­è¨ˆ

#### 9.3.1 æ–°å¢ç”¨è—¥äº‹ä»¶ (å«åº«å­˜æ‰£æ¸›)

```javascript
// POST /api/anesthesia/events/medication
async recordMedication(caseId, medication) {
    const payload = {
        case_id: caseId,
        event_time: medication.time,
        drug_code: medication.drugCode,      // å°æ‡‰ pharmacy_items.item_code
        drug_name: medication.drugName,
        dose: medication.dose,
        unit: medication.unit,
        route: medication.route,             // IV, IM, PO, INH...
        lot_number: medication.lotNumber,    // æ‰¹è™Ÿ (å¯é¸)
        deduct_inventory: true,              // è§¸ç™¼åº«å­˜æ‰£æ¸›
        create_billable: true                // è§¸ç™¼è¨ˆè²»é …ç›®
    };

    const response = await xIRS.API.post('/api/anesthesia/events/medication', payload);

    // å›æ‡‰åŒ…å«åº«å­˜ç‹€æ…‹
    // {
    //     event_id: "EVT-001",
    //     inventory_deducted: true,
    //     remaining_stock: 5,
    //     billable_item_id: "BL-001"
    // }
}
```

#### 9.3.2 åˆªé™¤/æ’¤éŠ·ç”¨è—¥äº‹ä»¶ (åº«å­˜å›è£œ)

```javascript
// DELETE /api/anesthesia/events/{event_id}
async deleteEvent(eventId, reason) {
    const payload = {
        reason: reason,                      // åˆªé™¤åŸå›  (å¿…å¡«)
        revert_inventory: true,              // åº«å­˜åŠ å›
        void_billable: true                  // ä½œå»¢è¨ˆè²»é …ç›®
    };

    // å¯©è¨ˆç´€éŒ„ï¼šèª°ã€ä½•æ™‚ã€ç‚ºä½•åˆªé™¤
}
```

### 9.4 ç®¡åˆ¶è—¥å“è™•ç†

ç®¡åˆ¶è—¥å“ (Controlled Drugs) éœ€è¦é¡å¤–é©—è­‰ï¼š

```javascript
// ç®¡åˆ¶è—¥å“é¡åˆ¥
CONTROLLED_DRUG_CLASSES: {
    'CLASS_1': ['Morphine', 'Fentanyl', 'Pethidine'],
    'CLASS_2': ['Ketamine', 'Midazolam'],
    'CLASS_3': ['Diazepam', 'Lorazepam']
},

// UIï¼šç®¡åˆ¶è—¥å“ç´…æ¡†æ¨™ç¤º
isControlledDrug(drugCode) {
    const drugInfo = this.drugDatabase.find(d => d.code === drugCode);
    return drugInfo?.controlled_class != null;
}

// UIï¼šæ–°å¢ç®¡åˆ¶è—¥å“éœ€è¦ç¢ºèª
async addControlledDrugEvent(medication) {
    const confirmed = await this.showConfirmDialog({
        title: 'âš ï¸ ç®¡åˆ¶è—¥å“ç¢ºèª',
        message: `å³å°‡è¨˜éŒ„ ${medication.drugName} ${medication.dose}${medication.unit}`,
        confirmText: 'ç¢ºèªç„¡èª¤',
        cancelText: 'å–æ¶ˆ',
        requireDoubleCheck: true  // éœ€è¦å‹¾é¸ç¢ºèªæ¡†
    });

    if (confirmed) {
        await this.recordMedication(this.caseId, medication);
    }
}
```

### 9.5 ç”¨è—¥é¸å–®è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨˜éŒ„ç”¨è—¥ @ 09:15                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€ å¸¸ç”¨è—¥ç‰© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Propofol]  [Fentanyl]         â”‚   â”‚
â”‚  â”‚  [Rocuronium] [Sevoflurane]     â”‚   â”‚
â”‚  â”‚  [Midazolam]  [Ketamine] âš ï¸     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚
â”‚  è—¥ç‰©: [Propofol           â–¼]          â”‚
â”‚  åŠ‘é‡: [200    ] [mg  â–¼]               â”‚
â”‚  é€”å¾‘: [IV     â–¼]                      â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€ åº«å­˜è³‡è¨Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ç¾æœ‰åº«å­˜: 8 æ”¯                â”‚     â”‚
â”‚  â”‚  æ‰¹è™Ÿ: LOT-2026-001           â”‚     â”‚
â”‚  â”‚  æ•ˆæœŸ: 2026-06-30             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                        â”‚
â”‚  [å–æ¶ˆ]              [è¨˜éŒ„ç”¨è—¥]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.6 è¨ˆè²»é …ç›®å°ç…§è¡¨

| éº»é†‰è—¥ç‰© | drug_code | å°æ‡‰ pricebook item_code | å¥ä¿é»æ•¸ |
|---------|-----------|-------------------------|---------|
| Propofol 200mg | PROP-200 | MED-PROP-200 | 150 |
| Fentanyl 100mcg | FENT-100 | MED-FENT-100 | 85 |
| Rocuronium 50mg | ROCU-50 | MED-ROCU-50 | 280 |
| Sevoflurane (per hr) | SEVO-HR | MED-SEVO-HR | 450 |
| Ketamine 100mg | KET-100 | MED-KET-100 | 120 |

---

## 10. åˆ†é èˆ‡æ²å‹•æ©Ÿåˆ¶ (v1.1 æ–°å¢)

### 10.1 è¨­è¨ˆåŸå‰‡

æ¨™æº–éº»é†‰ç´€éŒ„å–®ä¸€å¼µç´™ç´„ 1-2 å°æ™‚ã€‚é‡å°é•·æ™‚é–“æ‰‹è¡“ (8-12 å°æ™‚)ï¼Œæ¡ç”¨**åˆ†é æ©Ÿåˆ¶**è€Œéç„¡é™æ²å‹•ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  â—€ ç¬¬ 2 å°æ™‚ (09:00 - 10:00)                    â–¶      â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”‚                                                         â”‚
â”‚  [01] [02] [03] [04] [05] [06] [07] [08] ... [ç¾åœ¨]    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚           (Vitals è¶¨å‹¢åœ–)                     â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 åˆ†é ç‹€æ…‹ç®¡ç†

```javascript
pagination: {
    hourDuration: 60,              // æ¯é é¡¯ç¤º 60 åˆ†é˜
    currentHour: 0,                // ç•¶å‰é¡¯ç¤ºçš„å°æ™‚ç´¢å¼• (0 = ç¬¬ä¸€å°æ™‚)
    totalHours: 1,                 // ç¸½æ‰‹è¡“æ™‚æ•¸
    caseStartTime: null,           // æ‰‹è¡“é–‹å§‹æ™‚é–“
},

// è¨ˆç®—ç¸½é æ•¸
get totalPages() {
    const elapsed = Date.now() - this.pagination.caseStartTime;
    return Math.ceil(elapsed / (60 * 60 * 1000));
},

// åˆ‡æ›åˆ°æŒ‡å®šå°æ™‚
goToHour(hourIndex) {
    this.pagination.currentHour = Math.max(0, Math.min(hourIndex, this.totalPages - 1));
    this.renderCurrentHour();
},

// å‰ä¸€å°æ™‚
prevHour() {
    if (this.pagination.currentHour > 0) {
        this.goToHour(this.pagination.currentHour - 1);
    }
},

// ä¸‹ä¸€å°æ™‚
nextHour() {
    if (this.pagination.currentHour < this.totalPages - 1) {
        this.goToHour(this.pagination.currentHour + 1);
    }
},

// è·³åˆ°ã€Œç¾åœ¨ã€
goToNow() {
    this.goToHour(this.totalPages - 1);
}
```

### 10.3 å°æ™‚é¸æ“‡å™¨ UI

```html
<!-- å°æ™‚é¸æ“‡å™¨ -->
<div class="hour-selector flex items-center gap-2 p-2 bg-gray-100">
    <button @click="prevHour()" :disabled="pagination.currentHour === 0"
            class="p-2 rounded-lg hover:bg-gray-200 disabled:opacity-50">
        â—€
    </button>

    <div class="flex-1 flex items-center justify-center gap-1 overflow-x-auto">
        <template x-for="hour in totalPages" :key="hour">
            <button @click="goToHour(hour - 1)"
                    :class="pagination.currentHour === hour - 1 ? 'bg-blue-600 text-white' : 'bg-white'"
                    class="w-8 h-8 rounded-full text-sm font-medium">
                <span x-text="hour"></span>
            </button>
        </template>
    </div>

    <button @click="nextHour()" :disabled="pagination.currentHour >= totalPages - 1"
            class="p-2 rounded-lg hover:bg-gray-200 disabled:opacity-50">
        â–¶
    </button>

    <button @click="goToNow()" class="px-3 py-1 bg-red-600 text-white rounded-lg text-sm">
        ç¾åœ¨
    </button>
</div>
```

### 10.4 æ‰‹å‹¢æ”¯æ´

```javascript
// Touch æ‰‹å‹¢ï¼šå·¦å³æ»‘å‹•åˆ‡æ›å°æ™‚
initSwipeGesture() {
    let startX = 0;
    const container = this.$refs.timelineContainer;

    container.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
    });

    container.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = endX - startX;

        if (Math.abs(diff) > 50) {  // æ»‘å‹•è¶…é 50px
            if (diff > 0) {
                this.prevHour();  // å³æ»‘ â†’ å‰ä¸€å°æ™‚
            } else {
                this.nextHour();  // å·¦æ»‘ â†’ ä¸‹ä¸€å°æ™‚
            }
        }
    });
}
```

---

## 11. ç·Šæ€¥æ“ä½œ (v1.1 æ–°å¢)

### 11.1 Code Blue / Stat æŒ‰éˆ•

ç·Šæ€¥æƒ…æ³ä¸‹ï¼Œé†«å¸«ç„¡æ³•æ…¢æ…¢å¡«è¡¨å–®ã€‚æä¾›ä¸€éµè¨˜éŒ„åŠŸèƒ½ï¼š

```html
<!-- ç·Šæ€¥æŒ‰éˆ• (å¸¸é§æ–¼ç•«é¢å³ä¸‹è§’) -->
<div class="fixed bottom-20 right-4 z-50">
    <button @click="showStatMenu = true"
            class="w-14 h-14 rounded-full bg-red-600 text-white shadow-lg
                   flex items-center justify-center text-2xl
                   active:scale-95 transition-transform">
        âš¡
    </button>
</div>

<!-- Stat å¿«é¸é¸å–® -->
<div x-show="showStatMenu" x-cloak
     class="fixed inset-0 z-50 bg-black/50 flex items-center justify-center">
    <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4">
        <h3 class="text-lg font-bold text-red-600 mb-4">âš¡ ç·Šæ€¥ç”¨è—¥</h3>

        <div class="grid grid-cols-2 gap-3">
            <button @click="statDrug('Epinephrine', 1, 'mg')"
                    class="p-4 bg-red-100 text-red-800 rounded-xl font-bold">
                Epinephrine 1mg
            </button>
            <button @click="statDrug('Atropine', 0.5, 'mg')"
                    class="p-4 bg-red-100 text-red-800 rounded-xl font-bold">
                Atropine 0.5mg
            </button>
            <button @click="statDrug('Ephedrine', 10, 'mg')"
                    class="p-4 bg-amber-100 text-amber-800 rounded-xl font-bold">
                Ephedrine 10mg
            </button>
            <button @click="statDrug('Phenylephrine', 100, 'mcg')"
                    class="p-4 bg-amber-100 text-amber-800 rounded-xl font-bold">
                Neo 100mcg
            </button>
        </div>

        <button @click="showStatMenu = false"
                class="w-full mt-4 py-3 bg-gray-200 rounded-xl">
            å–æ¶ˆ
        </button>
    </div>
</div>
```

### 11.2 Stat ç”¨è—¥å‡½æ•¸

```javascript
// ä¸€éµè¨˜éŒ„ç·Šæ€¥ç”¨è—¥ (æ™‚é–“ = ç¾åœ¨)
async statDrug(drugName, dose, unit) {
    const now = Date.now();

    // ç›´æ¥è¨˜éŒ„ï¼Œè·³éç¢ºèªå°è©±æ¡†
    await this.recordMedication(this.caseId, {
        time: now,
        drugCode: this.getDrugCode(drugName),
        drugName: drugName,
        dose: dose,
        unit: unit,
        route: 'IV',
        isStat: true  // æ¨™è¨˜ç‚ºç·Šæ€¥ç”¨è—¥
    });

    this.showStatMenu = false;

    // éœ‡å‹•å›é¥‹ (å¦‚æœæ”¯æ´)
    if (navigator.vibrate) {
        navigator.vibrate(100);
    }

    // Toast é€šçŸ¥
    XIRS_TOAST.success(`å·²è¨˜éŒ„ ${drugName} ${dose}${unit}`);
}
```

---

## 12. CSS æ¨£å¼

```css
/* æ™‚é–“è»¸å®¹å™¨ */
.timeline-container {
    position: relative;
    width: 100%;
    height: 200px;
    overflow-x: auto;
    overflow-y: hidden;
}

/* åˆ»åº¦è»¸ */
.timeline-ruler {
    display: flex;
    height: 24px;
    border-bottom: 1px solid #e5e7eb;
}

.timeline-ruler .tick {
    position: absolute;
    font-size: 10px;
    color: #6b7280;
}

.timeline-ruler .tick.minor::before {
    content: '';
    position: absolute;
    bottom: 0;
    width: 1px;
    height: 4px;
    background: #d1d5db;
}

/* é‡Œç¨‹ç¢‘ */
.milestone {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
}

.milestone .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #14b8a6;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.milestone .label {
    font-size: 10px;
    margin-top: 4px;
    white-space: nowrap;
}

/* äº‹ä»¶æ¨™è¨˜ */
.event {
    position: absolute;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    cursor: pointer;
}

/* ç•¶å‰æ™‚é–“æŒ‡ç¤ºå™¨ */
.now-indicator {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #ef4444;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
```

---

## 13. å¯¦ä½œè¨ˆç•« (v1.1 æ›´æ–°)

### Phase 1: åŸºç¤æ™‚é–“è»¸
1. æ™‚é–“è»¸å®¹å™¨ + åˆ»åº¦è»¸
2. é‡Œç¨‹ç¢‘é¡¯ç¤º
3. é»æ“Šé‡Œç¨‹ç¢‘ç·¨è¼¯

### Phase 2: Vitals è¶¨å‹¢åœ– â­ (v1.1)
1. SVG Canvas ç¶²æ ¼ç¹ªè£½
2. æ¨™æº–ç¬¦è™Ÿ (V/^/â—/â—‹/Ã—) ç¹ªè£½
3. ç•°å¸¸å€¼è‡ªå‹•æ¨™è‰²
4. Xè»¸èˆ‡æ™‚é–“è»¸åŒæ­¥æ²å‹•

### Phase 3: äº‹ä»¶è¨˜éŒ„
1. æ–°å¢äº‹ä»¶æ¨¡æ…‹çª—
2. Vitals è¼¸å…¥æ¨¡æ…‹çª—
3. ç”¨è—¥è¼¸å…¥æ¨¡æ…‹çª—ï¼ˆå«å¸¸ç”¨è—¥ç‰©å¿«é¸ï¼‰

### Phase 4: åº«å­˜èˆ‡è¨ˆè²»é€£å‹• â­ (v1.1)
1. MIRS åº«å­˜æ‰£æ¸› API
2. CashDesk è¨ˆè²»é …ç›®ç”Ÿæˆ
3. ç®¡åˆ¶è—¥å“é›™é‡é©—è­‰
4. äº‹ä»¶åˆªé™¤ â†’ åº«å­˜å›è£œ

### Phase 5: åˆ†é èˆ‡ UX â­ (v1.1)
1. æ¯å°æ™‚åˆ†é é¡¯ç¤º
2. å°æ™‚é¸æ“‡å™¨ UI
3. å·¦å³æ»‘å‹•æ‰‹å‹¢
4. Code Blue / Stat ç·Šæ€¥æŒ‰éˆ•

### Phase 6: é€²éšåŠŸèƒ½
1. è‡ªå‹• Vitals æé†’
2. åˆ—å°/åŒ¯å‡º
3. é›¢ç·šæ”¯æ´

---

## 14. æœªæ±ºå•é¡Œ

- [x] ~~Vitals ç•°å¸¸å€¼æ˜¯å¦è‡ªå‹•æ¨™ç´…ï¼Ÿ~~ â†’ v1.1 å·²å®šç¾©
- [ ] æ™‚é–“è»¸æ˜¯å¦éœ€è¦å‚ç›´æ¨¡å¼ï¼ˆæ‰‹æ©Ÿç›´å¼ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦èªéŸ³è¼¸å…¥ï¼Ÿ
- [ ] é›¢ç·šæ™‚çš„æ™‚é–“åŒæ­¥ç­–ç•¥ï¼Ÿ
- [ ] èˆ‡ CIRS ç—…æ­·çš„æ•´åˆæ–¹å¼ï¼Ÿ

---

## 15. ç³»çµ±æ•´åˆé—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         xIRS ç³»çµ±æ•´åˆ                            â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚   â”‚ Anes PWA  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ æ™‚é–“è»¸ UI  â”‚                                           â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚    â”‚
â”‚         â”‚                                                  â”‚    â”‚
â”‚         â”‚ ç”¨è—¥äº‹ä»¶                                         â”‚    â”‚
â”‚         â–¼                                                  â–¼    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   MIRS    â”‚â”€â”€â”€â”€â–¶â”‚ Pharmacy  â”‚â”€â”€â”€â”€â–¶â”‚ CashDesk  â”‚           â”‚
â”‚   â”‚  Backend  â”‚     â”‚ Inventory â”‚     â”‚  Billing  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                    â”‚                 â”‚
â”‚         â”‚                                    â”‚                 â”‚
â”‚         â–¼                                    â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   CIRS    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Handoff  â”‚           â”‚
â”‚   â”‚  ç—…æ­·ç³»çµ±  â”‚   Handoff Package     â”‚  Package  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Changelog

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´ |
|------|------|------|
| v1.0 | 2026-01-07 | åˆç‰ˆ |
| v1.1 | 2026-01-19 | æ–°å¢ï¼š(1) æ¨™æº–éº»é†‰è¨˜éŒ„å–®è¶¨å‹¢åœ– (V/^/â—/â—‹ ç¬¦è™Ÿ) (2) åº«å­˜èˆ‡è¨ˆè²»é€£å‹• API (3) åˆ†é æ©Ÿåˆ¶ (æ¯å°æ™‚ä¸€é ) (4) Code Blue ç·Šæ€¥æŒ‰éˆ• (5) ç®¡åˆ¶è—¥å“è™•ç†æµç¨‹ |
