# éº»é†‰ PWA æ™‚é–“è»¸ UI è¦æ ¼æ›¸

**ç‰ˆæœ¬**: v1.2
**æ—¥æœŸ**: 2026-01-19
**ç‹€æ…‹**: Draft
**æ›´æ–°**: v1.2 ä¿®æ­£æ™‚é–“æ¨¡å‹ã€Event Sourcingã€æ¸²æŸ“æ•ˆèƒ½ã€UI ä¸€è‡´æ€§

---

## 1. æ¦‚è¿°

### 1.1 ç¾æ³å•é¡Œ

ç›®å‰éº»é†‰ PWA çš„é‡Œç¨‹ç¢‘è¼¸å…¥éœ€è¦æ‰‹å‹•éµå…¥æ•¸å­—ï¼ˆåˆ†é˜ï¼‰ï¼Œèˆ‡å…¶ä»– PWA çš„æŒ‰éˆ•å¼æ“ä½œä¸ä¸€è‡´ï¼Œä½¿ç”¨è€…é«”é©—ä¸ä½³ã€‚

### 1.2 è¨­è¨ˆç›®æ¨™

- ä»¥ã€Œæ™‚é–“è»¸ã€ä½œç‚ºä¸»è¦ UI æ¶æ§‹
- é»æ“Šæ™‚é–“é»å¯é–‹å•Ÿæ¨¡æ…‹çª—è¼¸å…¥è©³ç´°è³‡è¨Š
- æ”¯æ´å®šæ™‚ Vital Signs è¨˜éŒ„
- ç¬¦åˆæ¨™æº–éº»é†‰è¨˜éŒ„å–®æ ¼å¼

---

## 2. UI æ¶æ§‹

### 2.1 æ™‚é–“è»¸ä¸»è¦–åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éº»é†‰è¨˜éŒ„ - ç‹å¤§æ˜ (M/45) - è‚¡éª¨é ¸éª¨æŠ˜ ORIF             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•     â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€ æ™‚é–“è»¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  09:00 â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â—â”€ NOW  â”‚   â”‚
â”‚  â”‚        â”‚      â”‚      â”‚      â”‚      â”‚      â”‚       â”‚   â”‚
â”‚  â”‚     å…¥OR   èª˜å°  åˆ‡çš®  ä¸»è¡“  ç¸«åˆ  é†’ä¾†         â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  [+5min] [+10min] [+15min] [+30min] [è‡ªè¨‚]        â”‚   â”‚
â”‚  â”‚                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€ Vitals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HR â”‚ 72  78  82  85  80  76  74                  â”‚   â”‚
â”‚  â”‚  BP â”‚120/80  125/85  130/90  128/88  ...          â”‚   â”‚
â”‚  â”‚  SpO2â”‚ 99  99  98  99  99  99  98                 â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚   â”‚
â”‚  â”‚     09:00  09:15  09:30  09:45  10:00  10:15       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€ äº‹ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  09:05 Propofol 150mg IV                          â”‚   â”‚
â”‚  â”‚  09:06 Fentanyl 100mcg IV                         â”‚   â”‚
â”‚  â”‚  09:08 Rocuronium 50mg IV                         â”‚   â”‚
â”‚  â”‚  09:10 Intubation ETT 7.5                         â”‚   â”‚
â”‚  â”‚  09:12 Sevoflurane 2% start                       â”‚   â”‚
â”‚  â”‚  ...                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                          â”‚
â”‚  [è¨˜éŒ„ Vitals]  [è¨˜éŒ„ç”¨è—¥]  [è¨˜éŒ„äº‹ä»¶]  [é‡Œç¨‹ç¢‘]        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ™‚é–“è»¸å…ƒä»¶çµæ§‹

```html
<!-- æ™‚é–“è»¸å®¹å™¨ -->
<div class="timeline-container">
    <!-- åˆ»åº¦è»¸ -->
    <div class="timeline-ruler">
        <!-- æ¯ 5 åˆ†é˜ä¸€å€‹åˆ»åº¦ -->
        <div class="tick" data-time="09:00">09:00</div>
        <div class="tick minor" data-time="09:05"></div>
        <div class="tick" data-time="09:10">09:10</div>
        ...
    </div>

    <!-- é‡Œç¨‹ç¢‘è»Œé“ -->
    <div class="timeline-track milestones">
        <div class="milestone" data-type="OR_IN" style="left: 0%">
            <span class="dot"></span>
            <span class="label">å…¥OR</span>
        </div>
        <div class="milestone" data-type="INDUCTION" style="left: 10%">
            <span class="dot"></span>
            <span class="label">èª˜å°</span>
        </div>
        ...
    </div>

    <!-- Vitals è»Œé“ -->
    <div class="timeline-track vitals">
        <svg class="vitals-chart">
            <!-- HR æŠ˜ç·š -->
            <polyline class="hr-line" points="..."/>
            <!-- BP ç¯„åœ -->
            <path class="bp-area" d="..."/>
        </svg>
    </div>

    <!-- äº‹ä»¶è»Œé“ -->
    <div class="timeline-track events">
        <div class="event" data-type="MEDICATION" style="left: 5%">
            <span class="icon">ğŸ’Š</span>
        </div>
        ...
    </div>

    <!-- ç•¶å‰æ™‚é–“æŒ‡ç¤ºå™¨ -->
    <div class="now-indicator"></div>
</div>
```

---

## 3. äº’å‹•è¨­è¨ˆ

### 3.1 é»æ“Šæ™‚é–“è»¸

**é»æ“Šç©ºç™½è™•** â†’ é–‹å•Ÿã€Œæ–°å¢äº‹ä»¶ã€æ¨¡æ…‹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å¢äº‹ä»¶ @ 09:23              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                â”‚
â”‚  æ™‚é–“: [09:23] [èª¿æ•´]          â”‚
â”‚                                â”‚
â”‚  é¡å‹:                         â”‚
â”‚  â—‹ é‡Œç¨‹ç¢‘  â—‹ ç”¨è—¥  â—‹ Vitals   â”‚
â”‚  â—‹ è™•ç½®    â—‹ å‚™è¨»              â”‚
â”‚                                â”‚
â”‚  [å–æ¶ˆ]           [ç¢ºèª]       â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é»æ“Šå·²å­˜åœ¨çš„äº‹ä»¶

**é»æ“Šé‡Œç¨‹ç¢‘/äº‹ä»¶** â†’ é–‹å•Ÿã€Œç·¨è¼¯äº‹ä»¶ã€æ¨¡æ…‹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç·¨è¼¯: èª˜å° (INDUCTION)        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                â”‚
â”‚  æ™‚é–“: [09:08] [èª¿æ•´]          â”‚
â”‚                                â”‚
â”‚  å‚™è¨»:                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ RSI, smooth induction  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                â”‚
â”‚  [åˆªé™¤]  [å–æ¶ˆ]  [å„²å­˜]        â”‚
â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å¿«é€Ÿæ–°å¢æŒ‰éˆ•

ç•«é¢åº•éƒ¨çš„å¿«é€Ÿæ“ä½œæŒ‰éˆ•ï¼š

| æŒ‰éˆ• | å‹•ä½œ |
|------|------|
| è¨˜éŒ„ Vitals | é–‹å•Ÿ Vitals è¼¸å…¥æ¨¡æ…‹çª— |
| è¨˜éŒ„ç”¨è—¥ | é–‹å•Ÿç”¨è—¥è¼¸å…¥æ¨¡æ…‹çª—ï¼ˆå«å¸¸ç”¨è—¥ç‰©å¿«é¸ï¼‰|
| è¨˜éŒ„äº‹ä»¶ | é–‹å•Ÿäº‹ä»¶è¼¸å…¥æ¨¡æ…‹çª— |
| é‡Œç¨‹ç¢‘ | é–‹å•Ÿé‡Œç¨‹ç¢‘å¿«é¸é¢æ¿ |

### 3.4 é‡Œç¨‹ç¢‘å¿«é¸é¢æ¿

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¸æ“‡é‡Œç¨‹ç¢‘                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ å…¥OR â”‚  â”‚ èª˜å° â”‚  â”‚ åˆ‡çš® â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ä¸»è¡“ â”‚  â”‚ ç¸«åˆ â”‚  â”‚ é†’ä¾† â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ æ‹”ç®¡ â”‚  â”‚ å‡ºOR â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                      â”‚
â”‚  æ™‚é–“: [ç¾åœ¨] / [è‡ªè¨‚: ____]        â”‚
â”‚                                      â”‚
â”‚  [å–æ¶ˆ]                    [ç¢ºèª]    â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Vitals è¨˜éŒ„

### 4.1 Vitals è¼¸å…¥æ¨¡æ…‹çª—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨˜éŒ„ Vitals @ 09:30               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                    â”‚
â”‚  HR:   [  78  ] bpm               â”‚
â”‚  BP:   [ 125 ]/[  82 ] mmHg       â”‚
â”‚  SpO2: [  99  ] %                 â”‚
â”‚  EtCO2:[  35  ] mmHg              â”‚
â”‚  Temp: [ 36.5 ] Â°C                â”‚
â”‚                                    â”‚
â”‚  â”Œâ”€ å¿«é€Ÿè¼¸å…¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [+10] [-10] HR              â”‚    â”‚
â”‚  â”‚ [+10] [-10] SBP             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                    â”‚
â”‚  [å–æ¶ˆ]              [å„²å­˜]        â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è‡ªå‹•è¨˜éŒ„æé†’

å¯è¨­å®šæ¯ 5/10/15 åˆ†é˜æé†’è¨˜éŒ„ Vitalsï¼š

```javascript
// è¨­å®šè‡ªå‹•æé†’
vitalsReminderInterval: 15,  // åˆ†é˜
lastVitalsTime: null,

checkVitalsReminder() {
    if (this.lastVitalsTime) {
        const elapsed = (Date.now() - this.lastVitalsTime) / 60000;
        if (elapsed >= this.vitalsReminderInterval) {
            this.showVitalsReminder();
        }
    }
}
```

---

## 5. è³‡æ–™çµæ§‹

### 5.1 Event Sourcing æ•´åˆ

æ‰€æœ‰æ™‚é–“è»¸äº‹ä»¶éƒ½æ˜¯ `anesthesia_events` è¡¨çš„ä¸€éƒ¨åˆ†ï¼š

```sql
-- ç¾æœ‰ anesthesia_events è¡¨çµæ§‹
CREATE TABLE anesthesia_events (
    event_id INTEGER PRIMARY KEY AUTOINCREMENT,
    case_id TEXT NOT NULL,
    event_type TEXT NOT NULL,  -- è¦‹ä¸‹æ–¹é¡å‹
    event_time INTEGER NOT NULL,
    data TEXT,  -- JSON
    recorded_by TEXT,
    recorded_at INTEGER DEFAULT (strftime('%s', 'now'))
);
```

### 5.2 äº‹ä»¶é¡å‹

| event_type | èªªæ˜ | data å…§å®¹ |
|------------|------|-----------|
| `MILESTONE` | é‡Œç¨‹ç¢‘ | `{"type": "INDUCTION", "notes": "..."}` |
| `VITALS` | ç”Ÿå‘½å¾µè±¡ | `{"hr": 78, "sbp": 120, "dbp": 80, "spo2": 99, ...}` |
| `MEDICATION` | ç”¨è—¥ | `{"drug": "Propofol", "dose": 150, "unit": "mg", "route": "IV"}` |
| `PROCEDURE` | è™•ç½® | `{"type": "INTUBATION", "details": "ETT 7.5"}` |
| `NOTE` | å‚™è¨» | `{"text": "Patient movement"}` |
| `RESOURCE_CLAIM` | PSI ä½”ç”¨ | `{"psi_id": "...", "action": "claim"}` |

### 5.3 å‰ç«¯è³‡æ–™æ¨¡å‹

```javascript
timelineData: {
    case_id: 'ANES-20260107-001',
    start_time: '2026-01-07T09:00:00',

    milestones: [
        { type: 'OR_IN', time: '09:00', notes: '' },
        { type: 'INDUCTION', time: '09:08', notes: 'RSI' },
        // ...
    ],

    vitals: [
        { time: '09:00', hr: 72, sbp: 120, dbp: 80, spo2: 99 },
        { time: '09:15', hr: 78, sbp: 125, dbp: 85, spo2: 99 },
        // ...
    ],

    medications: [
        { time: '09:05', drug: 'Propofol', dose: 150, unit: 'mg', route: 'IV' },
        // ...
    ],

    events: [
        { time: '09:10', type: 'PROCEDURE', data: { type: 'INTUBATION', details: 'ETT 7.5' }},
        // ...
    ]
}
```

---

## 6. æ™‚é–“è»¸æ¸²æŸ“ (v1.2 é‡å¤§ä¿®æ­£)

### 6.1 æ™‚é–“æ¨¡å‹ - å›ºå®šè¦–çª— (Fixed Viewport)

> âš ï¸ **v1.2 Critical Fix**: ç§»é™¤ `Date.now()` ä½œç‚ºåº§æ¨™ç³»çµ‚é»çš„éŒ¯èª¤è¨­è¨ˆ

**éŒ¯èª¤çš„èˆŠæ¨¡å‹ (å·²å»¢æ£„):**
```javascript
// âŒ éŒ¯èª¤ï¼šåº§æ¨™ç³»æœƒéš¨æ™‚é–“æ¨é€²è€Œé‡æ–°ç¸®æ”¾
// å°è‡´èˆŠäº‹ä»¶é»ä½ã€Œæ¼‚ç§»ã€ï¼Œç„¡æ³•ä¿¡ä»»è¦–è¦ºä½ç½®
timeToPosition(time) {
    const end = Date.now();  // æ¯æ¬¡å‘¼å«éƒ½è®Šï¼
    return (time - start) / (end - start) * 100;
}
```

**æ­£ç¢ºçš„æ–°æ¨¡å‹ (v1.2):**
```javascript
// âœ… æ­£ç¢ºï¼šä½¿ç”¨å›ºå®šè¦–çª— (Viewport)
// æ¯é  = 1 å°æ™‚ = å›ºå®š 3600000ms

viewport: {
    startTime: null,       // ç•¶å‰è¦–çª—èµ·å§‹æ™‚é–“ (å›ºå®š)
    endTime: null,         // ç•¶å‰è¦–çª—çµæŸæ™‚é–“ (å›ºå®š)
    duration: 3600000,     // 1 å°æ™‚ = 3600000ms
    pixelWidth: 720,       // è¦–çª—åƒç´ å¯¬åº¦ (æ¯åˆ†é˜ 12px)
},

// åˆå§‹åŒ–è¦–çª— (é€²å…¥æŸå°æ™‚é é¢æ™‚å‘¼å«)
setViewport(hourIndex) {
    const caseStart = this.caseStartTime;
    this.viewport.startTime = caseStart + (hourIndex * 3600000);
    this.viewport.endTime = this.viewport.startTime + 3600000;
},

// æ™‚é–“ â†’ åƒç´ ä½ç½® (å›ºå®šåº§æ¨™ç³»)
timeToX(timestamp) {
    const elapsed = timestamp - this.viewport.startTime;
    const ratio = elapsed / this.viewport.duration;
    return Math.round(ratio * this.viewport.pixelWidth);
},

// åƒç´ ä½ç½® â†’ æ™‚é–“
xToTime(x) {
    const ratio = x / this.viewport.pixelWidth;
    return this.viewport.startTime + (ratio * this.viewport.duration);
},

// åˆ¤æ–·æ™‚é–“æ˜¯å¦åœ¨ç•¶å‰è¦–çª—å…§
isInViewport(timestamp) {
    return timestamp >= this.viewport.startTime &&
           timestamp < this.viewport.endTime;
}
```

### 6.2 NOW æŒ‡ç¤ºå™¨ (ç¨ç«‹æ–¼åº§æ¨™ç³»)

```javascript
// NOW æ˜¯ä¸€å€‹æµ®å‹•æŒ‡ç¤ºå™¨ï¼Œä¸æ˜¯åº§æ¨™ç³»çš„ end
nowIndicator: {
    visible: true,
    position: 0,  // åƒç´ ä½ç½®
},

updateNowIndicator() {
    const now = Date.now();
    if (this.isInViewport(now)) {
        this.nowIndicator.visible = true;
        this.nowIndicator.position = this.timeToX(now);
    } else {
        this.nowIndicator.visible = false;
    }
},

// æ¯ç§’æ›´æ–° NOW ä½ç½®
startNowTimer() {
    setInterval(() => this.updateNowIndicator(), 1000);
}
```

### 6.3 åˆ†é ä½œç‚ºä¸»è¦äº’å‹•æ¨¡å‹

> **v1.2 è¨­è¨ˆåŸå‰‡**: åˆ†é æ˜¯ canonical layoutï¼Œç¸®æ”¾åªåœ¨é å…§ç™¼ç”Ÿ

```javascript
// åˆ†é ç‹€æ…‹
pagination: {
    currentHour: 0,           // ç•¶å‰é  (0-indexed)
    hoursPerPage: 1,          // æ¯é  1 å°æ™‚ (æ¨™æº–éº»é†‰å–®æ ¼å¼)
    zoomLevel: 1,             // é å…§ç¸®æ”¾ (1 = æ­£å¸¸, 2 = æ”¾å¤§)
    maxZoom: 2,               // æœ€å¤§ç¸®æ”¾ (æ¯é æœ€å¤šé¡¯ç¤º 30 åˆ†é˜)
    minZoom: 1,               // æœ€å°ç¸®æ”¾ (æ¯é é¡¯ç¤º 1 å°æ™‚)
},

// ç¸®æ”¾åªåœ¨é å…§ç”Ÿæ•ˆï¼Œä¸å½±éŸ¿åˆ†é é‚Šç•Œ
zoomIn() {
    this.pagination.zoomLevel = Math.min(
        this.pagination.maxZoom,
        this.pagination.zoomLevel * 1.5
    );
    this.renderCurrentPage();
},

zoomOut() {
    this.pagination.zoomLevel = Math.max(
        this.pagination.minZoom,
        this.pagination.zoomLevel / 1.5
    );
    this.renderCurrentPage();
}
```

### 6.4 æ‰‹å‹¢æ”¯æ´

| æ‰‹å‹¢ | å‹•ä½œ | èªªæ˜ |
|------|------|------|
| å·¦å³æ»‘å‹• | åˆ‡æ›å°æ™‚é  | ä¸»è¦å°èˆªæ–¹å¼ |
| é›™æŒ‡ç¸®æ”¾ | é å…§ç¸®æ”¾ | 1x - 2x ç¯„åœ |
| é•·æŒ‰ | å¿«é€Ÿæ–°å¢é¸å–® | åœ¨è§¸ç¢°ä½ç½®æ–°å¢äº‹ä»¶ |
| é»æ“Š NOW æŒ‰éˆ• | è·³åˆ°ç•¶å‰å°æ™‚ | å¿«é€Ÿå›åˆ°ç¾åœ¨ |

---

## 7. Vitals åœ–è¡¨ (v1.2 æ›´æ–°)

### 7.1 æ¨™æº–éº»é†‰è¨˜éŒ„å–®æ ¼å¼

éº»é†‰è¨˜éŒ„å–®çš„æ ¸å¿ƒæ˜¯**ç”Ÿå‘½å¾µè±¡è¶¨å‹¢åœ– (Vital Signs Trend)**ï¼Œæ¡ç”¨åœ‹éš›æ¨™æº–ç¬¦è™Ÿï¼š

```
ç¬¦è™Ÿæ¨™æº– (Anesthesia Chart Symbols)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  V  = æ”¶ç¸®å£“ (SBP)
  ^  = èˆ’å¼µå£“ (DBP)
  â—  = å¿ƒè·³ (HR)
  â—‹  = è¡€æ°§ (SpO2)
  Ã—  = å‘¼å¸æ¬¡æ•¸ (RR)
```

> âš ï¸ **v1.2 è¨­è¨ˆåŸå‰‡**: ç¬¦è™Ÿ + å½¢ç‹€ä½œç‚ºä¸»è¦è­˜åˆ¥ï¼Œé¡è‰²ä½œç‚ºè¼”åŠ© (Shape + Label Redundancy)

### 7.2 å¯ä¸»é¡ŒåŒ–é¡è‰²ç³»çµ± (Themable Colors)

```javascript
// v1.2: é¡è‰²ä¸ç¡¬ç·¨ç¢¼ï¼Œé€é CSS è®Šæ•¸å¯¦ç¾ä¸»é¡ŒåŒ–
// é è¨­ä¸»é¡Œ (Default Theme)
:root {
    --vital-sbp: #dc2626;      // ç´…è‰²ç³»
    --vital-dbp: #dc2626;      // ç´…è‰²ç³» (èˆ‡ SBP åŒè‰²)
    --vital-hr: #2563eb;       // è—è‰²ç³»
    --vital-spo2: #16a34a;     // ç¶ è‰²ç³»
    --vital-rr: #7c3aed;       // ç´«è‰²ç³»
    --vital-warning: #f59e0b;  // è­¦å‘Š (é»ƒ)
    --vital-critical: #dc2626; // å±æ€¥ (ç´…)
    --event-medication: #3b82f6;
    --event-procedure: #8b5cf6;
    --event-milestone: #14b8a6;
}

// é«˜å°æ¯”ä¸»é¡Œ (High Contrast Theme)
[data-theme="high-contrast"] {
    --vital-sbp: #ff0000;
    --vital-hr: #0000ff;
    --vital-spo2: #00ff00;
    // ...
}
```

### 7.3 è¶¨å‹¢åœ–è¦–è¦ºè¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  mmHg/bpm                                                     â”‚
â”‚  200 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚  180 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚  160 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚  140 â”€â”¼â”€â”€â”€â”€â”€â”€â”€Vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€Vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚      /â”‚\                  â”‚                           â”‚
â”‚  120 â”€â”¼â”€â”€â”€â”€â”€Vâ”€â”¼â”€Vâ”€â”€â”€Vâ”€â”€â”€Vâ”€â”€â”€Vâ”€â”€â”€â”€Vâ”€â”€Vâ”€â”€â”€Vâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† SBP (V)
â”‚       â”‚       â”‚   \   \   /   \       \                       â”‚
â”‚  100 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† HR (â—)
â”‚       â”‚       â”‚                                               â”‚
â”‚   80 â”€â”¼â”€â”€â”€â”€â”€â”€â”€^â”€â”€â”€^â”€â”€â”€^â”€â”€â”€^â”€â”€â”€â”€^â”€â”€^â”€â”€â”€â”€^â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â† DBP (^)
â”‚       â”‚                                                       â”‚
â”‚   60 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚   40 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚   20 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â”‚                                                       â”‚
â”‚    0 â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚       â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚        09:00  09:05  09:10  09:15  09:20  09:25  09:30        â”‚
â”‚                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚  äº‹ä»¶åˆ— (ä½¿ç”¨ SVG åœ–æ¨™ï¼Œé Emoji)ï¼š                           â”‚
â”‚   09:05 [è—¥] Propofol 150mg                                  â”‚
â”‚   09:08 [ç®¡] Intubation ETT 7.5                              â”‚
â”‚   09:12 [æ°£] Sevoflurane 2%                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 æ¸²æŸ“ç­–ç•¥ï¼šCanvas + DOM æ··åˆ (v1.2)

> âš ï¸ **v1.2 æ•ˆèƒ½è€ƒé‡**: SVG polyline åœ¨é•·æ‰‹è¡“ (æ¯ 5 åˆ†é˜ä¸€é» Ã— 5 æ¢ç·š Ã— 10 å°æ™‚ = 600+ é») æœƒå°è‡´è¡Œå‹•è£ç½®æ•ˆèƒ½ä¸‹é™

**æ¨è–¦æ¶æ§‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Y-Axis Labels (DOM)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚   Vitals Canvas (Canvas 2D)      â”‚  â”‚ â† é«˜æ•ˆèƒ½ç¹ªåœ–
â”‚  â”‚   - Grid lines                    â”‚  â”‚
â”‚  â”‚   - SBP/DBP/HR/SpO2/RR points    â”‚  â”‚
â”‚  â”‚   - Trend lines                   â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Events Track (DOM + SVG Icons)         â”‚ â† å¯é»æ“Šäº’å‹•
â”‚  NOW Indicator (DOM)                    â”‚ â† ç¨ç«‹æ›´æ–°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  X-Axis Labels (DOM)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```javascript
// Canvas ç¹ªåœ–å™¨
class VitalsCanvasRenderer {
    constructor(canvasElement) {
        this.canvas = canvasElement;
        this.ctx = canvasElement.getContext('2d');
        this.dpr = window.devicePixelRatio || 1;
        this.setupHighDPI();
    }

    setupHighDPI() {
        const rect = this.canvas.getBoundingClientRect();
        this.canvas.width = rect.width * this.dpr;
        this.canvas.height = rect.height * this.dpr;
        this.ctx.scale(this.dpr, this.dpr);
    }

    render(vitalsData, viewport) {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.drawGrid();
        this.drawVitals(vitalsData, viewport);
    }

    drawVitals(vitalsData, viewport) {
        // åªç¹ªè£½ç•¶å‰è¦–çª—å…§çš„é»
        const visibleVitals = vitalsData.filter(v =>
            v.time >= viewport.startTime && v.time < viewport.endTime
        );

        // æ‰¹é‡ç¹ªè£½æ¯ç¨®é¡å‹
        this.drawVitalType(visibleVitals, 'SBP', 'V');
        this.drawVitalType(visibleVitals, 'DBP', '^');
        this.drawVitalType(visibleVitals, 'HR', 'â—');
        this.drawVitalType(visibleVitals, 'SpO2', 'â—‹');
    }
}
```

### 7.5 äº‹ä»¶åœ–æ¨™ï¼šSVG å–ä»£ Emoji (v1.2)

> âš ï¸ **v1.2**: ç¦æ­¢ä½¿ç”¨ Emoji ä½œç‚ºäº‹ä»¶åœ–æ¨™ï¼Œå› ç‚ºä¸åŒ OS å­—å‹æ¸²æŸ“ä¸ä¸€è‡´

```html
<!-- äº‹ä»¶åœ–æ¨™å®šç¾© (SVG Sprite) -->
<svg style="display:none">
    <symbol id="icon-medication" viewBox="0 0 24 24">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L12 14.17l6.59-6.59L20 9l-8 8z"/>
    </symbol>
    <symbol id="icon-procedure" viewBox="0 0 24 24">
        <path d="M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75 1.84-1.83z"/>
        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/>
    </symbol>
    <symbol id="icon-intubation" viewBox="0 0 24 24">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93z"/>
    </symbol>
    <symbol id="icon-gas" viewBox="0 0 24 24">
        <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
    </symbol>
</svg>

<!-- ä½¿ç”¨æ–¹å¼ -->
<svg class="event-icon" width="16" height="16">
    <use href="#icon-medication"></use>
</svg>
```

### 7.6 SVG ç¶²æ ¼å¯¦ä½œ (è¼•é‡ DOM)

```html
<div class="vitals-canvas-container">
    <!-- Yè»¸æ¨™ç±¤ -->
    <div class="y-axis">
        <span>200</span>
        <span>160</span>
        <span>120</span>
        <span>80</span>
        <span>40</span>
        <span>0</span>
    </div>

    <!-- ä¸»ç¹ªåœ–å€ -->
    <svg class="vitals-canvas" viewBox="0 0 720 300" preserveAspectRatio="none">
        <!-- ç¶²æ ¼ç·š -->
        <defs>
            <pattern id="grid" width="60" height="30" patternUnits="userSpaceOnUse">
                <path d="M 60 0 L 0 0 0 30" fill="none" stroke="#e5e7eb" stroke-width="0.5"/>
            </pattern>
        </defs>
        <rect width="100%" height="100%" fill="url(#grid)"/>

        <!-- SBP æŠ˜ç·š (V ç¬¦è™Ÿ) -->
        <g class="sbp-layer">
            <polyline class="sbp-line" points="..." fill="none" stroke="#dc2626" stroke-width="1.5"/>
            <!-- V ç¬¦è™Ÿæ¨™è¨˜ -->
            <text x="60" y="90" class="vital-symbol sbp">V</text>
            <text x="120" y="85" class="vital-symbol sbp">V</text>
            ...
        </g>

        <!-- DBP æŠ˜ç·š (^ ç¬¦è™Ÿ) -->
        <g class="dbp-layer">
            <polyline class="dbp-line" points="..." fill="none" stroke="#dc2626" stroke-width="1"/>
            <text x="60" y="165" class="vital-symbol dbp">^</text>
            ...
        </g>

        <!-- HR æŠ˜ç·š (â— ç¬¦è™Ÿ) -->
        <g class="hr-layer">
            <polyline class="hr-line" points="..." fill="none" stroke="#2563eb" stroke-width="1.5"/>
            <circle cx="60" cy="150" r="4" fill="#2563eb"/>
            <circle cx="120" cy="145" r="4" fill="#2563eb"/>
            ...
        </g>

        <!-- SpO2 (â—‹ ç¬¦è™Ÿ) - é ‚éƒ¨å€åŸŸ -->
        <g class="spo2-layer">
            <polyline class="spo2-line" points="..." fill="none" stroke="#16a34a" stroke-width="1"/>
            <circle cx="60" cy="15" r="3" fill="none" stroke="#16a34a"/>
            ...
        </g>

        <!-- äº‹ä»¶æ¨™è¨˜ (å‚ç›´ç·š + åœ–æ¨™) -->
        <g class="events-layer">
            <line x1="60" y1="0" x2="60" y2="300" stroke="#f59e0b" stroke-width="1" stroke-dasharray="4"/>
            <text x="60" y="295" class="event-label">ğŸ’Š</text>
        </g>
    </svg>

    <!-- Xè»¸æ™‚é–“æ¨™ç±¤ -->
    <div class="x-axis">
        <span>09:00</span>
        <span>09:05</span>
        <span>09:10</span>
        ...
    </div>
</div>
```

### 7.4 åº§æ¨™è½‰æ›å‡½æ•¸

```javascript
// Yè»¸ï¼š0-220 mmHg/bpm -> SVG 0-300px (å€’ç½®)
valueToY(value, maxValue = 220) {
    return 300 - (value / maxValue) * 300;
}

// Xè»¸ï¼šæ™‚é–“ -> SVG åƒç´  (æ¯åˆ†é˜ 12px)
timeToX(time) {
    const elapsed = (time - this.hourStartTime) / 60000; // åˆ†é˜æ•¸
    return elapsed * 12; // æ¯åˆ†é˜ 12px = 1å°æ™‚ 720px
}

// ç¹ªè£½ Vitals é»
plotVital(time, type, value) {
    const x = this.timeToX(time);
    const y = this.valueToY(value);
    const symbol = this.getSymbol(type);

    // æ ¹æ“šé¡å‹ç¹ªè£½ä¸åŒç¬¦è™Ÿ
    switch(type) {
        case 'SBP':
            this.drawText(x, y, 'V', '#dc2626');
            break;
        case 'DBP':
            this.drawText(x, y, '^', '#dc2626');
            break;
        case 'HR':
            this.drawCircle(x, y, 4, '#2563eb', true);
            break;
        case 'SpO2':
            this.drawCircle(x, y, 3, '#16a34a', false);
            break;
        case 'RR':
            this.drawText(x, y, 'Ã—', '#7c3aed');
            break;
    }
}
```

### 7.5 ç•°å¸¸å€¼è­¦ç¤º

```javascript
// ç•°å¸¸å€¼å®šç¾©
VITAL_LIMITS: {
    HR:   { low: 50,  high: 120, critical_low: 40,  critical_high: 150 },
    SBP:  { low: 90,  high: 160, critical_low: 70,  critical_high: 200 },
    DBP:  { low: 50,  high: 100, critical_low: 40,  critical_high: 120 },
    SpO2: { low: 94,  high: 100, critical_low: 90,  critical_high: 100 },
    RR:   { low: 10,  high: 24,  critical_low: 8,   critical_high: 30 }
},

// æª¢æŸ¥ç•°å¸¸ä¸¦æ¨™è‰²
getVitalColor(type, value) {
    const limits = this.VITAL_LIMITS[type];
    if (value <= limits.critical_low || value >= limits.critical_high) {
        return '#dc2626';  // ç´…è‰² - å±æ€¥
    }
    if (value <= limits.low || value >= limits.high) {
        return '#f59e0b';  // é»ƒè‰² - è­¦å‘Š
    }
    return this.DEFAULT_COLORS[type];  // æ­£å¸¸é¡è‰²
}
```

---

## 8. æ¨™æº–é‡Œç¨‹ç¢‘

### 8.1 å…¨èº«éº»é†‰ (GA)

| é †åº | ä»£ç¢¼ | ä¸­æ–‡ | è‹±æ–‡ |
|:----:|------|------|------|
| 1 | OR_IN | å…¥OR | OR In |
| 2 | INDUCTION | èª˜å° | Induction |
| 3 | INTUBATION | æ’ç®¡ | Intubation |
| 4 | INCISION | åˆ‡çš® | Incision |
| 5 | MAIN_PROCEDURE | ä¸»è¡“ | Main Procedure |
| 6 | CLOSURE | ç¸«åˆ | Closure |
| 7 | EMERGENCE | é†’ä¾† | Emergence |
| 8 | EXTUBATION | æ‹”ç®¡ | Extubation |
| 9 | OR_OUT | å‡ºOR | OR Out |

### 8.2 å€åŸŸéº»é†‰ (RA)

| é †åº | ä»£ç¢¼ | ä¸­æ–‡ |
|:----:|------|------|
| 1 | OR_IN | å…¥OR |
| 2 | BLOCK_START | é–‹å§‹é˜»æ–· |
| 3 | BLOCK_COMPLETE | é˜»æ–·å®Œæˆ |
| 4 | INCISION | åˆ‡çš® |
| 5 | MAIN_PROCEDURE | ä¸»è¡“ |
| 6 | CLOSURE | ç¸«åˆ |
| 7 | OR_OUT | å‡ºOR |

---

## 9. åº«å­˜èˆ‡è¨ˆè²»é€£å‹• (v1.2 Event Sourcing æ¨¡å‹)

### 9.1 è¨­è¨ˆç†å¿µ

> **ã€Œéº»é†‰é†«å¸«åªç®¡æ•‘äººï¼Œç³»çµ±è‡ªå‹•ç®—éŒ¢èˆ‡åº«å­˜ã€**

ç•¶éº»é†‰å¸«åœ¨æ™‚é–“è»¸ä¸Šè¨˜éŒ„ç”¨è—¥äº‹ä»¶ï¼Œç³»çµ±è‡ªå‹•å®Œæˆï¼š
1. MIRS åº«å­˜æ¶ˆè²»äº‹ä»¶
2. CashDesk è¨ˆè²»äº‹ä»¶
3. ç®¡åˆ¶è—¥å“é›™é‡é©—è­‰

### 9.2 Event Sourcing æ¶æ§‹ (v1.2 æ ¸å¿ƒè®Šæ›´)

> âš ï¸ **v1.2 Critical**: æ‰€æœ‰æ“ä½œéƒ½æ˜¯**ä¸å¯è®Šäº‹ä»¶ (Immutable Events)**ï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹/åˆªé™¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Event Sourcing è³‡æ–™æµ                             â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚ Anes PWA     â”‚                                                  â”‚
â”‚   â”‚ è¨˜éŒ„çµ¦è—¥     â”‚                                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚          â”‚                                                          â”‚
â”‚          â–¼                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  MedicationAdministeredEvent (ä¸å¯è®Š)                         â”‚ â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚   â”‚  event_id: "EVT-20260119-001" (å†ªç­‰éµ)                       â”‚ â”‚
â”‚   â”‚  case_id: "ANES-001"                                         â”‚ â”‚
â”‚   â”‚  drug_code: "PROP-200"                                       â”‚ â”‚
â”‚   â”‚  dose: 200, unit: "mg", route: "IV"                          â”‚ â”‚
â”‚   â”‚  lot_number: "LOT-2026-001" (ç®¡åˆ¶è—¥å¿…å¡«)                     â”‚ â”‚
â”‚   â”‚  expiry_date: "2026-06-30" (ç®¡åˆ¶è—¥å¿…å¡«)                      â”‚ â”‚
â”‚   â”‚  performed_by: "DR-WANG"                                     â”‚ â”‚
â”‚   â”‚  performed_at: 1705654800000                                 â”‚ â”‚
â”‚   â”‚  witness_by: "NS-LEE" (ç®¡åˆ¶è—¥å¿…å¡«)                           â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚                                                          â”‚
â”‚          â”‚ Event è§¸ç™¼ (æ¯å€‹äº‹ä»¶åªè¢«æ¶ˆè²»ä¸€æ¬¡)                         â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚          â–¼                         â–¼                            â–¼  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Inventory   â”‚          â”‚ Billing     â”‚          â”‚ Audit       â”‚â”‚
â”‚   â”‚ Consumer    â”‚          â”‚ Consumer    â”‚          â”‚ Consumer    â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚          â”‚                         â”‚                            â”‚  â”‚
â”‚          â–¼                         â–¼                            â–¼  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚   â”‚ Inventory   â”‚          â”‚ Billing     â”‚          â”‚ Audit       â”‚â”‚
â”‚   â”‚ ConsumedEvt â”‚          â”‚ ChargeEvt   â”‚          â”‚ LogEvent    â”‚â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 äº‹ä»¶çµæ§‹å®šç¾©

#### 9.3.1 MedicationAdministeredEvent (çµ¦è—¥äº‹ä»¶)

```typescript
interface MedicationAdministeredEvent {
    // === å†ªç­‰æ€§ ===
    event_id: string;           // UUIDï¼Œå‰ç«¯ç”Ÿæˆï¼Œç¢ºä¿é‡è©¦ä¸é‡è¤‡
    idempotency_key: string;    // åŒä¸Šï¼ŒAPI å±¤ä½¿ç”¨

    // === ç—…ä¾‹é—œè¯ ===
    case_id: string;
    patient_id: string;

    // === è—¥ç‰©è³‡è¨Š ===
    drug_code: string;          // å°æ‡‰ pharmacy_items.item_code
    drug_name: string;
    dose: number;
    unit: string;               // mg, mcg, ml, etc.
    route: string;              // IV, IM, PO, INH, SC, etc.

    // === ç®¡åˆ¶è—¥å“å¿…å¡«æ¬„ä½ ===
    lot_number?: string;        // æ‰¹è™Ÿ (ç®¡åˆ¶è—¥å¿…å¡«)
    expiry_date?: string;       // æ•ˆæœŸ (ç®¡åˆ¶è—¥å¿…å¡«)
    witness_by?: string;        // è¦‹è­‰äºº (ç®¡åˆ¶è—¥å¿…å¡«)

    // === åŸ·è¡Œè³‡è¨Š ===
    performed_by: string;       // åŸ·è¡Œè€… ID
    performed_at: number;       // åŸ·è¡Œæ™‚é–“ (timestamp)
    recorded_at: number;        // è¨˜éŒ„æ™‚é–“ (timestamp)

    // === ç‹€æ…‹æ¨™è¨˜ ===
    is_stat: boolean;           // ç·Šæ€¥ç”¨è—¥
    is_controlled: boolean;     // ç®¡åˆ¶è—¥å“
}
```

#### 9.3.2 MedicationReversedEvent (æ’¤éŠ·äº‹ä»¶)

> âš ï¸ **v1.2**: ä¸ä½¿ç”¨ DELETEï¼Œæ”¹ç”¨è£œå„Ÿäº‹ä»¶ (Compensating Event)

```typescript
interface MedicationReversedEvent {
    event_id: string;           // æ–°çš„äº‹ä»¶ ID
    original_event_id: string;  // è¢«æ’¤éŠ·çš„äº‹ä»¶ ID
    case_id: string;

    // === æ’¤éŠ·è³‡è¨Š ===
    reversal_reason: string;    // å¿…å¡«ï¼šç‚ºä»€éº¼æ’¤éŠ·
    reversal_type: 'ERROR' | 'DUPLICATE' | 'NOT_GIVEN' | 'OTHER';

    // === åŸ·è¡Œè³‡è¨Š ===
    reversed_by: string;
    reversed_at: number;
    witness_by?: string;        // ç®¡åˆ¶è—¥å“æ’¤éŠ·ä¹Ÿéœ€è¦è¦‹è­‰
}
```

### 9.4 API è¨­è¨ˆ (v1.2)

#### 9.4.1 æ–°å¢ç”¨è—¥äº‹ä»¶ (Idempotent)

```javascript
// POST /api/anesthesia/events/medication
// Header: X-Idempotency-Key: {client-generated-uuid}

async recordMedication(caseId, medication) {
    const eventId = xIRS.API.generateIdempotencyKey();

    const payload = {
        event_id: eventId,
        case_id: caseId,
        drug_code: medication.drugCode,
        drug_name: medication.drugName,
        dose: medication.dose,
        unit: medication.unit,
        route: medication.route,
        performed_at: medication.time,

        // ç®¡åˆ¶è—¥å“å¿…å¡«
        lot_number: medication.lotNumber || null,
        expiry_date: medication.expiryDate || null,
        witness_by: medication.witnessId || null,

        is_stat: medication.isStat || false,
        is_controlled: medication.isControlled || false
    };

    const response = await xIRS.API.post(
        '/api/anesthesia/events/medication',
        payload,
        { idempotencyKey: eventId }
    );

    // å›æ‡‰
    // {
    //     event_id: "EVT-20260119-001",
    //     status: "RECORDED",
    //     downstream_events: {
    //         inventory_consumed_event_id: "INV-EVT-001",
    //         billing_charge_event_id: "BL-EVT-001"
    //     }
    // }
}
```

#### 9.4.2 æ’¤éŠ·ç”¨è—¥äº‹ä»¶ (Compensating Event)

```javascript
// POST /api/anesthesia/events/medication/reverse
// æ³¨æ„ï¼šæ˜¯ POST ä¸æ˜¯ DELETE

async reverseEvent(originalEventId, reason, reversalType) {
    const payload = {
        original_event_id: originalEventId,
        reversal_reason: reason,
        reversal_type: reversalType,  // 'ERROR' | 'DUPLICATE' | 'NOT_GIVEN' | 'OTHER'
        witness_by: this.currentWitness || null
    };

    const response = await xIRS.API.post(
        '/api/anesthesia/events/medication/reverse',
        payload
    );

    // å›æ‡‰
    // {
    //     reversal_event_id: "REV-EVT-001",
    //     original_event_id: "EVT-20260119-001",
    //     status: "REVERSED",
    //     downstream_events: {
    //         inventory_restored_event_id: "INV-EVT-002",
    //         billing_void_event_id: "BL-EVT-002"
    //     }
    // }

    // åŸå§‹äº‹ä»¶ä¿ç•™åœ¨ event stream ä¸­ï¼Œåªæ˜¯è¢«æ¨™è¨˜ç‚ºå·²æ’¤éŠ·
}
```

### 9.4 ç®¡åˆ¶è—¥å“è™•ç†

ç®¡åˆ¶è—¥å“ (Controlled Drugs) éœ€è¦é¡å¤–é©—è­‰ï¼š

```javascript
// ç®¡åˆ¶è—¥å“é¡åˆ¥
CONTROLLED_DRUG_CLASSES: {
    'CLASS_1': ['Morphine', 'Fentanyl', 'Pethidine'],
    'CLASS_2': ['Ketamine', 'Midazolam'],
    'CLASS_3': ['Diazepam', 'Lorazepam']
},

// UIï¼šç®¡åˆ¶è—¥å“ç´…æ¡†æ¨™ç¤º
isControlledDrug(drugCode) {
    const drugInfo = this.drugDatabase.find(d => d.code === drugCode);
    return drugInfo?.controlled_class != null;
}

// UIï¼šæ–°å¢ç®¡åˆ¶è—¥å“éœ€è¦ç¢ºèª
async addControlledDrugEvent(medication) {
    const confirmed = await this.showConfirmDialog({
        title: 'âš ï¸ ç®¡åˆ¶è—¥å“ç¢ºèª',
        message: `å³å°‡è¨˜éŒ„ ${medication.drugName} ${medication.dose}${medication.unit}`,
        confirmText: 'ç¢ºèªç„¡èª¤',
        cancelText: 'å–æ¶ˆ',
        requireDoubleCheck: true  // éœ€è¦å‹¾é¸ç¢ºèªæ¡†
    });

    if (confirmed) {
        await this.recordMedication(this.caseId, medication);
    }
}
```

### 9.5 ç”¨è—¥é¸å–®è¨­è¨ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨˜éŒ„ç”¨è—¥ @ 09:15                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€ å¸¸ç”¨è—¥ç‰© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Propofol]  [Fentanyl]         â”‚   â”‚
â”‚  â”‚  [Rocuronium] [Sevoflurane]     â”‚   â”‚
â”‚  â”‚  [Midazolam]  [Ketamine] âš ï¸     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚
â”‚  è—¥ç‰©: [Propofol           â–¼]          â”‚
â”‚  åŠ‘é‡: [200    ] [mg  â–¼]               â”‚
â”‚  é€”å¾‘: [IV     â–¼]                      â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€ åº«å­˜è³‡è¨Š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  ç¾æœ‰åº«å­˜: 8 æ”¯                â”‚     â”‚
â”‚  â”‚  æ‰¹è™Ÿ: LOT-2026-001           â”‚     â”‚
â”‚  â”‚  æ•ˆæœŸ: 2026-06-30             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                        â”‚
â”‚  [å–æ¶ˆ]              [è¨˜éŒ„ç”¨è—¥]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.6 è¨ˆè²»é …ç›®å°ç…§è¡¨

| éº»é†‰è—¥ç‰© | drug_code | å°æ‡‰ pricebook item_code | å¥ä¿é»æ•¸ |
|---------|-----------|-------------------------|---------|
| Propofol 200mg | PROP-200 | MED-PROP-200 | 150 |
| Fentanyl 100mcg | FENT-100 | MED-FENT-100 | 85 |
| Rocuronium 50mg | ROCU-50 | MED-ROCU-50 | 280 |
| Sevoflurane (per hr) | SEVO-HR | MED-SEVO-HR | 450 |
| Ketamine 100mg | KET-100 | MED-KET-100 | 120 |

---

## 10. åˆ†é èˆ‡æ²å‹•æ©Ÿåˆ¶ (v1.1 æ–°å¢)

### 10.1 è¨­è¨ˆåŸå‰‡

æ¨™æº–éº»é†‰ç´€éŒ„å–®ä¸€å¼µç´™ç´„ 1-2 å°æ™‚ã€‚é‡å°é•·æ™‚é–“æ‰‹è¡“ (8-12 å°æ™‚)ï¼Œæ¡ç”¨**åˆ†é æ©Ÿåˆ¶**è€Œéç„¡é™æ²å‹•ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  â—€ ç¬¬ 2 å°æ™‚ (09:00 - 10:00)                    â–¶      â”‚
â”‚    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•         â”‚
â”‚                                                         â”‚
â”‚  [01] [02] [03] [04] [05] [06] [07] [08] ... [ç¾åœ¨]    â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â”‚           (Vitals è¶¨å‹¢åœ–)                     â”‚     â”‚
â”‚  â”‚                                               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 åˆ†é ç‹€æ…‹ç®¡ç†

```javascript
pagination: {
    hourDuration: 60,              // æ¯é é¡¯ç¤º 60 åˆ†é˜
    currentHour: 0,                // ç•¶å‰é¡¯ç¤ºçš„å°æ™‚ç´¢å¼• (0 = ç¬¬ä¸€å°æ™‚)
    totalHours: 1,                 // ç¸½æ‰‹è¡“æ™‚æ•¸
    caseStartTime: null,           // æ‰‹è¡“é–‹å§‹æ™‚é–“
},

// è¨ˆç®—ç¸½é æ•¸
get totalPages() {
    const elapsed = Date.now() - this.pagination.caseStartTime;
    return Math.ceil(elapsed / (60 * 60 * 1000));
},

// åˆ‡æ›åˆ°æŒ‡å®šå°æ™‚
goToHour(hourIndex) {
    this.pagination.currentHour = Math.max(0, Math.min(hourIndex, this.totalPages - 1));
    this.renderCurrentHour();
},

// å‰ä¸€å°æ™‚
prevHour() {
    if (this.pagination.currentHour > 0) {
        this.goToHour(this.pagination.currentHour - 1);
    }
},

// ä¸‹ä¸€å°æ™‚
nextHour() {
    if (this.pagination.currentHour < this.totalPages - 1) {
        this.goToHour(this.pagination.currentHour + 1);
    }
},

// è·³åˆ°ã€Œç¾åœ¨ã€
goToNow() {
    this.goToHour(this.totalPages - 1);
}
```

### 10.3 å°æ™‚é¸æ“‡å™¨ UI

```html
<!-- å°æ™‚é¸æ“‡å™¨ -->
<div class="hour-selector flex items-center gap-2 p-2 bg-gray-100">
    <button @click="prevHour()" :disabled="pagination.currentHour === 0"
            class="p-2 rounded-lg hover:bg-gray-200 disabled:opacity-50">
        â—€
    </button>

    <div class="flex-1 flex items-center justify-center gap-1 overflow-x-auto">
        <template x-for="hour in totalPages" :key="hour">
            <button @click="goToHour(hour - 1)"
                    :class="pagination.currentHour === hour - 1 ? 'bg-blue-600 text-white' : 'bg-white'"
                    class="w-8 h-8 rounded-full text-sm font-medium">
                <span x-text="hour"></span>
            </button>
        </template>
    </div>

    <button @click="nextHour()" :disabled="pagination.currentHour >= totalPages - 1"
            class="p-2 rounded-lg hover:bg-gray-200 disabled:opacity-50">
        â–¶
    </button>

    <button @click="goToNow()" class="px-3 py-1 bg-red-600 text-white rounded-lg text-sm">
        ç¾åœ¨
    </button>
</div>
```

### 10.4 æ‰‹å‹¢æ”¯æ´

```javascript
// Touch æ‰‹å‹¢ï¼šå·¦å³æ»‘å‹•åˆ‡æ›å°æ™‚
initSwipeGesture() {
    let startX = 0;
    const container = this.$refs.timelineContainer;

    container.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
    });

    container.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].clientX;
        const diff = endX - startX;

        if (Math.abs(diff) > 50) {  // æ»‘å‹•è¶…é 50px
            if (diff > 0) {
                this.prevHour();  // å³æ»‘ â†’ å‰ä¸€å°æ™‚
            } else {
                this.nextHour();  // å·¦æ»‘ â†’ ä¸‹ä¸€å°æ™‚
            }
        }
    });
}
```

---

## 11. ç·Šæ€¥æ“ä½œ (v1.1 æ–°å¢)

### 11.1 Code Blue / Stat æŒ‰éˆ•

ç·Šæ€¥æƒ…æ³ä¸‹ï¼Œé†«å¸«ç„¡æ³•æ…¢æ…¢å¡«è¡¨å–®ã€‚æä¾›ä¸€éµè¨˜éŒ„åŠŸèƒ½ï¼š

```html
<!-- ç·Šæ€¥æŒ‰éˆ• (å¸¸é§æ–¼ç•«é¢å³ä¸‹è§’) -->
<div class="fixed bottom-20 right-4 z-50">
    <button @click="showStatMenu = true"
            class="w-14 h-14 rounded-full bg-red-600 text-white shadow-lg
                   flex items-center justify-center text-2xl
                   active:scale-95 transition-transform">
        âš¡
    </button>
</div>

<!-- Stat å¿«é¸é¸å–® -->
<div x-show="showStatMenu" x-cloak
     class="fixed inset-0 z-50 bg-black/50 flex items-center justify-center">
    <div class="bg-white rounded-2xl p-6 max-w-sm w-full mx-4">
        <h3 class="text-lg font-bold text-red-600 mb-4">âš¡ ç·Šæ€¥ç”¨è—¥</h3>

        <div class="grid grid-cols-2 gap-3">
            <button @click="statDrug('Epinephrine', 1, 'mg')"
                    class="p-4 bg-red-100 text-red-800 rounded-xl font-bold">
                Epinephrine 1mg
            </button>
            <button @click="statDrug('Atropine', 0.5, 'mg')"
                    class="p-4 bg-red-100 text-red-800 rounded-xl font-bold">
                Atropine 0.5mg
            </button>
            <button @click="statDrug('Ephedrine', 10, 'mg')"
                    class="p-4 bg-amber-100 text-amber-800 rounded-xl font-bold">
                Ephedrine 10mg
            </button>
            <button @click="statDrug('Phenylephrine', 100, 'mcg')"
                    class="p-4 bg-amber-100 text-amber-800 rounded-xl font-bold">
                Neo 100mcg
            </button>
        </div>

        <button @click="showStatMenu = false"
                class="w-full mt-4 py-3 bg-gray-200 rounded-xl">
            å–æ¶ˆ
        </button>
    </div>
</div>
```

### 11.2 Stat ç”¨è—¥å‡½æ•¸

```javascript
// ä¸€éµè¨˜éŒ„ç·Šæ€¥ç”¨è—¥ (æ™‚é–“ = ç¾åœ¨)
async statDrug(drugName, dose, unit) {
    const now = Date.now();

    // ç›´æ¥è¨˜éŒ„ï¼Œè·³éç¢ºèªå°è©±æ¡†
    await this.recordMedication(this.caseId, {
        time: now,
        drugCode: this.getDrugCode(drugName),
        drugName: drugName,
        dose: dose,
        unit: unit,
        route: 'IV',
        isStat: true  // æ¨™è¨˜ç‚ºç·Šæ€¥ç”¨è—¥
    });

    this.showStatMenu = false;

    // éœ‡å‹•å›é¥‹ (å¦‚æœæ”¯æ´)
    if (navigator.vibrate) {
        navigator.vibrate(100);
    }

    // Toast é€šçŸ¥
    XIRS_TOAST.success(`å·²è¨˜éŒ„ ${drugName} ${dose}${unit}`);
}
```

---

## 12. CSS æ¨£å¼

```css
/* æ™‚é–“è»¸å®¹å™¨ */
.timeline-container {
    position: relative;
    width: 100%;
    height: 200px;
    overflow-x: auto;
    overflow-y: hidden;
}

/* åˆ»åº¦è»¸ */
.timeline-ruler {
    display: flex;
    height: 24px;
    border-bottom: 1px solid #e5e7eb;
}

.timeline-ruler .tick {
    position: absolute;
    font-size: 10px;
    color: #6b7280;
}

.timeline-ruler .tick.minor::before {
    content: '';
    position: absolute;
    bottom: 0;
    width: 1px;
    height: 4px;
    background: #d1d5db;
}

/* é‡Œç¨‹ç¢‘ */
.milestone {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
}

.milestone .dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #14b8a6;
    border: 2px solid white;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.milestone .label {
    font-size: 10px;
    margin-top: 4px;
    white-space: nowrap;
}

/* äº‹ä»¶æ¨™è¨˜ */
.event {
    position: absolute;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    cursor: pointer;
}

/* ç•¶å‰æ™‚é–“æŒ‡ç¤ºå™¨ */
.now-indicator {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #ef4444;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
```

---

## 13. å¯¦ä½œè¨ˆç•« (v1.1 æ›´æ–°)

### Phase 1: åŸºç¤æ™‚é–“è»¸
1. æ™‚é–“è»¸å®¹å™¨ + åˆ»åº¦è»¸
2. é‡Œç¨‹ç¢‘é¡¯ç¤º
3. é»æ“Šé‡Œç¨‹ç¢‘ç·¨è¼¯

### Phase 2: Vitals è¶¨å‹¢åœ– â­ (v1.1)
1. SVG Canvas ç¶²æ ¼ç¹ªè£½
2. æ¨™æº–ç¬¦è™Ÿ (V/^/â—/â—‹/Ã—) ç¹ªè£½
3. ç•°å¸¸å€¼è‡ªå‹•æ¨™è‰²
4. Xè»¸èˆ‡æ™‚é–“è»¸åŒæ­¥æ²å‹•

### Phase 3: äº‹ä»¶è¨˜éŒ„
1. æ–°å¢äº‹ä»¶æ¨¡æ…‹çª—
2. Vitals è¼¸å…¥æ¨¡æ…‹çª—
3. ç”¨è—¥è¼¸å…¥æ¨¡æ…‹çª—ï¼ˆå«å¸¸ç”¨è—¥ç‰©å¿«é¸ï¼‰

### Phase 4: åº«å­˜èˆ‡è¨ˆè²»é€£å‹• â­ (v1.1)
1. MIRS åº«å­˜æ‰£æ¸› API
2. CashDesk è¨ˆè²»é …ç›®ç”Ÿæˆ
3. ç®¡åˆ¶è—¥å“é›™é‡é©—è­‰
4. äº‹ä»¶åˆªé™¤ â†’ åº«å­˜å›è£œ

### Phase 5: åˆ†é èˆ‡ UX â­ (v1.1)
1. æ¯å°æ™‚åˆ†é é¡¯ç¤º
2. å°æ™‚é¸æ“‡å™¨ UI
3. å·¦å³æ»‘å‹•æ‰‹å‹¢
4. Code Blue / Stat ç·Šæ€¥æŒ‰éˆ•

### Phase 6: é€²éšåŠŸèƒ½
1. è‡ªå‹• Vitals æé†’
2. åˆ—å°/åŒ¯å‡º
3. é›¢ç·šæ”¯æ´

---

## 14. æœªæ±ºå•é¡Œ

- [x] ~~Vitals ç•°å¸¸å€¼æ˜¯å¦è‡ªå‹•æ¨™ç´…ï¼Ÿ~~ â†’ v1.1 å·²å®šç¾©
- [ ] æ™‚é–“è»¸æ˜¯å¦éœ€è¦å‚ç›´æ¨¡å¼ï¼ˆæ‰‹æ©Ÿç›´å¼ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦éœ€è¦èªéŸ³è¼¸å…¥ï¼Ÿ
- [ ] é›¢ç·šæ™‚çš„æ™‚é–“åŒæ­¥ç­–ç•¥ï¼Ÿ
- [ ] èˆ‡ CIRS ç—…æ­·çš„æ•´åˆæ–¹å¼ï¼Ÿ

---

## 15. ç³»çµ±æ•´åˆé—œä¿‚åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         xIRS ç³»çµ±æ•´åˆ                            â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚   â”‚ Anes PWA  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ æ™‚é–“è»¸ UI  â”‚                                           â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                           â”‚    â”‚
â”‚         â”‚                                                  â”‚    â”‚
â”‚         â”‚ ç”¨è—¥äº‹ä»¶                                         â”‚    â”‚
â”‚         â–¼                                                  â–¼    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   MIRS    â”‚â”€â”€â”€â”€â–¶â”‚ Pharmacy  â”‚â”€â”€â”€â”€â–¶â”‚ CashDesk  â”‚           â”‚
â”‚   â”‚  Backend  â”‚     â”‚ Inventory â”‚     â”‚  Billing  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚         â”‚                                    â”‚                 â”‚
â”‚         â”‚                                    â”‚                 â”‚
â”‚         â–¼                                    â–¼                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚   CIRS    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Handoff  â”‚           â”‚
â”‚   â”‚  ç—…æ­·ç³»çµ±  â”‚   Handoff Package     â”‚  Package  â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Changelog

| ç‰ˆæœ¬ | æ—¥æœŸ | è®Šæ›´ |
|------|------|------|
| v1.0 | 2026-01-07 | åˆç‰ˆ |
| v1.1 | 2026-01-19 | æ–°å¢ï¼š(1) æ¨™æº–éº»é†‰è¨˜éŒ„å–®è¶¨å‹¢åœ– (V/^/â—/â—‹ ç¬¦è™Ÿ) (2) åº«å­˜èˆ‡è¨ˆè²»é€£å‹• API (3) åˆ†é æ©Ÿåˆ¶ (æ¯å°æ™‚ä¸€é ) (4) Code Blue ç·Šæ€¥æŒ‰éˆ• (5) ç®¡åˆ¶è—¥å“è™•ç†æµç¨‹ |
| v1.2 | 2026-01-19 | **Critical Fixes** (Based on ChatGPT review)ï¼š(1) æ™‚é–“æ¨¡å‹æ”¹ç‚ºå›ºå®šè¦–çª— (Fixed Viewport)ï¼Œç§»é™¤ Date.now() ä½œç‚ºåº§æ¨™ç³»çµ‚é»çš„éŒ¯èª¤ (2) åˆ†é ä½œç‚ºä¸»è¦äº’å‹•æ¨¡å‹ (canonical layout) (3) Vitals æ¸²æŸ“æ”¹ç”¨ Canvas + DOM æ··åˆæ¶æ§‹ (4) äº‹ä»¶åœ–æ¨™æ”¹ç”¨ SVGï¼Œç¦æ­¢ Emoji (5) é¡è‰²ç³»çµ±æ”¹ç‚º CSS è®Šæ•¸å¯ä¸»é¡ŒåŒ– (6) åº«å­˜é€£å‹•æ”¹ç‚º Event Sourcing æ¨¡å‹ï¼Œç”¨è£œå„Ÿäº‹ä»¶å–ä»£ DELETE (7) çµ¦è—¥äº‹ä»¶åŠ å…¥å†ªç­‰æ€§ã€æ‰¹è™Ÿæ•ˆæœŸã€è¦‹è­‰äººæ¬„ä½ |
