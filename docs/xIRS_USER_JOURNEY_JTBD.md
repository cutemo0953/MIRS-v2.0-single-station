# xIRS 使用者旅程與 JTBD 分析

**版本**: v1.0
**日期**: 2026-01-07
**狀態**: Draft

---

## 1. 情境設定

### 1.1 災難背景

```
災難類型：強震後餘震持續
影響範圍：
├── 斷水：自來水管線破裂
├── 斷電：變電所受損，商業電力中斷
├── 斷網：基地台倒塌，4G/5G 無訊號
└── 醫院狀況：建築受損，無法收治病患
```

### 1.2 政府啟動

```
Day 1 08:00  政府宣布啟動避難中心
Day 1 09:00  醫院接獲指示：在避難中心旁設立緊急醫療站
Day 1 10:00  醫療站開始收治傷患
Day 1 14:00  人數超載，需開設分站
Day 2+       持續運作，物資調撥
```

---

## 2. 場地配置

### 2.1 整體佈局

```
┌─────────────────────────────────────────────────────────────────────┐
│                         避難中心（體育館）                           │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                     災民生活區                               │    │
│  │         (CIRS 管理人流、物資發放、住所分配)                  │    │
│  └─────────────────────────────────────────────────────────────┘    │
│                                │                                     │
│                          [通道/管制點]                               │
│                                │                                     │
│  ┌─────────────────────────────────────────────────────────────┐    │
│  │                     緊急醫療站                               │    │
│  │  ┌──────────┐  ┌──────────┐                                 │    │
│  │  │ 報到區   │  │ 檢傷區   │  ← 並列入口                     │    │
│  │  │ (CIRS)   │  │ (CIRS)   │                                 │    │
│  │  └──────────┘  └──────────┘                                 │    │
│  │       │              │                                       │    │
│  │       └──────┬───────┘                                       │    │
│  │              ▼                                               │    │
│  │  ┌──────────────────────────────────────────────────────┐   │    │
│  │  │                    候診區                             │   │    │
│  │  └──────────────────────────────────────────────────────┘   │    │
│  │              │                                               │    │
│  │  ┌───────┬───┴───┬─────────┬─────────┬─────────┐            │    │
│  │  │       │       │         │         │         │            │    │
│  │  ▼       ▼       ▼         ▼         ▼         ▼            │    │
│  │ 急診區  手術區  ICU/      領藥區   轉送區   物資站          │    │
│  │(CIRS+  (MIRS)  病房區   (CIRS+   (MIRS    (MIRS             │    │
│  │ MIRS)          (CIRS)    MIRS)    EMT)    Mobile)           │    │
│  │                                                              │    │
│  └──────────────────────────────────────────────────────────────┘    │
│                                                                      │
│  [WiFi 覆蓋範圍]  ════════════════════════════════                   │
│  RPi AP 位置: 候診區中央                                             │
│  覆蓋: 報到、檢傷、候診、急診、手術、ICU、領藥、轉送                │
│  未覆蓋: 物資站 (距離較遠，需離線運作)                              │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘
```

### 2.2 分站配置（Day 2+）

```
┌─────────────────────────────────────┐
│           分站 (Satellite)          │
│                                     │
│   [報到+檢傷] → [急診] → [領藥]     │
│                                     │
│   獨立 RPi，週期性與主站同步        │
│   輕症為主，重症轉回主站            │
│                                     │
└─────────────────────────────────────┘
```

---

## 3. 使用者角色 (Personas)

### 3.1 角色清單

| 代號 | 角色 | 位置 | 主要任務 |
|------|------|------|----------|
| P1 | 報到志工 | 報到區 | 登記災民身份、發放識別 |
| P2 | 檢傷護理師 | 檢傷區 | 快速分流、標記緊急程度 |
| P3 | 急診醫師 | 急診區 | 診斷、開立處方、決定後續 |
| P4 | 急診護理師 | 急診區 | 執行處置、記錄生命徵象 |
| P5 | 外科醫師 | 手術區 | 手術、傷口處理 |
| P6 | 麻醉醫師 | 手術區 | 麻醉管理、術中監測 |
| P7 | 藥師 | 領藥區 | 調劑、發藥、衛教 |
| P8 | 庫房人員 | 物資站 | 庫存管理、物資調撥 |
| P9 | 轉送員 | 轉送區 | 病患轉送、途中照護 |
| P10 | 站長/管理員 | 機動 | 統籌、報表、資源調度 |

---

## 4. Jobs-To-Be-Done 分析

### 4.1 核心 Jobs

```
J1: 當災民受傷時，我需要快速被分流，以便獲得適當的醫療照護
J2: 當我是醫護人員時，我需要知道病患狀況，以便提供正確的治療
J3: 當我是藥師時，我需要知道處方內容和庫存，以便正確發藥
J4: 當我是庫房人員時，我需要知道各區庫存，以便及時補給
J5: 當我是站長時，我需要掌握全站狀況，以便做出資源調度決策
J6: 當病患需要轉送時，我需要確保途中有足夠的物資和資訊交接
J7: 當分站開設時，我需要確保資料同步，以便維持連續照護
```

### 4.2 功能性 Jobs

| Job | 觸發情境 | 期望結果 | 相關 PWA |
|-----|----------|----------|----------|
| 登記身份 | 災民到達 | 取得識別碼、進入系統 | CIRS Portal/Admin |
| 檢傷分流 | 災民報到後 | 標記緊急程度、分配區域 | CIRS Nurse |
| 看診記錄 | 醫師診察 | 記錄診斷、開立處方/處置 | CIRS Doctor |
| 發放藥物 | 處方開立後 | 核對、發藥、扣庫存 | CIRS Pharmacy + MIRS |
| 設備檢查 | 每日早上 | 確認設備就緒 | MIRS Index |
| 物資補給 | 庫存不足 | 調撥、補充 | MIRS Mobile |
| 手術記錄 | 手術進行 | 記錄術式、耗材、用藥 | MIRS Index |
| 麻醉管理 | 手術中 | 監測生命徵象、PSI 追蹤 | MIRS Anesthesia |
| 病患轉送 | 需後送 | 物資準備、交班、途中記錄 | MIRS EMT + CIRS Handoff |
| 狀態總覽 | 隨時 | 即時掌握人流、物資、韌性 | CIRS Portal + MIRS Index |

### 4.3 情緒性 Jobs

| Job | 情境 | 期望感受 |
|-----|------|----------|
| 安心感 | 斷網運作 | 「系統不會因為沒網路就當掉」 |
| 掌控感 | 大量傷患 | 「我知道還有多少人在等、庫存還夠不夠」 |
| 信任感 | 交班轉送 | 「接手的人知道我之前做了什麼」 |
| 成就感 | 結束一天 | 「報表清楚呈現今天的努力」 |

---

## 5. 使用者旅程劇本

### 5.1 劇本 A：輕症病患流程

```
場景：王先生，45歲，地震時被碎玻璃割傷手臂，傷口約5cm

時間軸：
─────────────────────────────────────────────────────────────────────
09:15  [報到區] 王先生到達，志工用 CIRS 登記基本資料
       → Job: 快速登記，取得識別手環 QR Code
       → PWA: CIRS Admin/Portal (新掛號)

09:18  [檢傷區] 護理師掃描 QR Code，評估傷口
       → Job: 分流決策 - 標記為「次緊急」(黃色)
       → PWA: CIRS Nurse (檢傷)
       → 系統: 自動排入急診候診

09:25  [候診區] 王先生等待叫號
       → 系統: CIRS 顯示候診順序
       → 顯示板: 候診號碼

09:40  [急診區] 醫師叫號，王先生進入診間
       → Job: 診斷傷口、決定處置
       → PWA: CIRS Doctor
       → 動作:
         1. 查看檢傷記錄
         2. 診斷: 撕裂傷，需縫合
         3. 開立處方: 局麻藥、消毒用品
         4. 勾選「需處置」

09:45  [急診區] 護理師執行縫合處置
       → Job: 記錄耗材使用
       → PWA: MIRS Index (處置耗材記錄)
       → 動作:
         1. 記錄: Xylocaine 5ml, 縫線 1組, 紗布 2塊
         2. 自動扣庫存

09:55  [急診區] 處置完成，醫師完成看診
       → PWA: CIRS Doctor
       → 動作: 「完成看診」→ 開立口服藥處方

10:00  [領藥區] 王先生到藥局領藥
       → Job: 核對處方、發藥
       → PWA: CIRS Pharmacy
       → 動作:
         1. 掃描 QR Code 取得處方
         2. 調劑藥物
         3. 發藥 + 衛教
         4. 確認發藥 (扣 MIRS 庫存)

10:05  王先生離開
─────────────────────────────────────────────────────────────────────
```

**涉及 PWA**: CIRS Admin, CIRS Nurse, CIRS Doctor, MIRS Index, CIRS Pharmacy

**觀察**:
- 處置耗材記錄在 MIRS，但病患流程在 CIRS
- 藥局發藥在 CIRS，但庫存扣減在 MIRS
- **潛在重複**: 處置記錄可能在 CIRS Doctor 和 MIRS Index 都要輸入

---

### 5.2 劇本 B：重症需手術

```
場景：李小姐，28歲，建築物倒塌壓傷，右腿開放性骨折

時間軸：
─────────────────────────────────────────────────────────────────────
10:00  [報到區] 救護員推擔架到達，志工快速登記
       → PWA: CIRS Admin (緊急掛號)
       → 特殊: URGENT 標記

10:02  [檢傷區] 護理師立即評估
       → PWA: CIRS Nurse
       → 標記: 「緊急」(紅色)
       → 備註: 開放性骨折，需手術

10:05  [急診區] 急診醫師立即接手
       → PWA: CIRS Doctor
       → 診斷: 右脛骨開放性骨折
       → 勾選: 「需麻醉」「需處置」(手術)
       → 開立: 術前用藥、抗生素

10:10  [手術區] 外科醫師接手
       → PWA: CIRS Doctor (外科接手病患)
       → 動作: role-claim (SURGERY)

10:12  [手術區] 麻醉醫師開始準備
       → PWA: MIRS Anesthesia
       → 動作:
         1. 建立麻醉案例
         2. 佔用 O2 鋼瓶 (PSI 追蹤)
         3. 入 OR、誘導、插管... (里程碑)

10:15  [手術區] 手術開始
       → PWA: MIRS Index (術式記錄)
       → 動作:
         1. 選擇術式代碼
         2. 記錄耗材 (骨板、骨釘、縫線)
         3. 術中用藥

11:30  [手術區] 手術結束
       → PWA: MIRS Anesthesia
       → 動作:
         1. 記錄醒來、拔管、出 OR
         2. 釋放 O2 鋼瓶
         3. 結案 → 通知 CIRS

11:35  [ICU/病房] 李小姐轉入觀察
       → PWA: CIRS Doctor (病房)
       → 動作: 後續照護醫囑

─────────────────────────────────────────────────────────────────────
```

**涉及 PWA**: CIRS Admin, CIRS Nurse, CIRS Doctor, MIRS Anesthesia, MIRS Index

**觀察**:
- 麻醉記錄與手術記錄分離（MIRS Anesthesia vs MIRS Index）
- 外科醫師在 CIRS Doctor 接手，但術式在 MIRS Index 記錄
- **潛在重複**: 外科醫師需同時操作 CIRS Doctor 和 MIRS Index

---

### 5.3 劇本 C：需轉送後送

```
場景：陳先生，60歲，心肌梗塞疑似，需後送至有心導管設備的醫院

時間軸：
─────────────────────────────────────────────────────────────────────
14:00  [急診區] 醫師判斷需後送
       → PWA: CIRS Doctor
       → 勾選: 「需轉送」
       → 備註: 疑似 STEMI，需緊急 PCI

14:02  [轉送區] EMT 收到通知
       → PWA: MIRS EMT
       → 動作:
         1. 接受任務
         2. 查看 ISBAR 交班資訊
         3. 準備物資 (O2、監視器、急救藥物)

14:10  [轉送區] 物資準備完成
       → PWA: MIRS EMT
       → 動作:
         1. 確認物資清單
         2. Reserve 庫存 (O2 鋼瓶 1 支、輸液 2 袋)
         3. 出發

14:15  [途中] EMT 監測病患
       → PWA: MIRS EMT
       → 動作:
         1. 開啟「交班報告」
         2. 記錄途中事件 (Vitals, 用藥)
         3. 自動同步至 CIRS Handoff

14:45  [目的地] 抵達接收醫院
       → PWA: MIRS EMT
       → 動作:
         1. 交班給接收方
         2. 記錄剩餘物資
         3. 結案

15:30  [返站] EMT 返回
       → PWA: MIRS EMT
       → 動作:
         1. Recheck 剩餘物資
         2. 歸還/入庫
─────────────────────────────────────────────────────────────────────
```

**涉及 PWA**: CIRS Doctor, MIRS EMT

**觀察**:
- 交班資訊從 CIRS 流向 MIRS EMT
- 途中事件又同步回 CIRS Handoff
- **良好設計**: 雙向同步確保資訊完整

---

### 5.4 劇本 D：庫房補給流程

```
場景：物資站庫房人員發現紗布快用完，需從主倉調撥

時間軸：
─────────────────────────────────────────────────────────────────────
16:00  [物資站] 庫房人員盤點 (離線)
       → PWA: MIRS Mobile
       → 觀察: 紗布剩 10 包，低於安全存量 30

16:05  [物資站] 建立調撥請求
       → PWA: MIRS Mobile (離線模式)
       → 動作:
         1. 新增調撥請求: 紗布 50 包
         2. 儲存到 IndexedDB

16:30  [WiFi 範圍內] 庫房人員進入覆蓋區
       → PWA: MIRS Mobile
       → 動作: 自動同步待處理請求

16:35  [主站] 站長收到調撥請求
       → PWA: MIRS Index
       → 動作:
         1. 查看請求
         2. 核准調撥
         3. 指派志工領取

17:00  [志工] 從主倉領取
       → PWA: CIRS Runner
       → 動作: 確認領取 50 包紗布

17:15  [物資站] 入庫
       → PWA: MIRS Mobile
       → 動作: 確認收到，更新庫存
─────────────────────────────────────────────────────────────────────
```

**涉及 PWA**: MIRS Mobile, MIRS Index, CIRS Runner

**觀察**:
- 離線操作後同步的機制
- **潛在問題**: CIRS Runner 和 MIRS Mobile 都有物資移動功能，可能重複

---

### 5.5 劇本 E：分站開設與同步

```
場景：主站人滿為患，需在 500m 外開設分站

時間軸：
─────────────────────────────────────────────────────────────────────
Day 2 08:00  [主站] 站長決定開設分站
             → PWA: MIRS Index
             → 動作:
               1. 建立新站點 (Satellite)
               2. 產生配對碼
               3. 規劃調撥物資

Day 2 08:30  [分站] 技術人員設置 RPi
             → 動作:
               1. 啟動 MIRS Satellite
               2. 輸入配對碼連接主站
               3. 同步主檔資料 (設備類型、藥品清單)

Day 2 09:00  [分站] 開始收治
             → 獨立運作：
               - CIRS: 報到、檢傷、看診、領藥
               - MIRS: 庫存管理
             → 週期性同步：
               - 每 15 分鐘嘗試與主站同步
               - 同步內容：病患名單、庫存異動、報表

Day 2 12:00  [分站] 重症需轉回主站
             → PWA: MIRS EMT
             → 動作:
               1. 站內轉送 (分站 → 主站)
               2. 交班資訊包含分站記錄

Day 2 18:00  [主站] 站長檢視全局報表
             → PWA: MIRS Index / CIRS Portal
             → 顯示: 主站 + 所有分站彙整數據
─────────────────────────────────────────────────────────────────────
```

**涉及 PWA**: MIRS Index, CIRS Portal, MIRS EMT

**觀察**:
- 分站需要完整的 CIRS + MIRS 功能
- 同步機制需可靠
- **潛在問題**: 分站是獨立部署還是僅作為 Satellite？

---

## 6. PWA 功能重疊分析

### 6.1 功能對照矩陣

| 功能 | CIRS Portal | CIRS Doctor | CIRS Nurse | CIRS Pharmacy | CIRS Runner | MIRS Index | MIRS Mobile | MIRS Anes | MIRS EMT | HIRS |
|------|:-----------:|:-----------:|:----------:|:-------------:|:-----------:|:----------:|:-----------:|:---------:|:--------:|:----:|
| 病患登記 | ✓ | | | | | | | | | |
| 檢傷分流 | | | ✓ | | | | | | | |
| 診斷記錄 | | ✓ | | | | | | | | |
| 處方開立 | | ✓ | | | | | | | | |
| 處置記錄 | | ✓? | | | | ✓ | | | | |
| 發藥/扣庫存 | | | | ✓ | | ✓? | | | | |
| 設備檢查 | | | | | | ✓ | ✓? | | | |
| 庫存查詢 | | | | ✓? | | ✓ | ✓ | | | |
| 庫存入出庫 | | | | | | ✓ | ✓ | | | |
| 物資調撥 | | | | | ✓? | ✓ | ✓ | | | |
| 麻醉記錄 | | | | | | | | ✓ | | |
| 術式記錄 | | | | | | ✓ | | | | |
| 轉送管理 | | | | | | | | | ✓ | |
| 交班資訊 | ✓? | ✓ | | | | | | | ✓ | |
| 報表/總覽 | ✓ | | | | | ✓ | | | | |
| 戶外救護 | | | | | | | | | | ✓ |

**標記說明**:
- ✓ = 主要功能
- ✓? = 有部分功能，可能重疊

### 6.2 明確重疊區域

| 重疊功能 | PWA A | PWA B | 建議處理 |
|----------|-------|-------|----------|
| 處置記錄 | CIRS Doctor | MIRS Index | **整合**: Doctor 開立，MIRS 記錄耗材 |
| 發藥庫存 | CIRS Pharmacy | MIRS Index | **整合**: Pharmacy 發藥時呼叫 MIRS API 扣庫存 |
| 設備檢查 | MIRS Index | MIRS Mobile | **分工**: Index=總覽, Mobile=現場 |
| 庫存管理 | MIRS Index | MIRS Mobile | **分工**: Index=管理, Mobile=執行 |
| 物資調撥 | CIRS Runner | MIRS Mobile | **釐清**: Runner=跑腿, Mobile=庫房操作 |
| 交班資訊 | CIRS Doctor | MIRS EMT | **雙向**: Doctor 寫入, EMT 讀取+補充 |

### 6.3 功能缺口

| 缺口 | 描述 | 建議 |
|------|------|------|
| 病房管理 | ICU/病房區缺乏專用 PWA | 擴充 CIRS Doctor 或新增 Ward PWA |
| 分站同步 | 分站離線同步機制未完善 | 設計 Satellite 同步協議 |
| 志工任務 | Runner 功能過於簡單 | 擴充任務派發、追蹤功能 |
| 財務結算 | Cashdesk 在緊急醫療站的角色 | 災難時暫停收費，或簡化記錄 |

---

## 7. 重新設計建議

### 7.1 PWA 角色重新定義

```
CIRS (臨床流程系統) - 管「人流」
├── Portal/Admin: 站點管理、報表、帳號
├── Registration: 報到登記（可由 Admin 或獨立 PWA）
├── Triage (Nurse): 檢傷分流
├── Doctor: 診斷、處方、處置決策
├── Pharmacy: 發藥 (呼叫 MIRS API 扣庫存)
├── Ward: 病房管理 (新增)
└── Runner: 任務執行（跑腿、傳送）

MIRS (物資韌性系統) - 管「物流」
├── Index: 總覽、報表、設定、術式記錄
├── Warehouse (Mobile): 庫房操作、入出庫、盤點
├── Equipment: 設備檢查、韌性估算
├── Anesthesia: 麻醉專用
├── EMT Transfer: 轉送專用
└── Supply Request: 調撥請求管理 (新增或整合)

HIRS (戶外救護系統) - 管「野外」
└── Standalone: 完全離線運作
```

### 7.2 系統邊界

```
┌─────────────────────────────────────────────────────────────┐
│                        CIRS Hub                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  病患 Master Data                                    │   │
│  │  - 身份資料                                          │   │
│  │  - 檢傷記錄                                          │   │
│  │  - 診斷/處方                                         │   │
│  │  - 交班狀態                                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                          │                                  │
│                          │ API 呼叫                         │
│                          ▼                                  │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  MIRS Satellite                                      │   │
│  │  - 庫存 Master Data                                  │   │
│  │  - 設備狀態                                          │   │
│  │  - 耗材使用記錄                                      │   │
│  │  - 麻醉記錄                                          │   │
│  │  - 轉送任務                                          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘

呼叫方向：
- CIRS Pharmacy → MIRS: 發藥時扣庫存
- CIRS Doctor → MIRS: 記錄處置耗材
- MIRS EMT → CIRS: 轉送狀態更新
- MIRS Anesthesia → CIRS: 麻醉完成通知
```

### 7.3 離線優先策略

| 優先級 | PWA | 離線能力 | 說明 |
|:------:|-----|:--------:|------|
| 高 | MIRS Mobile | 完整離線 | 物資站可能在 WiFi 覆蓋外 |
| 高 | MIRS EMT | 完整離線 | 轉送途中無網路 |
| 高 | HIRS | 完整離線 | 野外環境 |
| 中 | CIRS Triage | 部分離線 | 快取最近病患資料 |
| 中 | MIRS Anesthesia | 部分離線 | 手術室通常在覆蓋內 |
| 低 | CIRS Doctor | 連線優先 | 診間通常在覆蓋內 |
| 低 | CIRS Pharmacy | 連線優先 | 需即時庫存 |

---

## 8. 行動項目

### 8.1 短期 (v2.x)

- [ ] 統一庫存扣減 API（CIRS Pharmacy 呼叫 MIRS）
- [ ] 處置耗材記錄整合（Doctor 開單 → MIRS 執行）
- [ ] Runner PWA 擴充任務追蹤功能
- [ ] 確認 Cashdesk 在災難情境的角色

### 8.2 中期 (v3.x)

- [ ] 設計 Satellite 同步協議
- [ ] 新增 Ward PWA 或擴充 Doctor PWA
- [ ] 完善離線優先架構
- [ ] 統一配對與安全機制（參考 xIRS_PAIRING_SECURITY.md）

### 8.3 長期

- [ ] 多站點彙整報表
- [ ] 跨站調撥流程自動化
- [ ] AI 輔助資源調度建議

---

## 9. 附錄

### 9.1 術語對照

| 英文 | 中文 | 說明 |
|------|------|------|
| Hub | 主站 | 中央管理伺服器 |
| Satellite | 分站 | 連接主站的子系統 |
| Triage | 檢傷 | 分流傷患緊急程度 |
| Handoff | 交班 | 病患照護交接 |
| Reserve | 預留 | 庫存預留給特定任務 |
| Issue | 發放 | 庫存正式扣減 |
| Resilience | 韌性 | 獨立運作能力 |

### 9.2 參考文件

- `DEV_SPEC_MIRS_ADMIN_PORTAL.md` - 管理入口
- `DEV_SPEC_ANESTHESIA_TIMELINE_UI.md` - 麻醉 UI
- `DEV_SPEC_xIRS_PAIRING_SECURITY.md` - 安全機制
- `DEV_SPEC_EMT_HANDOFF_v1.0.md` - 轉送交班

---

## Changelog

| 版本 | 日期 | 變更 |
|------|------|------|
| v1.0 | 2026-01-07 | 初版 |
